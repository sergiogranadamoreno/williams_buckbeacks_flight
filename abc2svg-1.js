// abc2svg - ABC to SVG translator
// @source: https://chiselapp.com/user/moinejf/repository/abc2svg
// Copyright (C) 2014-2018 Jean-Francois Moine - LGPL3+
// commit [c4c1d16ff2]
abc2svg={C:{BLEN:1536,BAR:0,CLEF:1,CUSTOS:2,GRACE:4,KEY:5,METER:6,MREST:7,NOTE:8,PART:9,REST:10,SPACE:11,STAVES:12,STBRK:13,TEMPO:14,BLOCK:16,REMARK:17,FULL:0,EMPTY:1,OVAL:2,OVALBARS:3,SQUARE:4,SL_ABOVE:1,SL_BELOW:2,SL_AUTO:3,SL_HIDDEN:4,SL_DOTTED:8},Abc:function(w){function C(a,c){if(!a)return a;var b=new a.constructor,d;for(d in a)a.hasOwnProperty(d)&&(b[d]=c&&"object"==typeof a[d]?C(a[d],c-1):a[d]);return b}function Y(a,c,b,d){var e,f,g;if(w.errbld){switch(a){case 0:a="warn";break;case 1:a="error";
break;default:a="fatal"}w.errbld(a,c,b,d)}else{if(void 0!=d&&0<=d){for(e=g=0;;){f=q.file.indexOf("\n",e);if(0>f||f>d)break;g++;e=f+1}e=d-e}d="";b&&(d=b,g&&(d+=":"+(g+1)+":"+(e+1)),d+=" ");switch(a){case 0:d+="Warning: ";break;case 1:d+="Error: ";break;default:d+="Internal bug: "}w.errmsg(d+c,g,e)}}function N(a,c,b,d,e,f,g){var l;w.textrans&&(l=w.textrans[b])&&(b=l);3<arguments.length&&(b=b.replace(/\$./g,function(a){switch(a){case "$1":return d;case "$2":return e;case "$3":return f;default:return g}}));
c&&c.fname?Y(a,b,c.fname,c.istart):Y(a,b)}function sa(){this.index=0;sa.prototype["char"]=function(){return this.buffer[this.index]};sa.prototype.next_char=function(){return this.buffer[++this.index]};sa.prototype.get_int=function(){for(var a=0,c=this.buffer[this.index];"0"<=c&&"9">=c;)a=10*a+Number(c),c=this.next_char();return a}}function u(a,c,b,d,e,f){N(a,{fname:q.fname,istart:q.istart+q.line.index},c,b,d,e,f)}function Sa(a){/eval *\(|Function|setTimeout|setInterval/.test(a)?u(1,"Unsecure code"):
eval('"use strict"\n'+a)}function T(a,c,b,d){a=v[a];var e=b/za*256|0;b=(b+d)/za*256|0;0>e&&(e=0);256<=b&&(b=255,e>b&&(e=b));if(c)for(c=a.top[e++];e<=b;)c<a.top[e]&&(c=a.top[e]),e++;else for(c=a.bot[e++];e<=b;)c>a.bot[e]&&(c=a.bot[e]),e++;return c}function H(a,c,b,d,e){a=v[a];var f=b/za*256|0;b=(b+d)/za*256|0;0>f&&(f=0);256<=b&&(b=255,f>b&&(f=b));if(c)for(;f<=b;)a.top[f]<e&&(a.top[f]=e),f++;else for(;f<=b;)a.bot[f]>e&&(a.bot[f]=e),f++}function gc(a,c){switch(c){case k.SL_ABOVE:return!0;case k.SL_BELOW:return!1}return a.multi&&
0!=a.multi?0<a.multi:a.p_v.have_ly?a.pos.voc!=k.SL_ABOVE:!1}function Rd(a){if(!a.ldst){var c,b,d,e,f,g=a.s,l=g.st,t=a.start.s,m=t.x;a.prev&&(m=a.prev.x+10,d=a.prev.y);a.st=l;if(4!=a.dd.func)switch(a.dd.glyph){case "8va":case "15ma":b=1;break;default:b=0<=g.multi}a.defl.noen?(e=a.x-m,20>e&&(m=a.x-20-3,e=20)):(e=g.x-m-6,g.type==k.NOTE&&(e-=6),20>e&&(m-=.5*(20-e),e=20));c=a.dd;d||(d=T(l,b,m,e));b?(f=v[t.st].topbar+2,d<f&&(d=f)):(d-=c.h,f=v[t.st].botbar-2,d>f&&(d=f));a.lden=!1;a.has_val=!0;a.val=e;a.x=
m;a.y=d;b&&(d+=c.h);H(l,b,m,e,d);b?t.ymx=g.ymx=d:t.ymn=g.ymn=d}}function nb(a){if(!a.ldst)if(a.start)Rd(a);else{var c,b,d=a.s,e=a.dd,f=d.x,g=e.wl+e.wr,l=v[d.st].topbar+2,t=v[d.st].botbar-2;d.nhd&&(f+=d.notes[0<=d.stem?0:d.nhd].shhd);c=-1;if(4==e.func)c=0;else if(d.pos)switch(d.pos.orn){case k.SL_ABOVE:c=1;break;case k.SL_BELOW:c=0}switch(e.glyph){case "accent":case "roll":!c||0>c&&(0>d.multi||!d.multi&&0<d.stem)?(c=T(d.st,!1,d.x-e.wl,g)-2,c>t&&(c=t),c-=e.h,H(d.st,!1,d.x,0,c),b=!0,d.ymn=c):(c=T(d.st,
!0,d.x-e.wl,g)+2,c<l&&(c=l),H(d.st,!0,d.x-e.wl,g,c+e.h),d.ymx=c+e.h);break;case "brth":case "lphr":case "mphr":case "sphr":c=l+1;"brth"==e.glyph&&c<d.ymx&&(c=d.ymx);for(d=d.ts_next;d&&!d.seqst;d=d.ts_next);f+=.45*((d?d.x:za)-f);break;default:0==e.name.indexOf("invert")&&(b=!0),"invertedfermata"!=e.name&&(0<c||0>c&&0<=d.multi)?(c=T(d.st,!0,d.x-e.wl,g)+2,c<l&&(c=l),H(d.st,!0,d.x-e.wl,g,c+e.h),d.ymx=c+e.h):(c=T(d.st,!1,d.x-e.wl,g)-2,c>t&&(c=t),c-=e.h,H(d.st,!1,d.x-e.wl,g,c),"fermata"==e.name&&(b=!0),
d.ymn=c)}b&&(c+=e.h,a.inv=!0);a.x=f;a.y=c}}function ce(a){var c,b,d;if(d=jd[a])if(c=d.match(/(\d+)\s+(.+?)\s+([0-9.]+)\s+([0-9.]+)\s+([0-9.]+)/)){var e=Number(c[1]),f=parseFloat(c[3]),g=parseFloat(c[4]),l=parseFloat(c[5]);if(isNaN(e))N(1,null,"%%deco: bad C function value '$1'",c[1]);else if((0>e||10<e)&&(32>e||41<e))N(1,null,"%%deco: bad C function index '$1'",e);else if(0>f||0>g||0>l)N(1,null,"%%deco: cannot have a negative value '$1'",d);else if(50<f||80<g||80<l)N(1,null,"%%deco: abnormal h/wl/wr value '$1'",
d);else{b=Sc[a];b||(b={name:a},Sc[a]=b);b.func=0==b.name.indexOf("head-")?9:e;b.glyph=c[2];b.h=f;b.wl=g;b.wr=l;if(a=d.replace(c[0],"").trim())'"'==a[0]&&(a=a.slice(1,-1)),b.str=a;6==b.func&&void 0==b.str&&(b.str=b.name);d=b.name.slice(-1);if("("==d||")"==d&&0>b.name.indexOf("("))if(c=b.name.slice(0,-1)+("("==d?")":"("),a=Sc[c])"("==d?(b.dd_en=a,a.dd_st=b):(b.dd_st=a,a.dd_en=b);else if(a=ce(c),!a)return;return b}}else N(1,null,"Invalid decoration '$1'",a);else r.decoerr&&N(1,null,"Unknown decoration '$1'",
a)}function kd(a,c,b){var d,e,f,g,l=a.length;for(d=0;d<l;d++){e=a[d];f=Sc[e];if(!f&&(f=ce(e),!f))continue;switch(f.func){case 0:if(c.type==k.BAR&&"dot"==f.name){c.bar_dotted=!0;break}case 1:case 2:if(!c.notes){N(1,c,P.must_note_rest,f.name);continue}break;case 8:if(c.type!=k.NOTE){N(1,c,P.must_note,f.name);continue}g=c.notes[c.nhd];g.a_dcn||(g.a_dcn=[]);g.a_dcn.push(f.name);continue;case 9:if(!c.notes){N(1,c,P.must_note_rest,f.name);continue}for(e=0;e<=c.nhd;e++)g=c.notes[e],g.a_dcn||(g.a_dcn=[]),
g.a_dcn.push(f.name);continue;case 10:if(c.notes)for(e=0;e<=c.nhd;e++)c.notes[e].color=f.name;else c.color=f.name;continue;case 32:c.invis=!0;continue;case 33:if(c.type!=k.BAR){N(1,c,"!beamon! must be on a bar");continue}c.beam_on=!0;continue;case 34:if(c.type!=k.NOTE||!b||b.type!=k.NOTE||c.nflags!=b.nflags){N(1,c,"!$1! must be on the last of a couple of notes",f.name);continue}c.trem2=!0;c.beam_end=!0;b.trem2=!0;b.beam_st=!0;c.ntrem=b.ntrem=Number(f.name[4]);b.nflags=--c.nflags;b.head=++c.head;0<
c.nflags?c.nflags+=c.ntrem:(-2>=c.nflags&&(c.stemless=!0,b.stemless=!0),c.nflags=c.ntrem);b.nflags=c.nflags;for(e=0;e<=c.nhd;e++)c.notes[e].dur*=2;for(e=0;e<=b.nhd;e++)b.notes[e].dur*=2;continue;case 35:if(c.type!=k.NOTE){N(1,c,"!xstem! must be on a note");continue}c.xstem=!0;c.nflags=0;continue;case 36:if(c.type!=k.NOTE){N(1,c,P.must_note,f.name);continue}"1"==f.name[6]?c.beam_br1=!0:c.beam_br2=!0;continue;case 37:c.rbstop=1;continue;case 38:if(c.type!=k.NOTE){N(1,c,P.must_note,f.name);continue}c.trem1=
!0;c.ntrem=f.name.length;c.nflags=0<c.nflags?c.nflags+c.ntrem:c.ntrem;continue;case 39:if(c.type!=k.NOTE){N(1,c,P.must_note,f.name);continue}c.feathered_beam="a"==f.name[5]?1:-1;continue;case 40:c.stemless=!0;continue;case 41:c.rbstop=2;continue}c.a_dd||(c.a_dd=[]);c.a_dd.push(f)}}function ld(a){var c,b,d=0,e=a.a_dd,f=e.length;for(b=0;b<f;b++)switch(c=e[b],c.func){case 1:7>d&&(d=7);break;case 2:14>d&&(d=14);break;case 3:switch(c.glyph){case "brth":case "lphr":case "mphr":case "sphr":20>a.wr&&(a.wr=
20)}}0!=d&&a.prev&&a.prev.type==k.BAR&&(d-=3);return d}function pg(){function a(a){var b,c=a.x-a.wl,d=qa.length;for(a=0;a<d;a++)b=qa[a],b.ix=a,b.s.x=b.x=c,b.defl.nost=!0}function c(a){var b;if(a.a_dd){var c,d,e=a.a_dd.length;for(c=0;c<e;c++){b=a.a_dd[c];switch(b.func){default:d=0;break;case 3:case 4:case 5:if(Ye[b.name])if(d=b.name.slice(0,-1)+a.st.toString(),xb[d]){if("("==b.name[b.name.length-1]){xb[d]++;continue}xb[d]--;if(a.v+1!=xb[d]>>8||!xb[d])continue;xb[d]&=255}else"("==b.name[b.name.length-
1]&&(xb[d]=1+(a.v+1<<8));d=a.pos.orn;break;case 6:d=a.pos.vol;break;case 7:d=a.pos.dyn}if(d!=k.SL_HIDDEN&&(d={s:a,dd:b,st:a.st,ix:qa.length,defl:{},x:a.x,y:a.y},qa.push(d),b.dd_en?d.ldst=!0:b.dd_st&&(d.lden=!0,d.defl.nost=!0),qg[b.func]))He[b.func](d)}}if(a.notes)for(b=0;b<a.notes.length;b++)if(a.notes[b].a_dcn){var m;d=a;for(var n=b,A=d.notes[n],p=A.a_dcn.length,e=0;e<p;e++){m=A.a_dcn[e];c=Sc[m];if(!c&&(c=ce(m),!c))continue;switch(c.func){case 0:case 1:case 3:case 4:case 8:break;default:N(1,null,
"Cannot have !$1! on a head",c.name);continue;case 9:A.invis=!0;break;case 10:A.color=c.name;continue;case 32:A.invis=!0;continue;case 40:d.stemless=!0;continue}m={s:d,dd:c,st:d.st,m:n,ix:0,defl:{},x:d.x,y:3*(A.pit-18)};qa.push(m);c.dd_en?m.ldst=!0:c.dd_st&&(m.lden=!0,m.defl.nost=!0)}}}var b,d;for(b=S;b;b=b.ts_next){switch(b.type){case k.CLEF:case k.KEY:case k.METER:continue}break}for(0!=qa.length&&a(b);b;b=b.ts_next){switch(b.type){case k.BAR:case k.MREST:case k.NOTE:case k.REST:case k.SPACE:break;
case k.GRACE:for(d=b.extra;d;d=d.next)c(d);default:continue}c(b)}(function(){var a,b,c,d,k,m,n,A,p=qa.length;for(a=0;a<p;a++)if(c=qa[a],c.ldst){k=c.dd;m=k.dd_en;A=c.s;n=A.v;for(b=a+1;b<p&&(d=qa[b],d.start||d.dd!=m||d.s.v!=n);b++);if(b==p)for(n=A.st,b=a+1;b<p&&(d=qa[b],d.start||d.dd!=m||d.s.st!=n);b++);b==p&&(d={s:c.s,st:c.st,dd:m,ix:qa.length-1,x:za-6,y:c.s.y,lden:!0,defl:{noen:!0}},d.x<A.x+10&&(d.x=A.x+10),void 0!=c.m&&(d.m=c.m),qa.push(d));d.start=c;d.defl.nost=c.defl.nost;"trill("==k.name&&0<a&&
"trill"==qa[a-1].dd.name&&(d.prev=qa[a-1])}for(a=0;a<p;a++)d=qa[a],d.lden&&!d.start&&(A=d.s,c={s:Ze(A),st:d.st,dd:d.dd.dd_st,ix:qa.length-1,y:A.y,ldst:!0},c.x=c.s.x,void 0!=d.m&&(c.m=d.m),qa.push(c),d.start=c)})()}function $e(a,c,b,d,e){var f=Ib(a,d);a=f[0];var g=f[1],f=f[2];V('<g transform="translate(X,Y) scale(F)">\n',c+4,b+5,e);switch(a){case k.OVAL:c="HD";break;case k.EMPTY:c="Hd";break;default:c="hd"}ca(-Jb,ma,c);c=4;if(g){b=9;0<f&&(b+=4);switch(a){case k.SQUARE:b+=3;break;case k.OVALBARS:case k.OVAL:b+=
2;break;case k.EMPTY:b+=1}c=b*g;for(b-=Jb;0<=--g;)ca(b,ma,"dot"),b+=3.5}d<k.BLEN&&(0>=f?Tc(-Jb,ma,21):(Tc(-Jb,ma,21,!1,f),6>c&&(c=6)));y+="</g>\n";return(c+15)*e}function af(a){var c=0;va("tempo");a.tempo_str1&&(c=Ka(a.tempo_str1)[0]);a.tempo_ca&&(c+=Ka(a.tempo_ca)[0]);a.tempo_notes&&(c+=10*a.tempo_notes.length+6+hc(" ")*K.curfont.swfac*6+10);a.tempo_str2&&(c+=Ka(a.tempo_str2)[0]);return c}function bf(a,c,b){var d,e=.6*K.curfont.size/15;va("tempo");a.tempo_str1&&(fa(c,b,a.tempo_str1),c+=Ka(a.tempo_str1)[0]+
3);if(a.tempo_notes){for(d=0;d<a.tempo_notes.length;d++)c+=$e(a,c,b,a.tempo_notes[d],e);fa(c,b,"=");c+=Ka("= ")[0];a.tempo_ca&&(fa(c,b,a.tempo_ca),c+=Ka(a.tempo_ca)[0]);a.tempo?(fa(c,b,a.tempo.toString()),d=hc("0")*K.curfont.swfac,c+=d+5,10<=a.tempo&&(c+=d,100<=a.tempo&&(c+=d))):c+=$e(a,c,b,a.new_beat,e)}a.tempo_str2&&fa(c,b,a.tempo_str2);a.del=!0}function rg(a,c,b,d){function e(a){return 6*Math.round((a+12)/6)-12-a}var f=a?3.5:5;a=a?1.8:3.2;if(0<c){c=d-(b-1)*f-a;if(26<c)return 0;b=d}else{b=d+(b-
1)*f+a;if(-2>b)return 0;c=d}d=e(b-.25);c=e(c+.25);return d*d>c*c?c:d}function cf(a){var c,b,d=C(a);d.invis=!0;delete d.text;delete d.a_gch;delete d.a_ly;delete d.a_dd;d.notes=C(a.notes);for(c=0;c<=d.nhd;c++)b=d.notes[c]=C(a.notes[c]),delete b.a_dcn;return d}function df(a){function c(a,b,c,d,e,f){var g=e.s1,l=g.nflags;g.ntrem&&(l-=g.ntrem);g.trem2&&f>l&&(g.dur>=k.BLEN/2?(a=g.x+6,b=e.s2.x-6):g.dur<k.BLEN/4&&(a+=5,b-=6));c=e.a*a+e.b-c;b=(b-a)/D.scale;e=e.a*b*D.scale;Sd(a,c,!0);y+="l"+b.toFixed(2)+" "+
(-e).toFixed(2)+"v"+d.toFixed(2)+"l"+(-b).toFixed(2)+" "+e.toFixed(2)+'z"/>\n'}var b,d,e,f,g,l,t,m,n,A,p,h,r=a.s1,q=a.s2;ob(r,"beam");r.grace?(g=3.5,l=3.2,f=.29,t=1.8):(g=5,l=8,f=.34,t=3.2);e=r.stem;r.stem!=q.stem&&r.nflags<q.nflags&&(e=q.stem);0>e&&(t=-t);c(r.xs-f,q.xs+f,0,t,a,1);m=0;for(b=r;b.type==k.NOTE&&b.stem!=e&&(b.ys=a.a*b.xs+a.b-v[b.st].y+g*(b.nflags-1)*b.stem-t),b!=q;b=b.next);r.feathered_beam&&(m=g/(q.xs-r.xs),0<r.feathered_beam?(m=-m,g=m*r.xs):g=m*q.xs,m*=e);f=0;for(d=2;d<=a.nflags;d++)for(f+=
g,0!=m&&(a.a+=m),b=r;;b=b.next){if(!(b.type!=k.NOTE||b.nflags<d))if(b.trem1&&d>b.nflags-b.ntrem)h=b.dur>=k.BLEN/2?b.x:b.xs,c(h-5,h+5,(f+2.5)*e,t,a,d);else{for(A=b;b!=q;){n=b.next;if(n.type==k.NOTE||n.type==k.REST)if(n.trem1){if(n.nflags-n.ntrem<d)break}else if(n.nflags<d)break;if(n.beam_br1||n.beam_br2&&2<d)break;b=n}for(p=b;p.type!=k.NOTE;)p=p.prev;h=A.xs;if(A==p)if(A==r)h+=l;else if(A==q)h-=l;else if(A.beam_br1||A.beam_br2&&2<d)h+=l;else{for(n=A.next;n.type!=k.NOTE;)n=n.next;if(n.beam_br1||n.beam_br2&&
2<d)h-=l;else{for(A=A.prev;A.type!=k.NOTE;)A=A.prev;h=A.nflags<n.nflags||A.nflags==n.nflags&&A.dots<n.dots?h+l:h-l}}c(h,p.xs,f*e,t,a,d)}if(b==q)break}r.tmp?pb(r):q.tmp&&pb(q);yb(r,"beam")}function ef(a){function c(a,b,c){for(var d,e;!B.st_print[b];){if(B.staves[b].flags&c)return;b++}for(d=e=b;;){B.st_print[d]&&(e=d);if(B.staves[d].flags&c)break;d++}b=v[b].y+v[b].topbar*v[b].staffscale;e=v[e].y+v[e].botbar*v[e].staffscale;c&514?(a+=Jb-6,c=ma-e,b=(b-e)/24,y+='<text transform="translate('+a.toFixed(2)+
","+c.toFixed(2)+") scale(2.5,"+b.toFixed(2)+')">'+ic.brace.c+"</text>\n"):(a+=Jb-5,c=ma-b-3,b=b-e+2,y+='<path class="fill"\n\td="m'+a.toFixed(2)+" "+c.toFixed(2)+"\n\tc10.5 1 12 -4.5 12 -3.5c0 1 -3.5 5.5 -8.5 5.5\n\tv"+b.toFixed(2)+'\n\tc5 0 8.5 4.5 8.5 5.5c0 1 -1.5 -4.5 -12 -3.5"/>\n')}var b,d,e=B.nstaff,f=0;for(b=0;;b++){B.staves[b].flags&5&&f++;if(B.st_print[b])break;B.staves[b].flags&10&&f--;if(b==e)break}for(d=e;d>b&&!B.st_print[d];d--);if(b!=d||0!=f)for(d=v[d].y+v[d].botbar*v[d].staffscale,
b=v[b].y+v[b].topbar*v[b].staffscale-d,Sd(a,d),y+="v"+(-b).toFixed(2)+'"/>\n',b=0;b<=e;b++)B.staves[b].flags&1&&c(a,b,2),B.staves[b].flags&4&&c(a,b,8),B.staves[b].flags&256&&c(a-6,b,512),B.staves[b].flags&1024&&c(a-6,b,2048)}function md(a,c,b,d,e){if(d)if(d==e)b=-1==b?-2:2;else if(2*d!=e){ca(a,c,"acc"+b+"_"+d+"_"+e);return}ca(a,c,"acc"+b)}function ff(a,c,b,d,e){var f,g;f=v[d];d=f.y;var l=f.stafflines,k=6*(l.length-1),m=f.botline;if(/[\[|]/.test(l)){c%6&&(c+=3);b%6&&(b-=3);if(0<=l.indexOf("-")&&(c>
m&&c<k||b>m&&b<k||c<=m&&b>=k)){f=c;for(g=b;f>m&&"-"==l[f/6];)f-=6;for(;g<k&&"-"==l[g/6];)g+=6;for(;f<g;f+=6)"-"==l[f/6]&&ca(a,d+f,e)}for(;c<m;c+=6)ca(a,d+c,e);for(;b>k;b-=6)ca(a,d+b,e)}}function sg(a){switch(a){case "[":case "[]":return"";case "|:":case "|::":case "|:::":return"["+a;case ":|":case "::|":case ":::|":return a+"]";case "::":return r.dblrepbar;case "||:":return"[|:"}return a}function tg(a,c,b){var d,e,f=a.bar_type,g=a.st;d=v[g];var l=a.x;if(f){0!=g&&a.ts_prev&&a.ts_prev.type!=k.BAR&&
(b=d.topbar*d.staffscale);a.ymx=a.ymn+b;db(-1);ob(a);e=d.y+12;"|||||"!=d.stafflines&&(e+=(d.topbar+d.botbar)/2-12);if(a.bar_mrep)if(db(g),1==a.bar_mrep){for(d=a.prev;d.type!=k.REST;d=d.prev);ca(d.x,e,"mrep")}else ca(l,e,"mrep2"),a.v==B.top_voice&&(va("annotation"),fa(l,e+d.topbar-9,a.bar_mrep.toString(),"c"));for(d=f.length;0<=--d;){switch(f[d]){case "|":db(-1);var t=c,m=b;y+='<path class="stroke" stroke-width="1" '+(a.bar_dotted?'stroke-dasharray="5,5" ':"")+'d="m'+(l+Jb).toFixed(2)+" "+(ma-t).toFixed(2)+
"v"+(-m).toFixed(2)+'"/>\n';break;default:l-=3;db(-1);var t=l,m=c,n=b,t=t+(Jb+1.5),m=ma-m;y+='<path class="stroke" stroke-width="3" d="m'+t.toFixed(2)+" "+m.toFixed(2)+"v"+(-n).toFixed(2)+'"/>\n';break;case ":":l-=2,db(g),ca(l+1,e-12,"rdots")}l-=3}db(-1);yb(a)}}function Uc(a,c){var b,d,e,f,g,l=Array(a.nhd+1);if(a.dots){for(g=0;g<=a.nhd;g++)d=3*(a.notes[g].pit-18),0==d%6&&(d=a.dot_low?d-3:d+3),l[g]=d;for(g=0;g<a.nhd;g++)if(!(l[g+1]>l[g])){for(d=g;0<d&&!(l[d]>l[d-1]+6);)d--;if(3*(a.notes[d].pit-18)-
l[d]<l[g+1]-3*(a.notes[g+1].pit-18))for(;d<=g;)l[d++]-=6;else l[g+1]=l[g]+6}}e=a.notes[0>a.stem?a.nhd:0];g=a.x+e.shhd*D.scale;d=v[a.st].y;if(a.grace)f="ghl";else switch(a.head){default:f="hl";break;case k.OVAL:case k.OVALBARS:f="hl1";break;case k.SQUARE:f="hl2"}ff(g,3*(a.notes[0].pit-18),3*(a.notes[a.nhd].pit-18),a.st,f);e=v[a.st].y+3*(e.pit-18);a.stemless?a.xstem&&(b=a.ts_prev,f=(0<b.stem?b.y:b.ys)-a.y,f+=v[b.st].y-d,f/=a.p_v.scale,Tc(g,e,f)):(f=a.ys-a.y,b=a.nflags,a.ntrem&&(b-=a.ntrem),!c||0>=b?
(0<a.nflags&&(f=0<=a.stem?f-1:f+1),Tc(g,e,f,a.grace)):Tc(g,e,f,a.grace,b,r.straightflags));if(c&&a.trem1){e=a.ntrem||0;f=3*(a.notes[0<a.stem?a.nhd:0].pit-18);a.head==k.FULL||a.head==k.EMPTY?(g+=(a.grace?Fc:3.5)*a.stem,f=0<a.stem?f+(6+5.4*e):f-11.4):f=0<a.stem?f+(5+5.4*e):f-10.4;f/=a.p_v.scale;for(V('<path class="fill" d="mX Y\n\t',g-4.5,d+f);;){y+="l9 -3v3l-9 3z";if(0>=--e)break;y+="m0 5.4"}y+='"/>\n'}g=a.x;for(d=0;d<=a.nhd;d++){var t,m,n;m=void 0;var h;f=g;e=a;t=d;var p=l;b=!1;var I=e.notes[t],q=
v[e.st].y,u=3*(I.pit-18);n=I.shhd*D.scale;var z=f+n,x=u+q,w=Ib(e,I.dur);h=w[0];w=w[1];0==u%6&&n!=(0<e.stem?e.notes[0].shhd:e.notes[e.nhd].shhd)&&(n=0,30<=u?(n=u,n%6&&(n-=3)):-6>=u&&(n=u,n%6&&(n+=3)),n&&ca(z,n+q,"hl"));if(!I.invis)if(e.grace)m="ghd",z-=4.5*D.scale;else if(I.map&&I.map[0])h=e.head,(m=I.map[0][h])||(m=I.map[0][I.map[0].length-1]),h=m.indexOf("/"),0<=h&&(m=0<=e.stem?m.slice(0,h):m.slice(h+1));else if(e.type==k.CUSTOS)m="custos";else switch(h){case k.OVAL:m="HD";break;case k.OVALBARS:if(e.head!=
k.SQUARE){m="HDD";break}case k.SQUARE:m=I.dur<4*k.BLEN?"breve":"longa";Sb||!e.next||e.next.type!=k.BAR||e.next.next||(w=0);break;case k.EMPTY:m="Hd";break;default:m="hd"}void 0!=I.color?b=tc(I.color):I.map&&I.map[2]&&(b=tc(I.map[2]));m&&(aa.psxygl(z,x,m)||ca(z,x,m));if(w)for(m=f+(7.7+e.xmx)*D.scale,void 0==p[t]&&(p[t]=3*(e.notes[t].pit-18),0==(e.notes[t].pit&1)&&(p[t]+=3)),t=p[t]+q;0<=--w;)ca(m,t,"dot"),m+=3.5;I.acc&&(f-=I.shac*D.scale,e.grace?(de(f,u+q,0,.75),md(0,0,I.acc,I.micro_n,I.micro_d),ee()):
md(f,u+q,I.acc,I.micro_n,I.micro_d));0!=b&&tc(b)}}function gf(a){var c=a;for(a=a.next;a;a=a.next){if(a.rbstop)return a;c=a}return c}function Ze(a){for(;a.prev;)if(a=a.prev,a.rbstart)return a;for(a=a.p_v.sym;a.type!=k.CLEF;)a=a.ts_prev;a.next&&a.next.type==k.KEY&&(a=a.next);return a.next&&a.next.type==k.METER?a.next:a}function hf(a,c,b,d,e,f,g){var l,k,m=.3;k=d-c;0>k&&(k=-k);l=b-a;40<l&&.7>k/l&&(m=.3+.002*(l-40),.7<m&&(m=.7));var n=.5*(a+b);l=.5*(c+d);var h,p;h=a+.45*(n+m*(a-n)-a);p=c+.45*(l+m*(c-
l)+f-c);n=b+.45*(n+m*(b-n)-b);m=d+.45*(l+m*(d-l)+f-d);l=.03*(b-a);k=2*e;f=.2+.001*(b-a);.6<f&&(f=.6);f*=e;e=D.v?D.scale:1;y=g?y+'<path class="stroke" stroke-dasharray="5,5" d="M':y+'<path class="fill" d="M';gb(a," ",c);y+="c"+((h-a)/D.scale).toFixed(2)+" "+((c-p)/e).toFixed(2)+" "+((n-a)/D.scale).toFixed(2)+" "+((c-m)/e).toFixed(2)+" "+((b-a)/D.scale).toFixed(2)+" "+((c-d)/e).toFixed(2);g||(y+="\n\tv"+(-f).toFixed(2)+"c"+((n-l-b)/D.scale).toFixed(2)+" "+((d+f-m-k)/e).toFixed(2)+" "+((h+l-b)/D.scale).toFixed(2)+
" "+((d+f-p-k)/e).toFixed(2)+" "+((a-b)/D.scale).toFixed(2)+" "+((d+f-c)/e).toFixed(2));y+='"/>\n'}function pe(a,c,b,d,e){for(var f=a,g,l,t,m,n,h,p,I,q;f.v!=c.v;)f=f.ts_next;switch(e&7){case k.SL_ABOVE:q=1;break;case k.SL_BELOW:q=-1;break;default:a:{for(q=f;;){if(q.multi){q=q.multi;break a}if(q==c)break;q=q.next}q=0}if(!q)a:{var u;if(f.grace&&0<f.stem)q=-1;else{for(q=f;;q=q.next){if(q.type==k.NOTE){if(!q.stemless){if(0>q.stem){q=1;break a}u=!0}22>q.notes[0].pit&&(t=!0)}if(q==c)break}q=u||t?-1:1}}}m=
1;u=f.st;t=!1;if(f!=c)for(g=f.next;;){if(g.type==k.NOTE||g.type==k.REST)m++,g.st!=u&&(t=!0,g.st<u&&(u=g.st));if(g==c)break;g=g.next}t&&N(2,f,"*** multi-staves slurs not treated yet");t=a.x;a.notes&&a.notes[0].shhd&&(t+=a.notes[0].shhd);if(a!=c)a=c.x,c.notes&&(a+=c.notes[0].shhd);else{for(g=c.ts_next;g&&g.type!=k.STAVES;g=g.ts_next);a=g?g.x:za}0<=b?b=3*(f.notes[b].pit-18)+5*q:(b=0<q?f.ymx+2:f.ymn-2,f.type==k.NOTE&&(0<q?0<f.stem&&(t+=5,f.beam_end&&-1<=f.nflags&&!f.in_tuplet&&(0<f.nflags?(t+=2,b=f.ys-
3):b=f.ys-6)):0>f.stem&&(--t,c.grace?b=f.y-8:f.beam_end&&-1<=f.nflags&&(!f.in_tuplet||f.ys<b+3)&&(0<f.nflags?(t+=2,b=f.ys+3):b=f.ys+6))));0<=d?d=3*(c.notes[d].pit-18)+5*q:(d=0<q?c.ymx+2:c.ymn-2,c.type==k.NOTE&&(0<q?0<c.stem&&(a+=1,c.beam_st&&-1<=c.nflags&&!c.in_tuplet&&(d=c.ys-6)):0>c.stem&&(a-=5,c.beam_st&&-1<=c.nflags&&!c.in_tuplet&&(d=c.ys+6))));f.type!=k.NOTE&&(b=d+1.2*q,t=f.x+.5*f.wr,t>a-12&&(t=a-12));c.type!=k.NOTE&&(d=f.type==k.NOTE?b+1.2*q:b,f!=c&&(a=c.x-.3*c.wl));3<=m&&(f.next.type!=k.BAR&&
f.next.x<t+48&&(0<q?(p=f.next.ymx-2,b<p&&(b=p)):(p=f.next.ymn+2,b>p&&(b=p))),c.prev&&c.prev.type!=k.BAR&&c.prev.x>a-48&&(0<q?(p=c.prev.ymx-2,d<p&&(d=p)):(p=c.prev.ymn+2,d>p&&(d=p))));h=(d-b)/(a-t);if(.5<h||-.5>h)h=.5<h?.5:-.5,0<h*q?b=d-h*(a-t):d=b+h*(a-t);p=d-b;8<p?p=8:-8>p&&(p=-8);g=p;0>g&&(g=-g);I=.5*g;g=.3*p;0<p*q?(a-=I,d-=g):(t+=I,b+=g);f.grace&&(t=f.x-.5*Fc);c.grace&&(a=c.x+1.5*Fc);I=0;h=(d-b)/(a-t);if(f!=c&&f.v==c.v){n=b-h*t;for(g=f.next;g!=c;g=g.next)if(g.st==u)switch(g.type){case k.NOTE:case k.REST:0<
q?(p=3*(g.notes[g.nhd].pit-18)+6,p<g.ymx&&(p=g.ymx),p-=h*g.x+n,p>I&&(I=p)):(p=3*(g.notes[0].pit-18)-6,p>g.ymn&&(p=g.ymn),p-=h*g.x+n,p<I&&(I=p));break;case k.GRACE:for(l=g.extra;l;l=l.next)0<q?(p=3*(l.notes[l.nhd].pit-18)+6,p<l.ymx&&(p=l.ymx),p-=h*l.x+n,p>I&&(I=p)):(p=3*(l.notes[0].pit-18)-6,p>l.ymn&&(p=l.ymn),p-=h*l.x+n,p<I&&(I=p))}b+=.45*I;d+=.45*I;I*=.65}m=3<m?(.08*(a-t)+12)*q:(.03*(a-t)+8)*q;0<q?(m<3*I&&(m=3*I),40<m&&(m=40)):(m>3*I&&(m=3*I),-40>m&&(m=-40));p=d-b;0>p&&(p=-p);0<q?m<.8*p&&(m=.8*p):
m>-.8*p&&(m=-.8*p);m*=r.slurheight;hf(t,b,a,d,q,m,e&k.SL_DOTTED);h=(d-b)/(a-t);n=b-h*t+.4*m;if(f.v==c.v)for(g=f;g!=c;g=g.next)g.st==u&&(p=h*g.x+n,g.ymx<p?g.ymx=p:g.ymn>p&&(g.ymn=p),g.next==c?(I=a,c.sl1&&(I-=5)):I=g.next.x,g!=f&&(t=g.x),I-=t,H(u,0<q,t,I,p));return(0<q?k.SL_ABOVE:k.SL_BELOW)|e&k.SL_DOTTED}function Ie(a,c){for(var b,d,e,f,g,l,t,m=a;;){if(!m||m==c){if(!e||!(m=e.next)||m==c)break;e=null}if(m.type==k.GRACE)e=m,m=m.extra;else if(m.type!=k.NOTE&&m.type!=k.REST&&m.type!=k.SPACE||!m.slur_start&&
!m.sl1)m=m.next;else{d=null;b=m.next;for(g=!1;;)if(b)if(b.type==k.GRACE)f=b,b=b.extra;else{if(b.type==k.BAR&&(":"==b.bar_type[0]||"|]"==b.bar_type||"[|"==b.bar_type||b.text&&"1"!=b.text[0])){d=b;break}if(b.type==k.NOTE||b.type==k.REST||b.type==k.SPACE){if(b.slur_end||b.sl2){d=b;break}if(b.slur_start||b.sl1){if(f){for(d=b;d.next;d=d.next);if(d.next=f.next)f.next.prev=d;d=null}Ie(b,c);f&&f.next&&(f.next.prev.next=null,f.next.prev=f)}if(b==c)break}b=b.next}else if(f)b=f.next,f=null;else{if(!e||g)break;
b=e.next;g=!0}if(!b)d=gf(m);else if(!d){m=b;if(m==c)break;continue}if(e){for(b=m;b.next;b=b.next);if(b.next=e.next)e.next.prev=b;e.slur_start=k.SL_AUTO}f&&(f.prev.next=f.extra,f.extra.prev=f.prev,f.slur_start=k.SL_AUTO);if(m.slur_start)l=m.slur_start&15,m.slur_start>>=4,b=-1;else{for(b=0;b<=m.nhd&&!m.notes[b].sl1;b++);l=m.notes[b].sl1&15;m.notes[b].sl1>>=4;m.sl1--}g=-1;t=0;if(d.type!=k.NOTE&&d.type!=k.REST&&d.type!=k.SPACE||!d.slur_end&&!d.sl2)d.type==k.BAR&&(":"==d.bar_type[0]||"|]"==d.bar_type||
"[|"==d.bar_type||d.text&&"1"!=d.text[0])||(t=1);else if(d.slur_end)d.slur_end--;else{for(g=0;g<=d.nhd&&!d.notes[g].sl2;g++);d.notes[g].sl2--;d.sl2--}l=pe(m,d,b,g,l);t&&(d.p_v.slur_start||(d.p_v.slur_start=0),d.p_v.slur_start<<=4,d.p_v.slur_start+=l);e&&e.next&&(e.next.prev.next=null,e.next.prev=e);f&&(f.prev.next=f,f.extra.prev=null);if(!m.slur_start&&!m.sl1){if(m==c)break;m=m.next}}}}function Je(a,c){var b,d,e,f,g,l,t,m,n,h,p,r,q,u;f=a.st;for(b=a;b;b=b.next)if(b.type!=k.NOTE&&b.type!=k.REST){if(b.type==
k.GRACE)for(e=b.extra;e;e=e.next)if(e.slur_start||e.sl1)g=!0}else{if(b.slur_start||b.slur_end||b.sl1||b.sl2)g=!0;b.st<f&&(f=b.st);if(0==c){if(b.tp1&&Je(b,1),b.te0)break}else if(b.te1)break}if(b){if(g){Ie(a,b);if(a.slur_start||a.sl1)return;for(d=a.next;d!=b;d=d.next)if(d.slur_start||d.slur_end||d.sl1||d.sl2)return;if(b.slur_end||b.sl2)return}0==c?(q=a.tp0,a.tp0=0,u=a.tq0):(q=a.tp1,a.tp1=0,u=a.tq1);if(1!=a.tf[0]){(e=a.tf[3])||(e=0<a.stem?k.SL_ABOVE:k.SL_BELOW);if(a==b)g=!0;else if(1==a.tf[1])g=!0,pe(a,
b,-1,-1,e);else if(2==a.tf[0]||a.type!=k.NOTE||b.type!=k.NOTE)g=!1;else{g=!0;for(d=a;;d=d.next){if(d.type!=k.NOTE&&d.type!=k.REST){if(d.type==k.GRACE||d.type==k.SPACE)continue;g=!1;break}if(d==b)break;if(d.beam_end){g=!1;break}}if(g&&!a.beam_st&&!a.beam_br1&&!a.beam_br2)for(d=a.prev;d;d=d.prev)if(d.type==k.NOTE||d.type==k.REST){d.nflags>=a.nflags&&(g=!1);break}if(g&&!b.beam_end)for(d=b.next;d;d=d.next)if(d.type==k.NOTE||d.type==k.REST){!d.beam_br1&&!d.beam_br2&&d.nflags>=b.nflags&&(g=!1);break}}if(g){if(1!=
a.tf[2]){n=(b.x+a.x)/2;p=a==b?0:(b.ys-a.ys)/(b.x-a.x);g=a.ys-p*a.x;r=p*n+g;e==k.SL_ABOVE?(h=T(f,1,n-4,8),h>r&&(g+=h-r),g+=2):(h=T(f,0,n-4,8),h<r&&(g+=h-r),g-=10);for(d=a;!(d.x>=n);d=d.next);0<a.stem*b.stem&&(n=0<a.stem?n+1.5:n-1.5);h=p*n+g;0==a.tf[2]?jf(n,h,q):jf(n,h,q+":"+u);e==k.SL_ABOVE?(h+=10,d.ymx<h&&(d.ymx=h),H(f,!0,n-3,6,h)):(d.ymn>h&&(d.ymn=h),H(f,!1,n-3,6,h))}}else{0!=a.tf[1]&&N(2,a,"'what' value of %%tuplets not yet coded");(e=a.tf[3])||(e=0<=a.multi?k.SL_ABOVE:k.SL_BELOW);if(e==k.SL_ABOVE){a.st==
b.st?g=m=v[f].topbar+4:(g=a.ymx,m=b.ymx);l=a.x-4;if(a.st==f){for(d=a;!d.dur;d=d.next);h=T(f,1,d.x-4,8);h>g&&(g=h);0<a.stem&&(l+=3)}if(b.st==f){for(d=b;!d.dur;d=d.prev);h=T(f,1,d.x-4,8);h>m&&(m=h)}b.dur>b.prev.dur?t=b.next?b.next.x-b.next.wl-5:za-6:(t=b.x+4,n=0<=b.stem?0:b.nhd,0<b.notes[n].shhd&&(t+=b.notes[n].shhd),b.st==f&&0<b.stem&&(t+=3.5));n=.5*(l+t);h=.5*(g+m);p=(m-g)/(t-l);g=3*(b.notes[b.nhd].pit-a.notes[a.nhd].pit)/(t-l);0<g?0>p?p=0:p>g&&(p=g):0<p?p=0:p<g&&(p=g);p*p<.1*.1&&(p=0);m=0;for(d=
a;d.dur&&d.st==f&&(r=h+(d.x-n)*p,g=T(f,1,d.x-4,8)+2,g-r>m&&(m=g-r)),d!=b;d=d.next);h+=m;g=h+p*(l-n);m=h+p*(t-n);h+=8;for(d=a;;d=d.next)if(d.st==f){r=h+(d.x-n)*p;d.ymx<r&&(d.ymx=r);if(d==b)break;H(f,!0,d.x,d.next.x-d.x,r)}else if(d==b)break}else{l=a.x-7;b.dur>b.prev.dur?t=b.next?b.next.x-b.next.wl-8:za-6:(t=b.x+2,0<b.notes[b.nhd].shhd&&(t+=b.notes[b.nhd].shhd));0<=a.stem&&(l+=2,t+=2);if(a.st==f){for(d=a;!d.dur;d=d.next);g=T(f,0,d.x-4,8)}else g=0;if(b.st==f){for(d=b;!d.dur;d=d.prev);m=T(f,0,d.x-4,8)}else m=
0;n=.5*(l+t);h=.5*(g+m);p=(m-g)/(t-l);g=3*(b.notes[0].pit-a.notes[0].pit)/(t-l);0<g?0>p?p=0:p>g&&(p=g):0<p?p=0:p<g&&(p=g);p*p<.1*.1&&(p=0);m=0;for(d=a;d.dur&&d.st==f&&(r=h+(d.x-n)*p,g=T(f,0,d.x-4,8),g-r<m&&(m=g-r)),d!=b;d=d.next);h+=m-10;g=h+p*(l-n);m=h+p*(t-n);h-=2;for(d=a;;d=d.next){if(d.st==f){if(d==b)break;r=h+(d.x-n)*p;d.ymn>r&&(d.ymn=r);H(f,!1,d.x,d.next.x-d.x,r)}if(d==b)break}}1==a.tf[2]?(f=m-g,e=e==k.SL_ABOVE?-3:3,n=(t-l)/D.scale,y+='<path class="stroke" d="m',gb(l," ",g+4+e),y+="v"+e.toFixed(2)+
"l"+n.toFixed(2)+" "+(-f).toFixed(2)+"v"+(-e).toFixed(2)+'"/>\n'):(b=l,d=g,l=t-l,t=m-g,h=e==k.SL_ABOVE,q=0==a.tf[2]?q.toString():q+":"+u,u=10*q.length,p=h?-3:3,V('<text style="font:italic 12px serif"\n\tx="X" y="Y" text-anchor="middle">A</text>\n',b+l/2,d+t/2,q),l/=D.scale,h||(d+=6),y+='<path class="stroke" d="m',gb(b," ",d),y+="v"+p.toFixed(2)+"m"+l.toFixed(2)+" "+(-t).toFixed(2)+"v"+(-p).toFixed(2)+'"/>\n<path class="stroke" stroke-dasharray="'+((l-u)/2).toFixed(2)+" "+u.toFixed(2)+'" d="m',gb(b,
" ",d-p),y+="l"+l.toFixed(2)+" "+(-t).toFixed(2)+'"/>\n',r=.5*(g+m),e==k.SL_ABOVE?H(f,!0,n-3,6,r+9):H(f,!1,n-3,6,r))}}}else N(1,a,"No end of tuplet in this music line"),0==c?a.tp0=0:a.tp1=0}function Td(a,c,b,d,e){var f,g,l,t,m,n,h,p,r;for(f=0;f<b.length;f++){l=b[f];m=a.notes[l].pit;t=d[f];n=2!=e?c.notes[t].pit:m;g=(a.notes[l].ti1&7)==k.SL_ABOVE?1:-1;p=a.x;r=a.notes[l].shhd;0<g?l<a.nhd&&m+1==a.notes[l+1].pit&&a.notes[l+1].shhd>r&&(r=a.notes[l+1].shhd):0<l&&m==a.notes[l-1].pit+1&&a.notes[l-1].shhd>
r&&(r=a.notes[l-1].shhd);p+=.6*r;h=c.x;2!=e&&(r=c.notes[t].shhd,0<g?t<c.nhd&&n+1==c.notes[t+1].pit&&c.notes[t+1].shhd<r&&(r=c.notes[t+1].shhd):0<t&&n==c.notes[t-1].pit+1&&c.notes[t-1].shhd<r&&(r=c.notes[t-1].shhd),h+=.6*r);t=a.st;switch(e){case 0:m==n||m&1||(m=n);break;case 3:g=-g;case 1:p=a.x;p>h-20&&(p=h-20);m=n;t=c.st;break;default:if(a!=c)h-=c.wl,c.type==k.BAR&&(h+=5);else{n=a.time+a.dur;for(h=a.ts_next;h&&!(h.time>n);h=h.ts_next);h=h?h.x:za}h<p+16&&(h=p+16)}20<h-p?(p+=3.5,h-=3.5):(p+=1.5,h-=
1.5);m=3*(m-18);n=(.04*(h-p)+10)*g;hf(p,v[t].y+m,h,v[t].y+m,g,n,a.notes[l].ti1&k.SL_DOTTED)}}function Gc(a,c,b){var d,e,f,g,l,t=[],m=[],n=[],h=a.nhd,p=a.time+a.dur;if(2==b){for(d=0;d<=h;d++)a.notes[d].ti1&&n.push(d);Td(a,c||a,n,n,b)}else{for(d=0;d<=h;d++)if(a.notes[d].ti1){e=-1;g=a.notes[d].opit||a.notes[d].pit;for(f=c.nhd;0<=f;f--){l=c.notes[f].opit||c.notes[f].pit;switch(l-g){case 1:case -1:a.notes[d].acc!=c.notes[f].acc&&(e=f);default:continue;case 0:e=f}break}0<=e?(t.push(d),m.push(e)):n.push(d)}Td(a,
c,t,m,b);if(n.length){for(c=a.ts_next;c&&c.time<p;)c=c.ts_next;for(;c&&c.time==p;){if(c.type==k.NOTE&&c.st==a.st){t.length=0;m.length=0;for(d=n.length;0<=--d;)for(e=n[d],g=a.notes[e].opit||a.notes[e].pit,f=c.nhd;0<=f;f--)if(l=c.notes[f].opit||c.notes[f].pit,l==g){t.push(e);m.push(f);n[d]=n.pop();break}if(0<t.length&&(Td(a,c,t,m,1==b?1:0),0==n.length))return}c=c.ts_next}0!=n.length&&N(1,a,"Bad tie")}}}function ug(a){var c,b,d;b=a.time+a.dur;d=a.st;for(c=a.ts_next;c;c=c.ts_next)if(c.st==d)if(c.time==
b){if(c.type==k.NOTE)return c}else if(c.time>b)return a}function vg(a){function c(a,b,c){if(a.type==k.GRACE)for(a=a.extra;a;a=a.next)a.ti1&&Gc(a,b,c);else Gc(a,b,c)}var b,d,e,f,g,l;for(b=a.sym;b;b=b.next){switch(b.type){case k.CLEF:case k.KEY:case k.METER:continue}break}l=a.s_rtie;for(d=b;d&&!d.dur&&d.type!=k.GRACE;d=d.next)d.type==k.BAR&&d.text&&("1"==d.text[0]?l=a.s_tie:a.s_tie=l);if(d){a.s_tie&&(a.s_tie.x=b.x+b.wr,b=a.s_tie,a.s_tie=null,b.st=d.st,b.ts_next=d.ts_next,b.time=d.time-b.dur,Gc(b,d,
1));for(;;){for(b=d;b&&!b.ti1;b=b.next)if(l&&b.type==k.BAR&&b.text)if("1"==b.text[0])l=null;else if("|"!=b.bar_type){for(d=b.next;d&&d.type!=k.NOTE;d=d.next);if(!d){b=null;break}e=C(l);e.x=b.x;e.next=d;e.st=d.st;e.time=d.time-e.dur;Gc(e,d,1)}if(!b)break;g=b.time+b.dur;for(d=b.next;d&&!d.dur;d=d.next)if(d.type==k.BAR&&d.text){if("1"!=d.text[0])break;l=b}if(d){if(d.type!=k.NOTE&&d.type!=k.BAR){N(1,b,"Bad tie");continue}if(d.time!=g){e=ug(b);if(e==b){N(1,b,"Bad tie");continue}d=e}}else{for(d=b.ts_next;d;d=
d.ts_next)if(d.st==b.st&&!(d.time<g)){if(d.time>g){d=null;break}if(d.dur)break}if(!d){c(b,null,2);a.s_tie=b;break}}for(e=b.ts_next;e;e=e.ts_next)if(e.st==b.st){if(e.time>g)break;e.type==k.CLEF&&(f=!0)}f||b.st!=d.st?(f=!1,g=.4*(d.x-b.x),e=d.x,d.x-=g,d.x>b.x+32&&(d.x=b.x+32),c(b,d,2),d.x=e,e=b.x,b.x+=g,b.x<d.x-24&&(b.x=d.x-24),Gc(b,d,3),b.x=e):c(b,d,d.type==k.NOTE?0:2)}a.s_rtie=l}}function wg(a){var c,b,d,e,f,g=[];for(d=B.nstaff;0<=d&&!B.st_print[d];d--);if(!(0>d)){for(b=0;b<x.length;b++)if(c=x[b],
c.sym&&(d=B.voices[b].st,B.st_print[d])){if(c.new_name){e=2;break}c.snm&&(e=1)}if(e){for(b=0;b<x.length;b++)if(c=x[b],c.sym&&(d=B.voices[b].st,B.st_print[d]&&(c.new_name&&delete c.new_name,c=2==e?c.nm:c.snm))){if(B.staves[d].flags&512)for(;!(B.staves[d].flags&256);)d--;else if(B.staves[d].flags&2)for(;!(B.staves[d].flags&1);)d--;g[d]=g[d]?g[d]+("\\n"+c):c}if(0!=g.length)for(va("voice"),a=.5*-a,d=0;d<g.length;d++)if(g[d]){e=g[d].split("\\n");f=v[d].y+.5*v[d].topbar*v[d].staffscale+9*(e.length-1)-.3*
K.curfont.size;b=d;if(B.staves[d].flags&256)for(;!(B.staves[b].flags&512);)b++;else if(B.staves[d].flags&1)for(;!(B.staves[b].flags&2);)b++;b!=d&&(f-=.5*(v[d].y-v[b].y));for(b=0;b<e.length;b++)c=e[b],fa(a,f,c,"c"),f-=18}}}}function xg(){var a,c,b,d,e,f,g,l,t;for(c=0;c<x.length;c++)t=x[c],1!=t.scale&&(t.scale_str='transform="scale('+t.scale.toFixed(2)+')"');for(c=0;c<=Q&&!K.st_print[c];c++);d=0;if(c>Q)c--,t=v[c];else for(t=v[c],a=0;256>a;a++)l=t.top[a],d<l&&(d=l);a=d;l=c;var m,n,h=0,p=0,q=v[l].topbar+
8,u=0,C=1,z=0;for(g=S;g;g=g.ts_next)g.type!=k.TEMPO||g.del||(e||(e=g),m=af(g),0==g.time&&(g.x=40),n=T(l,!0,g.x-16,m),n>q&&(q=n),z>=g.x-16&&!(u&C>>1)&&(u|=C),C<<=1,z=g.x-16+m);if(e)for(db(-1),va("tempo"),p=K.curfont.size+2+2,n=2-p,f=n-p,0!=u&&(p*=2),d<q+p&&(h=q+p-d),g=e;g;g=g.ts_next)if(g.type==k.TEMPO&&!g.del){if(w.anno_start||w.anno_stop)g.wl=16,g.wr=30,g.ymn=u&1?f:n,g.ymx=g.ymn+14,ob(g);bf(g,g.x-16,u&1?f:n);yb(g);u>>=1}q=v[l].topbar+8;for(g=S;g;g=g.ts_next)g.type==k.PART&&(b||(b=g,va("parts"),f=
K.curfont.size+2+2),m=Ka(g.text)[0],n=T(l,!0,g.x-10,m+3),q<n&&(q=n));if(b)for(db(-1),d<q+f+p&&(h=q+f+p-d),g=b;g;g=g.ts_next)if(g.type==k.PART){g.x-=10;if(w.anno_start||w.anno_stop)m=Ka(g.text)[0],g.wl=0,g.wr=m,g.ymn=-p-f,g.ymx=g.ymn+f,ob(g);r.partsbox?fe(g.x,2-p-f,g.text):fa(g.x,2-p-f,g.text);yb(g)}d=a+h;if(!K.st_print[c])return d;d*=t.staffscale;e=.5*r.staffsep+t.topbar*t.staffscale;d<e&&(d=e);d<t.ann_top&&(d=t.ann_top);t.y=-d;b=c;f=B.staves[b];for(c++;c<=Q;c++)if(t=v[c],K.st_print[c]){e=f.sep||
r.sysstaffsep;g=f.maxsep||r.maxsysstaffsep;f=0;if(t.staffscale==v[b].staffscale){for(a=0;256>a;a++)l=t.top[a]-v[b].bot[a],f<l&&(f=l);f*=t.staffscale}else for(a=0;256>a;a++)l=t.top[a]*t.staffscale-v[b].bot[a]*v[b].staffscale,f<l&&(f=l);e+=t.topbar*t.staffscale;f<e&&(f=e);g+=t.topbar*t.staffscale;f>g&&(f=g);d+=f;t.y=-d;b=c;f=B.staves[b]}for(a=e=0;256>a;a++)l=v[b].bot[a],e>l&&(e=l);e>t.ann_bot&&(e=t.ann_bot);e*=v[b].staffscale;for(c=0;c<=Q;c++)t=v[c],f=t.y,1!=t.staffscale&&(t.scale_str='transform="translate(0,'+
(ma-f).toFixed(2)+") scale("+t.staffscale.toFixed(2)+')"');if(0==e){for(c=Q;0<=c&&!K.st_print[c];c--);if(0>c)return d}f=-e;e=.5*r.staffsep;f<e&&(f=e);g=.5*r.maxstaffsep;f>g&&(f=g);return d+f}function yg(a){function c(){var a,b,c,d=0;for(a=0;a<=B.nstaff;a++)0>m[a]?n[a]=h[a]=0:(b=v[a].staffscale,c=v[a].topbar*b,b*=v[a].botbar,0==d&&(d=v[a].y+c),n[a]=v[a].y+b,h[a]=d-n[a],d=B.staves[a].flags&64?0:n[a])}function b(a,b,c){var d,e,f,g,l=0,k="",t=B.staves[a].stafflines,m=t.length;if(/[\[|]/.test(t))if(c-=
b,db(a),d=c/D.scale,uc&&uc.st_l==t&&uc.st_ws==d)ca(b,v[a].y,"stdef"+r.fullsvg);else{for(e=0;e<m;e++,l-=6)if("."!=t[e]){for(f=0;e<m;e++,l-=6,f-=6){switch(t[e]){case ".":case "-":continue;case g:k+="m-"+d.toFixed(2)+" "+f+"h"+d.toFixed(2);f=0;continue}void 0!=g&&(k+='"/>\n');g=t[e];k+='<path class="stroke"';"["==g&&(k+=' stroke-width="1.5"');k+=' d="m0 '+l+"h"+d.toFixed(2);f=0}k+='"/>\n'}l=v[a].y;uc||c!=nd()?V('<g transform="translate(X, Y)">\n'+k+"</g>\n",b,l):(uc={st_l:t,st_ws:d},e="stdef"+r.fullsvg,
jc[e]='<g id="'+e+'">\n'+k+"</g>",ca(b,l,e))}}var d,e,f,g,l,t,m=[],n=[],h=[];wg(a);for(d=0;d<=Q;d++)m[d]=B.st_print[d]?0:-1;c();ef(0);for(a=S;a;a=a.ts_next){if(t&&a.time!=t){for(d=t=0;d<=Q;d++)B.st_print[d]||(m[d]=-1);c()}switch(a.type){case k.STAVES:l=a.ts_prev.type==k.BAR?a.ts_prev.x:0;if(!l){for(d=a.ts_next;d&&d.time==a.time;d=d.ts_next){switch(d.type){case k.BAR:case k.CLEF:case k.KEY:case k.METER:l=d.x;continue}break}d||(l=za)}g=a.sy;for(d=0;d<=Q;d++)e=m[d],0>e?g.st_print[d]&&(m[d]=l?l:a.x-a.wl-
2):g.st_print[d]&&g.staves[d].stafflines==B.staves[d].stafflines||(l?(f=l,t=a.time):(f=a.x-a.wl-2,m[d]=-1),b(d,e,f),g.st_print[d]&&(m[d]=f));B=g;c();continue;case k.BAR:d=a.st;if(a.second||a.invis)break;tg(a,n[d],h[d]);break;case k.STBRK:if(0==B.voices[a.v].range&&14<a.xmx){for(l=f=0;l<x.length;l++)0<B.voices[l].range&&f++;for(d=a.ts_next;d&&d.type==k.STBRK;d=d.ts_next)f--;0==f&&ef(a.x)}if(d=a.prev){f=d.x;d.type!=k.BAR&&(f+=d.wr);d=a.st;e=m[d];if(0<=e){if(e>=f)continue;b(d,e,f)}m[d]=a.x}}}for(d=0;d<=
Q;d++)if(!t||B.st_print[d])e=m[d],0>e||e>=za||b(d,e,za)}function vc(a){return!a||!/^(0|n|f)/i.test(a)}function La(a,c){var b,d,e,f,g,l;if("-"==a[a.length-2]){d=a[a.length-1];if("1">d||"9"<d)return;a="u"+d+"font"}if(d=r[a])if(b=zb[d])e=b.name+"."+b.size,b["class"]&&(e+="."+b["class"]);d=c.indexOf("class=");0<=d&&(d+=6,f=c.indexOf(" ",d),l=0<f?c.slice(d,f):c.slice(d),c=c.replace(new RegExp("class="+l),"").trim());f=c.split(/\s+/);d=f[0];"*"==d&&b?d=b.name:(d=d.replace("Times-Roman","serif"),d=d.replace("Times",
"serif"),d=d.replace("Helvetica","sans-serif"),d=d.replace("Courier","monospace"));1<f.length?(g=f[f.length-1],"*"==g&&b&&(g=b.size)):b&&(g=b.size);g&&(f=d+"."+g,l&&(f+="."+l),f!=e&&(b=zb[f],b||((b=kf[d])||(b=1.1),b={name:d,size:Number(g),swfac:g*b},zb[f]=b),l&&(b["class"]=l),r[a]=f))}function qb(a){var c=parseFloat(a);switch(a.slice(-2)){case "CM":case "cm":c*=37.8;break;case "IN":case "in":c*=96;break;case "PT":case "pt":c*=.75}return c}function lf(a,c){a=a.slice(0,3);"ste"==a&&(a="stm");aa.set_v_param("pos",
a+" "+c)}function Ta(){ha.chg&&(ha.chg=!1,ha.lm=r.leftmargin-r.printmargin,0>ha.lm&&(ha.lm=0),ha.rm=r.rightmargin-r.printmargin,0>ha.rm&&(ha.rm=0),ha.width=r.pagewidth-2*r.printmargin,100>ha.width-ha.lm-ha.rm&&(N(0,void 0,"Bad staff width"),ha.width=ha.lm+ha.rm+150),Jb=ha.lm/r.scale)}function mf(a){var c=a.split("."),b=c[1],d,e;a=c[0].toLowerCase();c="";d=a.indexOf("-");0>d&&(d=a.length);e=a.indexOf("italic");0<=e&&(c+="italic ",e<d&&(d=e));e=a.indexOf("oblique");0<=e&&(c+="oblique ",e<d&&(d=e));
e=a.indexOf("bold");0<=e&&(c+="bold ",e<d&&(d=e));0<d&&(a=a.slice(0,d));return"font:"+c+b+"px "+a}function od(a){return a["class"]?"f"+a.fid+r.fullsvg+" "+a["class"]:"f"+a.fid+r.fullsvg}function rb(a){pd[a.fid]||(pd[a.fid]=!0,Vc+="\n.f"+a.fid+r.fullsvg+" {"+mf(a.name+"."+a.size)+"}")}function kc(a){a+="font";var c=zb[r[a]];c||(u(1,"Unknown font $1",a),c=K.curfont);c.fid||(c.fid=zg++);rb(c);return c}function hb(a){var c,b,d="",e;b=0;for(var f;;){e=a.indexOf("\\",b);if(0>e)break;d+=a.slice(b,e);c=a[++e];
if(!c)return d+"\\";switch(c){case "0":case "2":if("0"!=a[e+1])break;if(b=Ag[a[e+2]]){d+=b;b=e+3;continue}break;case "u":b=Number("0x"+a.slice(e+1,e+5));if(isNaN(b)||32>b){d+=a[++e]+"\u0306";b=e+1;continue}f=[b];if(55296<=b&&57343>=b){b=Number("0x"+a.slice(e+7,e+11));if(isNaN(b))break;f.push(b);b=e+11}else b=e+5;d+=String.fromCharCode.apply(null,f);continue;case "t":d+=" ";b=e+1;continue;default:if(b=Bg[a.slice(e,e+2)]){d+=b;b=e+2;continue}switch(c){case "`":d+=a[++e]+"\u0300";b=e+1;continue;case "'":d+=
a[++e]+"\u0301";b=e+1;continue;case "^":d+=a[++e]+"\u0302";b=e+1;continue;case "~":d+=a[++e]+"\u0303";b=e+1;continue;case "=":d+=a[++e]+"\u0304";b=e+1;continue;case "_":d+=a[++e]+"\u0305";b=e+1;continue;case ".":d+=a[++e]+"\u0307";b=e+1;continue;case '"':d+=a[++e]+"\u0308";b=e+1;continue;case "o":d+=a[++e]+"\u030a";b=e+1;continue;case "H":d+=a[++e]+"\u030b";b=e+1;continue;case "v":d+=a[++e]+"\u030c";b=e+1;continue;case "c":d+=a[++e]+"\u0327";b=e+1;continue;case ";":d+=a[++e]+"\u0328";b=e+1;continue}}d+=
"\\"+c;b=e+1}return d+a.slice(b)}function Cg(a){var c,b;w.read_file?2<Kb?u(1,"Too many include levels"):(Kb++,(c=w.read_file(a))?(b=C(q),Wc(a,c),q=b,Kb--):u(1,"Cannot read file '$1'",a)):u(1,"No read_file support")}function Wc(a,c,b,d){function e(){var a,e=c.indexOf("K:",b);if(0>e)return!1;e=c.indexOf("\n",e);if(q.select.test(c.slice(q.bol,e)))return!0;a=/\n\w*\n/;a.lastIndex=e;k=a.exec(c)?a.lastIndex:d;return!1}function f(a,b){0<=a.indexOf("%")&&(a=a.replace(/([^\\])%.*/,"$1").replace(/\\%/g,"%"));
a=a.replace(/\s+$/,"");return b&&0<=a.indexOf("\\")?hb(a):a}function g(){nf();L.W&&Dg(L.W);var a,b,c,d,e,f,g=r.infoname.split("\n"),l=g.length;for(a=0;a<l;a++)if(c=g[a][0],!(0>r.writefields.indexOf(c))&&(c=L[c])){d||(d=!0,va("history"),ta(r.textspace),e=K.curfont.size*r.lineskipfac);b=g[a].slice(2);'"'==b[0]&&(b=b.slice(1,-1));ta(e);fa(0,0,b);f=Ka(b)[0];c=c.split("\n");fa(f,0,c[0]);for(b=1;b<c.length;b++)ta(e),fa(f,0,c[b]);ta(.3*e);Tb();rb(K.curfont)}Lb();q.state=0;r=v;L=x;Ua=z;ya=w;Ub=D;lc=B;qd=
H;of();ha.chg=!0;Ta()}var l,k,m,n,h,p,I,v,x,z,w,D,B,H,y,G="\n";abc2svg.modules&&(abc2svg.modules.hooks.length||abc2svg.modules.g_hooks.length)&&Eg();q.file=c;q.fname=a;void 0==b&&(b=0);d||(d=c.length);for(;b<d;b=q.eol+1){k=c.indexOf("\n",b);if(0>k||k>d)k=d;for(q.eol=k;;){k--;switch(c[k]){case " ":case "\t":continue}break}k++;if(k==b)1==q.state?(q.istart=b,u(1,"Empty line in tune header - ignored")):2<=q.state&&(g(),q.select&&(k=c.indexOf("\nX:",q.eol),0>k&&(k=d),q.eol=k));else{q.istart=q.bol=b;q.iend=
k;q.line.index=0;n=c[b];a=c[b+1];if("%"==n){if(0>q.prefix.indexOf(a))continue;"a"==c[b+2]&&"b"==c[b+3]&&"c"==c[b+4]&&" "==c[b+5]?(b+=6,n=c[b],a=c[b+1]):y=!0}else"I"==n&&":"==a&&(y=!0);if(y){y=!1;for(b+=2;;){switch(c[b]){case " ":case "\t":b++;continue}break}if((l=c.slice(b,k))&&"%"!=l[0]){p=l.split(/\s+/,2);p[0]||p.shift();switch(p[0]){case "abcm2ps":case "ss-pref":q.prefix=p[1];continue;case "abc-include":Cg(p[1]);continue}if("begin"==p[0].slice(0,5))I=p[0].substr(5),m="\n"+n+a+"end"+I,l=c.indexOf(m,
k),0>l?(u(1,"No $1 after %%$2",m.slice(1),p[0]),q.eol=d):(aa.do_begin_end(I,p[1],c.slice(k+1,l).replace(new RegExp("^"+n+a,"gm"),"")),q.eol=c.indexOf("\n",l+6),0>q.eol&&(q.eol=d));else{switch(p[0]){case "select":if(0!=q.state){u(1,"%%select ignored");continue}n=f(l.slice(7),!1);'"'==n[0]&&(n=n.slice(1,-1));if(!n){delete q.select;continue}n=n.replace(/\(/g,"\\(");n=n.replace(/\)/g,"\\)");q.select=new RegExp(n,"m");continue;case "tune":u(1,"%%tune not treated yet");continue;case "voice":if(0!=q.state){u(1,
"%%voice ignored");continue}n=f(l.slice(6),!1);if(!n){q.cur_tune_opts?q.cur_tune_opts.voice_opts=null:q.voice_opts=null;continue}if("end"==n)continue;q.cur_tune_opts?(q.cur_tune_opts.voice_opts||(q.cur_tune_opts.voice_opts={}),m=q.cur_tune_opts.voice_opts):(q.voice_opts||(q.voice_opts={}),m=q.voice_opts);for(m[n]=[];;){b=++k;if("%"!=c[b])break;k=c.indexOf("\n",k);if(c[b+1]==a){b+=2;l=0>k?c.slice(b):c.slice(b,k);p=l.match(/\S+/);switch(p[0]){default:m[n].push(f(l,!0));continue;case "score":case "staves":case "tune":case "voice":b-=
2}break}}q.eol=b-1;continue}aa.do_pscom(f(l,!0))}}}else if(":"==a&&/[A-Za-z+]/.test(n)){for(b+=2;;){switch(c[b]){case " ":case "\t":b++;continue}break}l=f(c.slice(b,k),!0);if("+"==n){if(!h){u(1,"+: without previous info field");continue}G=" ";n=h}switch(n){case "X":if(0!=q.state){u(1,P.ignored,n);continue}if(q.select&&!e()){k=c.indexOf("\nX:",q.eol);0>k&&(k=d);q.eol=k;continue}v=C(r);r.pos=C(r.pos);x=C(L,1);z=C(Ua);w=C(ya);D=C(Ub,1);B=C(lc);H=new Int8Array(qd);L.X=l;q.state=1;continue;case "T":switch(q.state){case 0:continue;
case 1:L.T=void 0==L.T?l:L.T+("\n"+l);continue}a=Ab("title");a.text=l;continue;case "K":switch(q.state){case 0:continue;case 1:L.K=l}rd(n,l);continue;case "W":if(0==q.state||0>r.writefields.indexOf(n))break;L.W=void 0==L.W?l:L.W+(G+l);break;case "m":if(2<=q.state){u(1,P.ignored,n);continue}if((!r.sound||"play"!=r.sound)&&0>r.writefields.indexOf(n))break;p=l.match(/(.*?)[= ]+(.*)/);if(!p||!p[2]){u(1,P.bad_val,"m:");continue}lc[p[1]]=p[2];qd[p[1].charCodeAt(0)]=1;break;case "s":if(3!=q.state||0>r.writefields.indexOf(n))break;
Fg(l," "==G);break;case "w":if(3!=q.state||0>r.writefields.indexOf(n))break;Gg(l," "==G);if("\\"==l.slice(-1)){G=" ";h=n;continue}break;case "|":if(2>q.state)continue;q.line.buffer=f(c.slice(b,k),!0);pf();continue;default:if(0<="ABCDFGHOSZ".indexOf(n)){if(2<=q.state){u(1,P.ignored,n);continue}L[n]=L[n]?L[n]+(G+l):l}else{rd(n,l);continue}}G="\n";h=n}else h=void 0,2>q.state||(q.line.buffer=f(c.slice(b,k),!0),pf())}}Kb||(2<=q.state&&g(),q.state=0)}function qf(a){var c,b,d,e,f,g=a.stem;e=a.nhd;if(0!=
e){f=.78*rf[a.head];a.grace&&(f*=.5);0<=g?(c=1,b=e+1,e=a.notes[0].pit):(f=-f,c=e-1,b=-1,e=a.notes[e].pit);for(var l=!1,t=0;c!=b;c+=g){d=a.notes[c].pit-e;e=a.notes[c].pit;if(0==d){if(l){d=a.notes[c].shhd=a.notes[c-g].shhd+f;t<d&&(t=d);continue}if(c+g!=b&&e+g==a.notes[c+g].pit){a.notes[c].shhd=-f;t<-f&&(t=-f);continue}}0>d&&(d=-d);if(3<d||2<=d&&a.head!=k.SQUARE)l=!1;else if(l=!l)a.notes[c].shhd=f,t<f&&(t=f)}a.xmx=t}}function sf(a,c){var b,d,e,f,g,l,k=a.length;for(b=k-1;0<=--b;)if((e=a[b].shhd)&&!(0<
e))for(e=c-e,g=a[b].pit,d=k;0<=--d;)if(a[d].acc){f=a[d].pit;if(f<g-3)break;!(f>g+3)&&a[d].shac<e&&(a[d].shac=e)}for(b=k;0<=--b;)if(l=a[b].acc){e=a[b].shac;e||(e=a[b].shhd,e=0>e?c-e:c);g=a[b].pit;for(d=k;--d>b;)a[d].acc&&(f=a[d].pit,!(f>=g+4&&(f>g+4||0>l||0>a[d].acc))&&e>a[d].shac-6&&(f=a[d].shac+7,f>e&&(e=f)));a[b].shac=e}}function Hc(a,c){c?(a.ts_next=c,a.ts_prev=c.ts_prev,a.ts_prev&&(a.ts_prev.ts_next=a),c.ts_prev=a):a.ts_next=a.ts_prev=null}function pb(a){a.next&&(a.next.prev=a.prev);a.prev?a.prev.next=
a.next:a.p_v.sym=a.next;a.ts_next&&(a.seqst&&!a.ts_next.seqst&&(a.ts_next.seqst=!0,a.ts_next.shrink=a.shrink,a.ts_next.space=a.space),a.ts_next.ts_prev=a.ts_prev);a.ts_prev&&(a.ts_prev.ts_next=a.ts_next);S==a&&(S=a.ts_next);Sb==a&&(Sb=a.ts_next)}function tf(a,c,b){var d=a.p_v,e=a.st;a.type==k.BAR&&a.prev&&a.prev.type==k.BAR&&(a=a.prev);d.last_sym=a.prev;d.last_sym||(d.sym=null);d.time=a.time;d=Xc(d,k.CLEF);d.next=a;a.prev=d;d.clef_type=c;d.clef_line=b;d.st=e;d.clef_small=!0;delete d.second;d.notes=
[];d.notes[0]={pit:a.notes[0].pit};for(d.nhd=0;!a.seqst;)a=a.ts_prev;Hc(d,a);d.ts_prev.type!=k.CLEF&&(d.seqst=!0);return d}function uf(a,c,b){var d,e,f,g=0,l=0,k=0,m=0;for(f=0;f<a.a_gch.length;f++)switch(d=a.a_gch[f],d.type){default:e=-d.x;e>g&&(g=e);d=d.w+2-e;d>l&&(l=d);break;case "<":d=d.w+c;d>k&&(k=d);break;case ">":d=d.w+a.wr,d>m&&(m=d)}if(c=a.prev){if(c.a_gch)for(c=a.ts_prev;;c=c.ts_prev){if(c==a.prev){b<g&&(b=g);break}c.seqst&&(g-=c.shrink)}0!=k&&b<k&&(b=k)}if(c=a.next){if(c.a_gch)for(c=a.ts_next;;c=
c.ts_next){if(c==a.next){a.wr<l&&(a.wr=l);break}c.seqst&&(l-=8)}0!=m&&a.wr<m&&(a.wr=k)}return b}function vf(a,c){var b,d,e;sd>=k.BLEN/2?c=sd>=k.BLEN?c/4:c/2:!a.next&&c>=k.BLEN&&(c/=2);b=c>=k.BLEN/4?c<k.BLEN/2?5:c<k.BLEN?6:c<2*k.BLEN?7:c<4*k.BLEN?8:9:c>=k.BLEN/8?4:c>=k.BLEN/16?3:c>=k.BLEN/32?2:c>=k.BLEN/64?1:0;d=c-(k.BLEN/16/8<<b);e=Bb[b];0!=d&&(0>d?e=Bb[0]*c/(k.BLEN/16/8):(9<=b&&(b=8),e+=(Bb[b+1]-Bb[b])*d/c));return e}function Ic(a){var c,b,d=a.ts_prev.time;c=a.time-d;if(0==c){switch(a.type){case k.MREST:return a.wl}return 0}if(a.ts_prev.type==
k.MREST)return 71;for(b=vf(a,c);!a.dur;){switch(a.type){case k.BAR:return.9*b-7;case k.CLEF:return b-a.wl-a.wr;case k.BLOCK:case k.PART:case k.REMARK:case k.STAVES:case k.TEMPO:a=a.ts_next;if(!a)return b;continue}break}a.beam_st||(b*=.9);if(a.type==k.NOTE&&-1<=a.nflags&&0<a.stem){var e=!0;for(c=a.ts_prev;c&&c.time==d;c=c.ts_prev)if(c.type==k.NOTE&&(-1>c.nflags||0<c.stem)){e=!1;break}if(e){for(c=a.ts_next;c&&c.time==a.time;c=c.ts_next)if(c.type==k.NOTE&&(-1>c.nflags||0>c.stem)){e=!1;break}e&&(b*=.9)}}return b}
function wf(a){var c={type:k.BAR,bar_type:"|",fname:a.fname,istart:a.istart,iend:a.iend,v:a.v,p_v:a.p_v,st:a.st,dur:0,seqst:!0,invis:!0,time:a.time+a.dur,nhd:0,notes:[{pit:a.notes[0].pit}],wl:0,wr:0,prev:a,ts_prev:a,shrink:a.wr+3};return a.next=a.ts_next=c}function Jc(a){a.type=k.REST;delete a.in_tuplet;delete a.sl1;delete a.sl2;delete a.a_dd;delete a.a_gch;a.slur_start=a.slur_end=0}function Hg(a){var c,b,d,e,f,g=a.repeat_n,l=a.repeat_k,t=a.st,m=a.v;a.repeat_n=0;if(0>g){d=g=-g;for(b=a.prev;b;b=b.prev)if(!b.dur){if(b.type==
k.BAR){N(1,b,"Bar in repeat sequence");return}}else if(0>=--d)break;if(b){f=a.time-b.time;d=l*g;for(c=a;c;c=c.next)if(!c.dur){if(c.type==k.BAR){N(1,c,"Bar in repeat sequence");return}}else if(0>=--d)break;if(c&&c.next){for(c=a.prev;c!=b;c=c.prev)if(c.type==k.NOTE){c.beam_end=!0;break}for(e=l;0<=--e;){d=g;a.dur&&d--;for(c=a.ts_next;0<d;)c.st==t&&(pb(c),c.v==m&&c.dur&&d--),c=c.ts_next;Jc(a);a.dur=a.notes[0].dur=f;a.rep_nb=-1;a.beam_st=!0;aa.set_width(a);a.seqst&&(a.space=Ic(a));a.head=k.SQUARE;for(a=
c;a&&(a.st!=t||a.v!=m||!a.dur);a=a.ts_next);}}else N(1,a,P.not_enough_n)}else N(1,a,P.not_enough_n)}else{d=g;for(c=a.prev.prev;c&&(c.type!=k.BAR&&c.time!=S.time||!(0>=--d));c=c.prev);if(c){f=a.time-c.time;d=1==g?l:g;for(c=a;c&&!(c.type==k.BAR&&0>=--d);c=c.next);if(c){d=l;if(2==g&&1<d){c=c.next;if(!c){N(1,a,P.not_enough_m);return}c.repeat_n=g;c.repeat_k=--d}f/=g;if(2==g){b=a;for(c=a.ts_next;;c=c.ts_next)if(c.st==t){if(c.v==m&&c.type==k.BAR)break;pb(c)}Jc(b);b.dur=b.notes[0].dur=f;b.invis=!0;b.seqst&&
(b.space=Ic(b));c.bar_mrep=2;c.seqst&&(c.space=Ic(c));b=c.next;for(c=b.ts_next;;c=c.ts_next)if(c.st==t){if(c.v==m&&c.type==k.BAR)break;pb(c)}Jc(b);b.dur=b.notes[0].dur=f;b.invis=!0;aa.set_width(b);b.seqst&&(b.space=Ic(b));c.seqst&&(c.space=Ic(c))}else for(b=a,e=l;0<=--e;){for(c=b.ts_next;;c=c.ts_next)if(c.st==t){if(c.v==m&&c.type==k.BAR)break;pb(c)}Jc(b);b.dur=b.notes[0].dur=f;b.beam_st=!0;b.seqst&&(b.space=Ic(b));c.seqst&&(c.space=Ic(c));if(1==l){b.rep_nb=1;break}b.rep_nb=l-e+1;b=c.next}}else N(1,
a,P.not_enough_m)}else N(1,a,P.not_enough_m)}}function ge(a){function c(a){if(r.custos&&1==x.length)a:{for(var b,c,d=a;d.type!=k.NOTE;)if(d=d.next,!d)break a;b=a.p_v;b.last_sym=a.prev;b.time=a.time;b=Xc(b,k.CUSTOS);b.next=a;a.prev=b;Hc(b,a);b.seqst=!0;b.shrink=a.shrink;12>b.shrink&&(b.shrink=12);b.space=d.space;b.wl=0;b.wr=4;b.nhd=d.nhd;b.notes=[];for(c=0;c<a.notes.length;c++)b.notes[c]={pit:d.notes[c].pit,shhd:0,dur:k.BLEN/4};b.stemless=!0}for(d=a.ts_next;d;d=d.ts_next)if(d.seqst){a.nl=!0;break}}
function b(a){if(!a.next)return c(a),a;for(a=a.ts_next;a;a=a.ts_next)if(a.seqst){c(a);break}return a}var d;if(a.eoln&&!r.keywarn&&!r.timewarn)return b(a);switch(a.type){case k.CLEF:case k.BAR:case k.STAVES:break;case k.KEY:if(r.keywarn&&!a.k_none)break;return b(a);case k.METER:if(r.timewarn)break;return b(a);case k.GRACE:if(a=a.next,!a)return a;default:return b(a)}for(;a;a=a.ts_prev)if(a.seqst){switch(a.type){case k.KEY:case k.CLEF:case k.METER:continue}break}for(d=0;;a=a.ts_next){if(!a)return a;
if(a.seqst){if(0>d)break;switch(a.type){case k.STAVES:if(a.ts_prev&&a.ts_prev.type==k.BAR)break;for(;a.ts_next&&(0==eb[a.ts_next.type]||a.ts_next.type==k.CLEF);)a=a.ts_next;if(!a.ts_next||a.ts_next.type!=k.BAR)continue;a=a.ts_next;case k.BAR:if(d)break;d=1;continue;case k.STBRK:a.stbrk_forced?d=-1:pb(a);continue;case k.METER:if(!r.timewarn)break;continue;case k.CLEF:if(d)break;continue;case k.KEY:if(!r.keywarn||a.k_none)break;continue;default:if(!d||a.prev&&a.prev.type==k.GRACE)continue}break}}c(a);
return a}function xf(){var a=x[0];aa.set_width(a.clef);aa.set_width(a.key);aa.set_width(a.meter);return[a.clef.wl+a.clef.wr+a.key.wl+a.key.wr,a.meter.wl+a.meter.wr]}function yf(a,c){var b,d,e=0,f=1-r.maxshrink;do{a.seqst&&(b=a.shrink,e=(d=a.space)<b?e+b:e+(b*r.maxshrink+d*f),a.x=e);if(a==c)break;a=a.ts_next}while(a);return e}function zf(a,c,b,d){for(var e,f,g,l,t,m,h;c&&!c.eoln;c=c.ts_next);for(m=yf(a,c)+d;;){g=Math.ceil(m/b);if(1>=g)return c&&(c=ge(c)),c;f=e=a;l=a.x-a.shrink-d;t=l+b;d=l+m/g;l+=m/
g*r.breaklimit;for(a=a.ts_next;a!=c&&!(a.x&&(a.type==k.BAR&&(f=a),a.x>=l));a=a.ts_next);if(a==c)return c&&(c=ge(c)),c;h=!1;for(g=null;a!=c;a=a.ts_next)if(l=a.x){if(l>t)break;if(a.type==k.BAR)if(l<d)g=a;else if(!g||a.x<d)g=a;else{if(g>d)break;if(d-g.x<a.x-d)break;g=a;break}}g&&(a=g,h=!0);if(!h){var q=0,p=f.time;t-=8;a=f;for(g=null;a!=c;a=a.ts_next)if(a.beam_st&&q++,a.beam_end&&0<q&&q--,l=a.x){if(l+a.wr>=t)break;if(!q&&!a.in_tuplet)if(0==(a.time-p)%(k.BLEN/4))g=a;else if(!g||a.x<d)g=a;else{if(g>d)break;
if(d-g.x<a.x-d)break;g=a;break}}g&&(a=g,h=!0)}if(!h){for(g=a=f;a!=c;a=a.ts_next)if(l=a.x)if(a.x<d)g=a;else{if(g>d)break;if(d-g.x<a.x-d)break;g=a;break}a=g}if(a.nl)for(N(0,a,"Line split problem - adjust maxshrink and/or breaklimit"),g=2,a=a.ts_next;a!=c&&!(a.x&&0>=--g);a=a.ts_next);a=ge(a);if(!a||c&&a.time>=c.time)break;m-=a.x-e.x;d=0}return a}function Ud(a){switch(a.type){case k.CLEF:if(a.second||a.invis){a.ymx=a.ymn=12;break}a.y=6*(a.clef_line-1);switch(a.clef_type){default:a.ymx=a.y+28;a.ymn=a.y-
14;break;case "c":a.ymx=a.y+13;a.ymn=a.y-11;break;case "b":a.ymx=a.y+7,a.ymn=a.y-12}a.clef_small&&(a.ymx-=2,a.ymn+=2);26>a.ymx&&(a.ymx=26);-1<a.ymn&&(a.ymn=-1);a.clef_octave&&(0<a.clef_octave?a.ymx+=12:a.ymn-=12);break;case k.KEY:a.ymx=2<a.k_sf?34:0<a.k_sf?30:26;a.ymn=-2;break;default:a.ymx=24,a.ymn=0}}function Ke(a,c,b){var d,e,f,g;f=12;e=20;for(d=c;d&&(d.type!=k.STAVES||d==c);d=d.ts_next)if(d.st==a)if(d.type!=k.NOTE){if(d.type==k.CLEF){if("a"!=d.clef_type)break;pb(d)}}else d.notes[0].pit<e?e=d.notes[0].pit:
d.notes[d.nhd].pit>f&&(f=d.notes[d.nhd].pit);if(19<=e||13<=e&&"b"!=b)return"t";if(13>=f||19>=f&&"t"!=b)return"b";"a"==b&&(b=16<=(f+e)/2?"t":"b");f=b;var l=d,t=null;for(d=c;d!=l&&(d.type!=k.STAVES||d==c);d=d.ts_next)if(d.st==a&&d.type==k.NOTE){g=d.time;if("t"==f){if(12<d.notes[0].pit||20<d.notes[d.nhd].pit){20<d.notes[0].pit&&(t=d);continue}if((e=d.ts_prev)&&e.time==g&&e.st==a&&e.type==k.NOTE&&19<=e.notes[0].pit)continue;if((e=d.ts_next)&&e.st==a&&e.time==g&&e.type==k.NOTE&&19<=e.notes[0].pit)continue}else{if(12>
d.notes[0].pit||20>d.notes[d.nhd].pit){12>d.notes[d.nhd].pit&&(t=d);continue}if((e=d.ts_prev)&&e.time==g&&e.st==a&&e.type==k.NOTE&&13>=e.notes[0].pit)continue;if((e=d.ts_next)&&e.st==a&&e.time==g&&e.type==k.NOTE&&13>=e.notes[0].pit)continue}if(t){g=d;for(e=d.ts_prev;e!=t;e=e.ts_prev)if(e.st==a){if(e.type==k.BAR&&e.v==d.v){g=e;break}e.type==k.NOTE&&e.beam_st&&!e.p_v.second&&(g=e)}g.time==t.time?t=d:(t=d,f="t"==f?"b":"t",e=tf(g,f,"t"==f?2:4),e.clef_auto=!0)}else f=b="t"==f?"b":"t",t=d}return b}function Af(a,
c,b){var d={type:a,fname:b.fname,v:c.v,p_v:c,st:c.st,time:b.time,next:c.last_sym.next};d.next&&(d.next.prev=d);c.last_sym.next=d;d.prev=c.last_sym;c.last_sym=d;Hc(d,b);d.ts_prev.type!=a&&(d.seqst=!0);b.type==a&&d.v!=b.v&&(delete b.seqst,b.shrink=0);return d}function Ig(){var a,c,b,d,e,f;f=x.length;for(e=0;e<f;e++)if(!(0>B.voices[e].range)){a=x[e];a.second=B.voices[e].second;a.last_sym=a.sym;for(b=B.voices[e].st;b<Q&&!B.st_print[b];)b++;a.st=b}for(d=S;d.type==k.CLEF;)e=d.v,0<=B.voices[e].range&&!B.voices[e].second&&
(delete d.clef_small,a=d.p_v,a.last_sym=a.sym=d),d=d.ts_next;for(e=0;e<f;e++)a=x[e],a.sym&&a.sym.type==k.CLEF||0>B.voices[e].range||B.voices[e].second&&!a.bar_start||(b=B.voices[e].st,v[b]&&v[b].clef&&(c=C(v[b].clef),c.v=e,c.p_v=a,c.st=b,c.time=S.time,c.prev=null,c.next=a.sym,c.next&&(c.next.prev=c),a.sym=c,a.last_sym=c,c.ts_next=d,c.ts_prev=d?d.ts_prev:null,c.ts_prev?(c.ts_prev.ts_next=c,delete c.seqst):(S=c,c.seqst=!0),d&&(d.ts_prev=c,d.type==k.CLEF&&delete d.seqst),delete c.clef_small,c.second=
B.voices[e].second,B.st_print[b]||(c.invis=!0)));for(e=0;e<f;e++)if(!(0>B.voices[e].range||B.voices[e].second)&&B.st_print[B.voices[e].st])if(a=x[e],d&&d.v==e&&d.type==k.KEY)a.last_sym=d,d.k_old_sf=d.k_sf,d=d.ts_next;else if(b=a.key,b.k_sf||b.k_a_acc)c=Af(k.KEY,a,d),c.k_sf=b.k_sf,c.k_old_sf=b.k_sf,c.k_none=b.k_none,c.k_a_acc=b.k_a_acc,c.istart=b.istart,c.iend=b.iend,b.k_bagpipe&&(c.k_bagpipe=b.k_bagpipe,"p"==c.k_bagpipe&&(c.k_old_sf=3));if(Vd&1){for(e=0;e<f;e++)a=x[e],b=a.meter,0>B.voices[e].range||
B.voices[e].second||!B.st_print[B.voices[e].st]||0==b.a_meter.length||(d&&d.v==e&&d.type==k.METER?(a.last_sym=d,d=d.ts_next):(c=Af(k.METER,a,d),c.istart=b.istart,c.iend=b.iend,c.wmeasure=b.wmeasure,c.a_meter=b.a_meter));Vd&=-2}for(e=0;e<f;e++)a=x[e],b=a.bar_start,a.bar_start=null,d&&d.v==e&&d.type==k.BAR?(a.last_sym=d,d=d.ts_next):!b||0>B.voices[e].range||!B.st_print[B.voices[e].st]||(b.next=a.last_sym.next,b.next&&(b.next.prev=b),a.last_sym.next=b,b.prev=a.last_sym,a.last_sym=b,Hc(b,d),b.time=S.time,
b.ts_prev.type!=b.type&&(b.seqst=!0),d&&d.type==b.type&&b.v!=d.v&&delete d.seqst);aa.set_pitch(d);for(c=d;c;c=c.ts_next)if(c.seqst){for(c=c.ts_next;c&&!c.seqst;c=c.ts_next);break}for(;d;){if(d.seqst){do d=d.ts_next;while(d&&!d.seqst);break}d=d.ts_next}for(c=S;;){b=c;f=0;do{aa.set_width(c);e=c.wl;for(a=c.prev;a;a=a.prev)if(0!=eb[a.type]){e+=a.wr;break}e>f&&(f=e);c=c.ts_next}while(c!=d&&!c.seqst);b.shrink=f;b.space=0;if(c==d)break}}function Le(a){var c,b,d,e,f,g=x.length,l=0;for(c=0;c<g;c++)if(b=x[c],
!(0>B.voices[c].range)&&(d=(a||b.new_name)&&b.nm?b.nm:b.snm))for(f||(f=kc("voice"),va(f)),b=0;;){e=d.indexOf("\\n",b);b=0>e?Ka(d.slice(b)):Ka(d.slice(b,e));b=b[0];b>l&&(l=b);if(0>e)break;b=e+1}f&&(l+=4*hc(" ")*f.swfac);b=.5;for(c=0;c<=B.nstaff;c++){if(B.staves[c].flags&1280){b=12;break}B.staves[c].flags&5&&(b=6)}l+=b;a&&(l+=r.indent);return l}function Jg(a,c){var b,d,e,f,g,l,t,m,h;if(a.shiftunison&&3<=a.shiftunison||(e=a.dur)>=k.BLEN||(f=c.dur)>=k.BLEN||a.stemless&&c.stemless||a.dots!=c.dots&&(a.shiftunison&&
a.shiftunison&1||0!=a.dots*c.dots)||0<a.stem*c.stem)return!1;b=d=0;if(a.notes[0].pit>c.notes[0].pit){if(0>a.stem)return!1;for(;c.notes[d].pit!=a.notes[0].pit;)if(++d>c.nhd)return!1}else if(a.notes[0].pit<c.notes[0].pit){if(0>c.stem)return!1;for(;c.notes[0].pit!=a.notes[b].pit;)if(++b>a.nhd)return!1}if(c.notes[d].acc!=a.notes[b].acc)return!1;g=b;t=d;m=a.notes[b].shhd;h=c.notes[d].shhd;do{b++;d++;if(b>a.nhd)break;if(d>c.nhd)break;if(c.notes[d].acc!=a.notes[b].acc)return!1;m<a.notes[b].shhd&&(m=a.notes[b].shhd);
h<c.notes[d].shhd&&(h=c.notes[d].shhd)}while(c.notes[d].pit==a.notes[b].pit);if(b<=a.nhd){if(d<=c.nhd||0<c.stem)return!1}else if(d<=c.nhd&&0<a.stem)return!1;l=b;b=d;d=0;if(e!=f)if(e<f&&(e=f,f=a.dur),e<k.BLEN/2)0<c.dots?d=2:0<a.dots&&(d=1);else if(f<k.BLEN/4){if(a.shiftunison&&a.shiftunison&2)return!1;d=c.dur>=k.BLEN/2?2:1}else return!1;0==d&&(d=a.p_v.scale<c.p_v.scale?2:1);if(1==d){for(d=t;d<b;d++)c.notes[d].invis=!0,delete c.notes[d].acc;for(d=0;d<=c.nhd;d++)c.notes[d].shhd+=m}else{for(b=g;b<l;b++)a.notes[b].invis=
!0,delete a.notes[b].acc;for(b=0;b<=a.nhd;b++)a.notes[b].shhd+=h}return!0}function Me(a){var c,b,d,e=qe[a.head],f=e,g=[];for(b=0;96>b;b++)g.push(-100);if(-2<a.nflags)for(0<a.stem?(f=-f,b=2*a.notes[0].pit,c=2*(Math.ceil((a.ymx-2)/3)+18)):(b=2*(Math.ceil((a.ymn+2)/3)+18),c=2*a.notes[a.nhd].pit),0>b&&(b=0),96<=c&&(c=95);b<=c;)g[b++]=f;d=a.notes[0<a.stem?0:a.nhd].shhd;for(c=0;c<=a.nhd;c++)f=-a.notes[c].shhd+e+d,b=2*a.notes[c].pit,0>b?b=0:95<=b&&(b=94),f>g[b]&&(g[b]=f),a.head!=k.SQUARE&&--f,f>g[b-1]&&
(g[b-1]=f),f>g[b+1]&&(g[b+1]=f);return g}function Ne(a){var c,b,d,e=qe[a.head],f=e,g=0<a.nflags&&a.beam_st&&a.beam_end,l=[];for(b=0;96>b;b++)l.push(-100);if(-2<a.nflags)for(0>a.stem?(f=-f,b=2*(Math.ceil((a.ymn+2)/3)+18),c=2*a.notes[a.nhd].pit,d=b+4):(b=2*a.notes[0].pit,c=2*(Math.ceil((a.ymx-2)/3)+18)),0>b&&(b=0),96<c&&(c=96);b<c;)l[b++]=f;if(g)if(0<a.stem)for(b=0==a.xmx?2*a.notes[a.nhd].pit:2*a.notes[0].pit,b+=4,0>b&&(b=0);96>b&&b<=c-4;b++)l[b]=11;else for(b=d,0>b&&(b=0);96>b&&b<=2*a.notes[0].pit-
4;b++)l[b]=3.5;d=a.notes[0<a.stem?0:a.nhd].shhd;for(c=0;c<=a.nhd;c++)f=a.notes[c].shhd+e-d,b=2*a.notes[c].pit,0>b?b=0:95<=b&&(b=94),f>l[b]&&(l[b]=f),a.head!=k.SQUARE&&--f,f>l[b-1]&&(l[b-1]=f),f>l[b+1]&&(l[b+1]=f);return l}function Kg(a){for(var c,b,d=a.p_v;a.type==k.CLEF||a.type==k.KEY||a.type==k.METER;)if(a.type==k.METER&&a.time>d.sym.time&&(Vd|=1),a=a.prev,!a)return;if(a.type==k.BAR&&(void 0!=a.text&&(d.bar_start=C(a),d.bar_start.bar_type="",delete a.text,delete a.a_gch),c=a.bar_type,":"!=c&&":"==
c.slice(-1)))if(d.bar_start||(d.bar_start=C(a)),":"!=c[0]){if("||:"==c)return d.bar_start.bar_type="[|:",a.bar_type="||",!0;d.bar_start.bar_type=c;a.prev&&a.prev.type==k.BAR?pb(a):a.bar_type="|"}else{if("||:"==c)return d.bar_start.bar_type="[|:",a.bar_type="||",!0;for(b=0;":"==c[b];)b++;if(b<c.length){a.bar_type=c.slice(0,b)+"|]";for(b=c.length-1;":"==c[b];)b--;d.bar_start.bar_type="[|"+c.slice(b+1)}else b=c.length/2|0,a.bar_type=c.slice(0,b)+"|]",d.bar_start.bar_type="[|"+c.slice(b);return!0}}function Lg(a){for(var c=
S;c&&!c.nl;c=c.ts_next)c.st==a&&c.type!=k.CLEF&&(c.st++,c.invis=!0)}function Bf(a){switch(a.subtype){case "leftmargin":case "rightmargin":case "pagescale":case "pagewidth":case "scale":case "staffwidth":td();aa.set_format(a.subtype,a.param);break;case "ml":td();w.img_out(a.text);break;case "newpage":Lb();Va.newpage=!0;Tb();break;case "sep":Ta();ta(a.sk1);y+='<path class="stroke"\n\td="M';gb(a.x," ",0);y+="h"+a.l.toFixed(2)+'"/>\n';ta(a.sk2);break;case "text":Mb(a.text,a.opt);break;case "title":ud(a.text,
!0);break;case "vskip":ta(a.sk);break;default:N(2,a,"Block $1 not treated",a.subtype)}}function Mg(){function a(a){var b=v[a],c=h.staves[a];b||(b=v[a]={});b.y=0;b.stafflines=c.stafflines;b.staffscale=c.staffscale;b.ann_top=b.ann_bot=0}function c(){var a,b,c,d=h.staves.length;for(a=0;a<d;a++)if(h.staves[a].flags&257){c=0;for(b=a;a<d;){c|=t[a]?1:2;if(h.staves[a].flags&514)break;a++}if(3==c)for(;b<=a;)t[b]=!0,m[b++]=!0}}var b,d,e,f,g,l,t=[],m=[],h=B;Q=f=h.nstaff;for(e=0;e<=f;e++)a(e);for(b=S;b&&!b.nl;b=
b.ts_next){b.ts_next||(d=b);switch(b.type){case k.STAVES:c();h.st_print=new Uint8Array(t);h=b.sy;f=h.nstaff;if(Q<f){for(e=Q+1;e<=f;e++)a(e);Q=f}t=[];continue;case k.BLOCK:re.push(b);pb(b);d&&(d=b.ts_prev);continue}e=b.st;if(!t[e])switch(b.type){case k.CLEF:e>Q&&(v[e].clef=b,pb(b));break;case k.BAR:if(!h.staves[e].staffnonote||1>=h.staves[e].staffnonote)break;case k.GRACE:m[e]=t[e]=!0;break;case k.NOTE:case k.REST:case k.SPACE:case k.MREST:1<h.staves[e].staffnonote?m[e]=t[e]=!0:b.invis||0==h.staves[e].staffnonote&&
b.type!=k.NOTE||(m[e]=t[e]=!0)}}Sb=b;c();h.st_print=new Uint8Array(t);(function(){var a,b,c,d;for(a=0;a<=Q;a++)if(b=v[a],m[a]){d=b.stafflines.length;b.topbar=6*(d-1);for(c=0;c<d-1&&"."==b.stafflines[c];c++);b.botline=b.botbar=6*c;c>=d-2&&("."!=b.stafflines[c]?(b.botbar-=6,b.topbar+=6):(b.botbar-=12,b.topbar+=12))}else b.botbar=b.topbar=0})();for(e=0;e<Q;e++)m[e]||Lg(e);m[Q]||(v[Q].topbar=0);Ig();K.st_print=new Uint8Array(m);if(Sb)for(b=Sb,delete b.nl,d=b.ts_prev,d.ts_next=null,g=x.length,f=0;f<g;f++){e=
x[f];if(e.sym&&e.sym.time<=Sb.time){for(b=Sb.ts_prev;b;b=b.ts_prev)if(b.v==f){e.s_next=b.next;b.next=null;Kg(b)&&(l=b.wl,aa.set_width(b),b.shrink+=b.wl-l);break}if(b)continue}e.s_next=e.sym;e.sym=null}d.type!=k.BAR&&(b=wf(d),b.space=Ic(b),b.space<b.shrink&&d.type!=k.KEY&&(b.space=b.shrink))}function Cf(){for(var a=S,c=a.time;a;a=a.ts_next){if(a.time!=c){Ta();return}switch(a.type){case k.NOTE:case k.REST:case k.MREST:Ta();return;default:continue;case k.STAVES:B=a.sy;break;case k.BLOCK:Bf(a)}pb(a);
a.p_v.s_next==a&&(a.p_v.s_next=a.next)}S=null}function Yc(a){a.fname=q.fname;a.istart=q.istart;a.iend=q.iend}function Df(a){var c={type:k.CLEF,clef_line:2,clef_type:"t",v:h.v,p_v:h,time:h.time,dur:0},b=1;Yc(c);switch(a[0]){case '"':b=a.indexOf('"',1);c.clef_name=a.slice(1,b);b++;break;case "a":if("u"==a[1]){c.clef_type="a";c.clef_auto=!0;b=4;break}b=4;case "C":c.clef_type="c";c.clef_line=3;break;case "b":b=4;case "F":c.clef_type="b";c.clef_line=4;break;case "n":b=4;c.invis=!0;break;case "t":if("e"==
a[1]){c.clef_type="c";c.clef_line=4;break}b=6;case "G":break;case "p":b=4;case "P":c.clef_type="p";c.clef_line=3;h.key.k_sf=0;h.ckey.k_drum=!0;break;default:u(1,"Unknown clef '$1'",a);return}"1"<=a[b]&&"9">=a[b]&&(c.clef_line=Number(a[b]),b++);if("8"!=a[b+1])return c;switch(a[b]){case "^":c.clef_oct_transp=!0;case "+":c.clef_octave=7;break;case "_":c.clef_oct_transp=!0;case "-":c.clef_octave=-7}return c}function Kc(a,c){var b,d,e,f,g=[];if("0"==a[0])return 0;if(0<="123456789-+".indexOf(a[0])){d=3*
parseInt(a);if(isNaN(d)||-108>d||108<d){u(1,"Bad transpose value");return}switch(a.slice(-1)){default:return d;case "#":d++;break;case "b":d+=2}return 0<d?d:d-3}if("instr"==c)if(e=a.indexOf("/"),r.sound)a=0>e?"c"+a:a.replace(/.*\//,"c");else{if(0>e)return 0;a=a.replace("/","")}e=new sa;e.buffer=a;for(b=0;2>b;b++){f=Nb(e);if(!f){u(1,"Bad transpose value");return}f.pit+=124;d=12*(f.pit/7|0)+Ng[f.pit%7];f.acc&&3!=f.acc&&(d+=f.acc);g[b]=d}r.sound&&(g[0]=252);d=3*(g[1]-g[0]);if(f)switch(f.acc){default:return d;
case 2:case 1:d++;break;case -1:case -2:d+=2}return 0<d?d:d-3}function Ef(a){var c,b;if(c=a.match(/(.*?)[= ]*([!"].*[!"])/))if(a=c[1],b=c[2],b.slice(-1)!=b[0])u(1,"Lack of ending $1 in U:/%%user",b[0]);else if("\\"==a[0]&&("t"==a[1]?a="\t":a[1]||(a=" ")),c=a.charCodeAt(0),128<=c)u(1,P.not_ascii);else{switch(Ua[c][0]){case "0":case "d":case "i":case " ":break;case '"':case "!":if(1<Ua[c].length)break;default:u(1,"Bad user character '$1'",a);return}switch(b){case "!beambreak!":b=" ";break;case "!ignore!":b=
"i";break;case "!nil!":case "!none!":b="d"}Ua[c]=b}else u(1,'Lack of starting ! or " in U: / %%user')}function Og(a){var c;if(a){if(/^[\]\[|.-]+$/.test(a))return a.replace(/\]/g,"[");a=parseInt(a);switch(a){case 0:return"...";case 1:return"..|";case 2:return".||";case 3:return".|||"}if(!(isNaN(a)||0>a||16<a)){for(c="|";0<--a;)c+="|";return c}}}function Ab(a){a={type:k.BLOCK,subtype:a,dur:0};2==q.state&&Pa();var c=h;h=x[G.top_voice];ra(a);h=c;return a}function he(a){h.init||(h.init=!0,L.V&&(L.V["*"]&&
(a=L.V["*"].concat(a)),L.V[h.id]&&(a=L.V[h.id].concat(a))));0!=a.length&&aa.set_vp(a)}function Ff(a,c){0!=c.length&&(L.V||(L.V={}),L.V[a]?Array.prototype.push.apply(L.V[a],c):L.V[a]=c)}function rd(a,c){var b,d,e;switch(a){case "I":aa.do_pscom(c);break;case "L":2==q.state&&Pa();if(b=c.match(/^1\/(\d+)(=(\d+)\/(\d+))?$/)){d=Number(b[1]);if(!d||0!=(d&d-1))break;d=k.BLEN/d;if(b[2]){e=Number(b[4]);if(!e||0!=(e&e-1))break;e=Number(b[3])/e*k.BLEN}else e=d}else"auto"==c&&(d=e=-1);if(!e){u(1,"Bad L: value");
break}2>q.state?ya.ulen=d:(h.ulen=d,h.dur_fact=e/d);break;case "M":a:{b={type:k.METER,dur:0,a_meter:[]};var f={},g,l,t;l=0;var m;Yc(b);if(0==c.indexOf("none"))l=4,g=1;else for(g=0;l<c.length&&"="!=c[l];){switch(c[l]){case "C":f.top=c[l++];"|"==c[l]&&(f.top+=c[l++]);d=t=4;break;case "c":case "o":t="c"==c[l]?4:3;d=4;f.top=c[l++];"."==c[l]&&(f.top+=c[l++]);break;case "(":"("==c[l+1]&&(m=!0,f.top=c[l++],b.a_meter.push(f),f={});for(t=l+1;t<c.length&&")"!=c[t]&&"/"!=c[t];)t++;if(")"==c[t]&&"/"==c[t+1]){l++;
continue}case ")":m="("==c[l];f.top=c[l++];b.a_meter.push(f);f={};continue;default:if("0">=c[l]||"9"<c[l]){u(1,"Bad char '$1' in M:",c[l]);break a}d=2;for(f.top=c[l++];;){for(;"0"<=c[l]&&"9">=c[l];)f.top+=c[l++];if(")"==c[l]){if("/"!=c[l+1])break;l++}if("/"==c[l]){l++;if("0">=c[l]||"9"<c[l]){u(1,"Bad char '$1' in M:",c[l]);break a}for(f.bot=c[l++];"0"<=c[l]&&"9">=c[l];)f.bot+=c[l++];break}if(" "!=c[l]&&"+"!=c[l])break;if(l>=c.length||"("==c[l+1])break;f.top+=c[l++]}t=parseInt(f.top)}m||(f.bot&&(d=
parseInt(f.bot)),g+=t*k.BLEN/d);b.a_meter.push(f);for(f={};" "==c[l];)l++;"+"==c[l]&&(f.top=c[l++],b.a_meter.push(f),f={})}if("="==c[l]){g=c.substring(++l).match(/^(\d+)\/(\d+)$/);if(!g){u(1,"Bad duration '$1' in M:",c.substring(l));break a}g=k.BLEN*g[1]/g[2]}b.wmeasure=g;if(3!=q.state){if(L.M=c,ya.meter=b,1<=q.state)for(ya.ulen||(ya.ulen=1>=g||g>=3*k.BLEN/4?k.BLEN/8:k.BLEN/16),l=0;l<x.length;l++)x[l].meter=b,x[l].wmeasure=g}else h.wmeasure=g,vd()?(h.meter=b,Vd=0<=r.writefields.indexOf("M")?3:2):
ra(b)}break;case "U":Ef(c);break;case "P":if(0==q.state)break;if(1==q.state){L.P=c;break}2==q.state&&Pa();if(0>r.writefields.indexOf(a))break;b={type:k.PART,text:c,dur:0};l=x[G.top_voice];h.v!=l.v?h.time!=l.time||l.last_sym&&l.last_sym.type==k.PART||(g=h,h=l,ra(b),h=g):ra(b);break;case "Q":if(0==q.state)break;a:{g=0;l={type:k.TEMPO,dur:0};Yc(l);0>r.writefields.indexOf("Q")&&(l.del=!0);if('"'==c[0]){g=c.indexOf('"',1);if(0>g){u(1,"Unterminated string in Q:");break a}l.tempo_str1=c.slice(1,g);for(g++;" "==
c[g];)g++}b=new sa;b.buffer=c;for(b.index=g;;){f=c[b.index];if(void 0==f||"0">=f||"9"<f)break;g=Lc(b);l.tempo_notes||(l.tempo_notes=[]);for(l.tempo_notes.push(k.BLEN*g[0]/g[1]);;){f=c[b.index];if(" "!=f)break;b.index++}}if("="==f){for(f=c[++b.index];" "==f;)f=c[++b.index];g=b.index;"c"==f&&"a"==c[g+1]&&"."==c[g+2]&&" "==c[g+3]&&(l.tempo_ca="ca. ",b.index+=4);"/"!=c[b.index+1]?l.tempo=b.get_int():(g=Lc(b),l.new_beat=k.BLEN*g[0]/g[1]);for(f=c[b.index];" "==f;)f=c[++b.index]}if('"'==f){b.index++;g=c.indexOf('"',
b.index+1);if(0>g){u(1,"Unterminated string in Q:");break a}l.tempo_str2=c.slice(b.index,g)}if(3!=q.state){if(1==q.state){L.Q=c;ya.tempo=l;break a}Pa()}h.v==G.top_voice&&(ra(l),ya.tempo&&0==h.time&&(ya.tempo.del=!0))}break;case "V":Gf(c);break;case "K":if(0==q.state)break;a:{b:{m=c;var n;d=0;e={type:k.KEY,k_delta:0,dur:0};Yc(e);n=1;switch(m[0]){case "A":e.k_sf=3;break;case "B":e.k_sf=5;break;case "C":e.k_sf=0;break;case "D":e.k_sf=2;break;case "E":e.k_sf=4;break;case "F":e.k_sf=-1;break;case "G":e.k_sf=
1;break;case "H":switch(m[1]){case "P":case "p":e.k_bagpipe=m[1];e.k_sf="P"==m[1]?0:2;n++;break;default:u(1,"Unknown bagpipe-like key")}break;case "P":u(1,"K:P is deprecated");t=e.k_drum=!0;break;case "n":0==m.indexOf("none")&&(e.k_sf=0,e.k_none=!0,n=4);default:t=!0}if(!t){switch(m[n]){case "#":e.k_sf+=7;n++;break;case "b":e.k_sf-=7,n++}m=m.slice(n).trim();switch(m.slice(0,3).toLowerCase()){default:if("m"!=m[0]||" "!=m[1]&&"\t"!=m[1]&&"\n"!=m[1]){t=!0;break}case "aeo":case "m":case "min":e.k_sf-=
3;d=5;break;case "dor":e.k_sf-=2;d=1;break;case "ion":case "maj":break;case "loc":e.k_sf-=5;d=6;break;case "lyd":e.k_sf+=1;d=3;break;case "mix":--e.k_sf;d=4;break;case "phr":e.k_sf-=4,d=2}t||(m=m.replace(/\w+\s*/,""));0==m.indexOf("exp ")&&((m=m.replace(/\w+\s*/,""))||u(1,"No accidental after 'exp'"),e.k_exp=!0);n=m[0];if("^"==n||"_"==n||"="==n){e.k_a_acc=[];t=new sa;t.buffer=m;do{n=Nb(t);if(!n){t=[e,null];break b}e.k_a_acc.push(n);for(n=m[t.index];" "==n;)n=m[++t.index]}while("^"==n||"_"==n||"="==
n);m=m.slice(t.index)}else e.k_exp&&0==m.indexOf("none")&&(e.k_sf=0,m=m.replace(/\w+\s*/,""))}e.k_delta=mc[(e.k_sf+7)%7];e.k_mode=d;t=[e,Wd(m,0)]}m=t[0];t=t[1];if(m.k_sf&&!m.k_exp&&m.k_a_acc){var A,p,I=[],v=[],D=[],z=[];if(0<m.k_sf)for(A=0;A<m.k_sf;A++)I[A]=1,v[A]=[26,23,27,24,21,25,22][A];else for(A=0;A<-m.k_sf;A++)I[A]=-1,v[A]=[22,25,21,24,20,23,26][A];n=m.k_a_acc.length;for(d=0;d<n;d++){p=m.k_a_acc[d];for(e=0;e<A;e++)if(v[e]==p.pit){I[e]=p.acc;p.micro_n&&(D[e]=p.micro_n,z[e]=p.micro_d);break}e==
A&&(I[e]=p.acc,v[e]=p.pit,p.micro_n&&(D[e]=p.micro_n,z[e]=p.micro_d),A++)}for(d=0;d<A;d++)(p=m.k_a_acc[d])||(p=m.k_a_acc[d]={}),p.acc=I[d],p.pit=v[d],D[d]?(p.micro_n=D[d],p.micro_d=z[d]):(delete p.micro_n,delete p.micro_d)}switch(q.state){case 1:void 0!=m.k_sf||m.k_a_acc||(m.k_sf=0,m.k_none=!0);for(f=0;f<x.length;f++)d=x[f],d.key=C(m),d.okey=C(m),d.ckey=C(m);q.ckey=m;0!=t.length&&Ff("*",t);ya.ulen||(ya.ulen=k.BLEN/8);q.state=2;Ta();A=nd();Tb();ta(r.topspace);if(r.titleformat){var B,y;l={};g=C(Pg);
f={A:r.infospace,C:r.composerspace,O:r.composerspace,R:r.infospace};m={};t="";d=r.titleformat;for(e=0;;){for(;" "==d[e];)e++;if(e>=d.length)break;b=d[e++];if("A">b||"Z"<b)"+"==b?0!=t.length&&"+"!=t.slice(-1)&&(t=t.slice(0,-1)+"+"):","==b&&("+"==t.slice(-1)&&(t=t.slice(0,-1)+"l"),t+="\n");else{if(l[b])m[b]++;else{if(!L[b])continue;l[b]=L[b].split("\n");m[b]=1}t+=b;switch(d[e]){case "-":t+="l";e++;break;case "0":t+="c";e++;break;case "1":t+="r";e++;break;default:t+="c"}}}"+"==t.slice(-1)&&(t=t.slice(0,
-1)+"l");t+="\n";n={l:r.titlespace,c:r.titlespace,r:r.titlespace};var D={l:0,c:.5*A,r:A},z={},H;d=t;for(e=0;;){z.l=z.c=z.r=I=0;for(y=e;;){b=d[y++];if("\n"==b)break;p=d[y++];if("+"==p)p=d[y+1];else if(0!=z[p])continue;if(H=l[b])(A=g[b])||(A="history"),B=kc(A),v=1.1*B.size,f[b]&&(v+=f[b]),I<v&&(I=v),z[p]=v}n.l+=I-z.l;n.c+=I-z.c;for(n.r+=I-z.r;;){b=d[e++];if("\n"==b)break;p=d[e++];if(0!=l[b].length){H=l[b].shift();"+"==p&&(m[b]--,b=d[e++],p=d[e++],0<l[b].length&&(H=H?H+(" "+l[b].shift()):" "+l[b].shift()));
(A=g[b])||(A="history");B=kc(A);v=1.1*B.size;f[b]&&(v+=f[b]);va(B);y=D[p];I=n[p]+v;"Q"==b?ya.tempo.del||("l"!=p&&(B=af(ya.tempo),"c"==p&&(B*=.5),y-=B),bf(ya.tempo,y,-I)):H&&fa(y,-I,H,p);"T"==b&&(A=g.T="subtitle",f.T=r.subtitlespace);if(1>=m[b])for("T"==b&&(B=kc(A),v=1.1*B.size,f[b]&&(v+=f[b]),va(B));0<l[b].length;)I+=v,H=l[b].shift(),fa(y,-I,H,p);m[b]--;n[p]=I}}n.c>n.l&&(n.l=n.c);n.r>n.l&&(n.l=n.r);if(e>=t.length)break;n.c=n.r=n.l}ta(n.l);ta(r.musicspace)}else{if(L.T&&0<=r.writefields.indexOf("T"))for(f=
0;;){m=L.T.indexOf("\n",f);if(0>m){ud(L.T.substring(f),0!=f);break}ud(L.T.slice(f,m),0!=f);f=m+1}va("composer");d=0;q.ckey.k_bagpipe&&!r.infoline&&0<=r.writefields.indexOf("R")&&(g=L.R);g&&(fa(0,-r.composerspace,g),d=r.composerspace);t=L.A;0<=r.writefields.indexOf("C")&&(b=L.C);0<=r.writefields.indexOf("O")&&(l=L.O);if(b||l||r.infoline){ta(r.composerspace);0>r.aligncomposer?(n=0,p=" "):0==r.aligncomposer?(n=.5*A,p="c"):(n=A,p="r");e=d;if(b||l){0<=r.aligncomposer&&d!=e&&ta(d-e);for(f=0;;){ta(K.curfont.size);
m=b?b.indexOf("\n",f):-1;if(0>m){Hf(n,0,b?b.substring(f):null,l,p);break}fa(n,0,b.slice(f,m),p);d+=K.curfont.size;f=m+1}e>d&&ta(e-d)}((g=g?null:L.R)||t)&&r.infoline&&(va("info"),ta(K.curfont.size+r.infospace),Hf(A,0,g,t,"r"),d+=K.curfont.size+r.infospace)}else e=r.composerspace;L.P&&0<=r.writefields.indexOf("P")&&(va("parts"),d=r.partsspace+K.curfont.size-d,0<d&&(e+=d),.01<e&&ta(e),fa(0,0,L.P),e=0);ta(e+r.musicspace)}Vd=0<=r.writefields.indexOf("M")?3:2;K.nbar=r.measurefirst;break a;case 2:Pa(!0)}0!=
t.length&&he(t);h.ckey.k_bagpipe||h.ckey.k_drum||(f=(r.transp||0)+(h.transp||0)+(h.shift||0));if(void 0==m.k_sf){if(!m.k_a_acc&&!f)break a;m.k_sf=h.okey.k_sf}h.okey=C(m);f&&(h.vtransp=f,Xd(m));m.k_old_sf=h.ckey.k_sf;h.ckey=m;vd()?(h.key=C(m),m.k_none&&(h.key.k_sf=0)):(b=h.last_sym)&&b.type==k.METER?(h.last_sym=b.prev,h.last_sym||(h.sym=null),ra(m),m.next=b,b.prev=m,h.last_sym=b):ra(m)}break;case "N":case "R":L[a]=L[a]?L[a]+("\n"+c):c;break;case "r":if(!w.keep_remark||3!=q.state)break;b={type:k.REMARK,
text:c,dur:0};ra(b);break;default:u(0,"'$1:' line ignored",a)}}function If(){var a,c,b=q.line,d={type:k.BAR,fname:q.fname,istart:q.bol+b.index,dur:0,multi:0};ja&&ja.bar&&wc("|");ya.new_nbar&&(d.bar_num=ya.new_nbar,ya.new_nbar=0);for(c=b["char"]();;){a=b.next_char();switch(a){case "|":case "[":case "]":case ":":c+=a;continue}break}":"==c[0]&&(1==c.length?(c="|",d.bar_dotted=!0):d.rbstop=2);ib&&aa.gch_build(d);ea&&(kd(ea,d),ea=null);switch(c.slice(-1)){case "[":if(/[0-9" ]/.test(a))break;c=c.slice(0,
-1);b.index--;a="[";break;case ":":d.rbstop=2}if("0"<a&&"9">=a){"["==c.slice(-1)&&(c=c.slice(0,-1));for(d.text=a;;){a=b.next_char();if(0>"0123456789,.-".indexOf(a))break;d.text+=a}d.rbstop=2;d.rbstart=2}else if('"'==a&&"["==c.slice(-1)){c=c.slice(0,-1);for(d.text="";;){a=b.next_char();if(!a){u(1,"No end of repeat string");return}if('"'==a){b.index++;break}"\\"==a&&(d.text+=a,a=b.next_char());d.text+=a}d.text=hb(d.text);d.rbstop=2;d.rbstart=2}"]"==c[0]&&(d.rbstop=2,1!=c.length?c=c.slice(1):d.invis=
!0);d.iend=q.bol+b.index;d.rbstart&&h.norepbra&&!h.second&&(d.norepbra=!0);if(0>h.ulen){var e,f;if((a=h.last_sym)&&a.type!=k.MREST&&a.type!=k.BAR){for(;a.type!=k.BAR&&a.prev;)a=a.prev;b=a.time;e=h.time-b;if(0==b){for(;a&&!a.dur;)a=a.next;a&&a.type==k.REST&&a.invis&&(b+=a.dur*h.wmeasure/e,a.prev?a.prev.next=a.next:h.sym=a.next,a.next&&(a.next.prev=a.prev),a=a.next)}if(h.wmeasure!=e){for(;a;a=a.next)if(a.time=b,a.dur&&!a.grace&&(a.dur=a.dur*h.wmeasure/e,a.dur_orig=a.dur_orig*h.wmeasure/e,b+=a.dur,a.type==
k.NOTE||a.type==k.REST)){for(f=0;f<=a.nhd;f++)a.notes[f].dur=a.notes[f].dur*h.wmeasure/e;f=Ib(a,a.dur_orig);a.head=f[0];a.dots=f[1];a.nflags=f[2];-2>=a.nflags?a.stemless=!0:delete a.stemless}h.time=d.time=b}}}if((a=h.last_sym)&&a.type==k.SPACE)a.time--;else if(a&&a.type==k.BAR){if("["==c&&!a.text&&(0==h.st||G.staves[h.st-1].flags&64||d.norepbra)){d.text&&(a.text=d.text);d.a_gch&&(a.a_gch=d.a_gch);d.norepbra&&(a.norepbra=d.norepbra);d.rbstart&&(a.rbstart=d.rbstart);d.rbstop&&(a.rbstop=d.rbstop);return}if("|:"==
c){if(":|"==a.bar_type){a.bar_type="::";a.rbstop=2;return}if("||"==a.bar_type){a.bar_type="||:";a.rbstop=2;return}}}switch(c){case "[":d.rbstop=2;case "[]":case "[|]":d.invis=!0;c="[]";break;case ":|:":case ":||:":c="::";break;case "||":if(!r.rbdbstop)break;case "[|":case "|]":d.rbstop=2}d.bar_type=c;h.lyric_restart||(h.lyric_restart=d);h.sym_restart||(h.sym_restart=d);!a||a.type!=k.KEY||a.prev&&a.prev.type==k.BAR?ra(d):(h.last_sym=a.prev,a.prev||(h.sym=a.prev),ra(d),d.next=a,a.prev=d,h.last_sym=
a);d.st=h.st;d.rbstart&&!h.norepbra&&0<h.st&&!(G.staves[h.st-1].flags&64)&&(a={type:k.BAR,fname:d.fname,istart:d.istart,iend:d.iend,bar_type:"[",multi:0,invis:!0,text:d.text,rbstart:2},ra(a),a.st=h.st,delete d.text,d.rbstart=0)}function Wd(a){if(!a)return[];a=a.match(/(".+?"|.+?)(\s+|=|$)/g);if(!a)return u(1,"Unterminated string"),[];for(var c=0;c<a.length;c++)a[c]=a[c].trim();return a}function Ib(a,c){var b,d,e;0!=c%12&&u(1,"Invalid note duration $1",c);c/=12;0==c&&u(1,"Note too short");for(e=5;0!=
c&&!(c&1);c>>=1,e--);switch(c>>1){case 0:d=0;break;case 1:d=1;break;case 3:d=2;break;default:d=3}e-=d;if(0<=e)b=k.FULL;else switch(e){default:u(1,"Note too long"),e=-4;case -4:b=k.SQUARE;break;case -3:b=r.squarebreve?k.SQUARE:k.OVALBARS;break;case -2:b=k.OVAL;break;case -1:b=k.EMPTY}return[b,d,e]}function Lc(a){var c,b,d;wd.lastIndex=a.index;c=wd.exec(a.buffer);if(!c[0])return[1,1];b=c[1]||1;d=c[3]||1;c[3]||(d*=1<<c[2].length);a.index=wd.lastIndex;return[b,d]}function Nb(a){var c,b,d,e,f=a["char"]();
switch(f){case "^":f=a.next_char();"^"==f?(c=2,f=a.next_char()):c=1;break;case "=":c=3;f=a.next_char();break;case "_":f=a.next_char(),"_"==f?(c=-2,f=a.next_char()):c=-1}if(c&&3!=c&&"1"<=f&&"9">=f||"/"==f)d=Lc(a),b=d[0],d=d[1],d=1==d?h?h.uscale:1:2*d,f=a["char"]();e=xd.indexOf(f)+16;f=a.next_char();if(16>e)u(1,"'$1' is not a note",a.buffer[a.index-1]);else{for(;"'"==f;)e+=7,f=a.next_char();for(;","==f;)e-=7,f=a.next_char();a={pit:e,shhd:0,shac:0,ti1:0};c&&(a.acc=c,b&&(a.micro_n=b,a.micro_d=d));return a}}
function Jf(a){var c,b="abcdefg"[(a.pit+77)%7];a.acc&&(b="__ _  ^ ^^ =".split(" ")[a.acc+2]+b);for(c=a.pit;30<=c;c-=7)b+="'";for(c=a.pit;23>c;c+=7)b+=",";return b}function Zc(){var a=q.line,c=0;"."!=a.buffer[a.index-1]||ea||(c=k.SL_DOTTED);switch(a.next_char()){case "'":return a.index++,c+k.SL_ABOVE;case ",":return a.index++,c+k.SL_BELOW}return c+k.SL_AUTO}function Oe(a){a.notes=a.notes.sort(function(a,b){return a.pit-b.pit})}function pf(){function a(f){for(var p,v,x,z;;){p=A["char"]();if(!p)break;
if("."==p)switch(A.buffer[A.index+1]){case "(":case "-":case "|":p=A.next_char()}v=p.charCodeAt(0);if(128<=v){u(1,P.not_ascii);A.index++;break}if(!f&&qd[v]){z=0;for(x in lc)if(lc.hasOwnProperty(x)&&x[0]==p){if(0>x.indexOf("n")){if(A.buffer.indexOf(x,A.index)!=A.index)continue;A.index+=x.length}else{a:{z=void 0;var w,B,y=x;B=1;for(w=A.index+1;B<y.length;B++,w++)if(y[B]!=A.buffer[w]){if("n"!=y[B]){z=void 0;break a}z=xd.indexOf(A.buffer[w]);if(0>z){z=void 0;break a}for(;"'"==A.buffer[w+1];)z+=7,w++;
for(;","==A.buffer[w+1];)z-=7,w++}A.index=w}if(!z)continue}var y=lc[x],D=z;z=A;w=q.istart;q.line=A=new sa;q.istart+=z.index;B=A;if(D){var H,C=D,K="",N=y.length;for(i=0;i<N;i++)if(H=y[i],"h"<=H&&"z">=H){D=C+H.charCodeAt(0)-110;for(H="";0>D;)D+=7,H+=",";for(;14<D;)D-=7,H+="'";K+=xd[D]+H}else K+=H;y=K}B.buffer=y;a(!0);q.line=A=z;q.istart=w;z=1;break}if(z)continue}v=Ua[v];switch(v[0]){case " ":if(z=h.last_note)z.beam_end=!0,c&&(c.gr_shift=!0);break;case "\n":if(r.barsperstaff)break;0==G.voices[h.v].range&&
h.last_sym&&(h.last_sym.eoln=!0);break;case "&":if(c){u(1,P.bad_char,p);break}p=A.next_char();if(")"==p){wc(")");break}wc("&");continue;case "(":p=A.next_char();if("0"<p&&"9">=p){v=A.get_int();z=Qg[v];w=v;p=A["char"]();if(":"==p&&(p=A.next_char(),"0"<p&&"9">=p&&(z=A.get_int(),p=A["char"]()),":"==p))if(p=A.next_char(),"0"<p&&"9">=p)w=A.get_int(),A["char"]();else{u(1,"Invalid 'r' in tuplet");continue}if(0==z||void 0==z)z=0==h.wmeasure%9?3:2;(l=g[++t])||(g[t]=l={});l.p=v;l.q=z;l.r=w;l.f=r.tuplets;l.fact=
m*z/v;m=l.fact;continue}if("&"==p){if(c){u(1,P.bad_char,p);break}wc("(");break}n<<=4;A.index--;n+=Zc();continue;case ")":if(h.ignore)break;if(z=h.last_sym)switch(z.type){case k.NOTE:case k.REST:case k.SPACE:break;default:z=null}if(!z){u(1,P.bad_char,p);break}z.slur_end?z.slur_end++:z.slur_end=1;break;case "!":ea||(ea=[]);if(1<v.length)z=v.slice(1,-1);else{z="";for(v=A.index;;){p=A.next_char();if(!p)break;if("!"==p)break;z+=p}if(!p){A.index=v;u(1,"No end of decoration");break}}Ye[z]&&yd(z);ea.push(z);
break;case '"':Kf(v);break;case "-":if(!h.last_note||h.last_note.type!=k.NOTE){u(1,"No note before '-'");break}p=Zc();z=h.last_note;for(v=0;v<=z.nhd;v++)z.notes[v].ti1?0==z.nhd&&u(1,"Too many ties"):z.notes[v].ti1=p;z.ti1=!0;c&&(c.ti1=!0);continue;case "[":z=A.buffer[A.index+1];if(0<='|[]: "'.indexOf(z)||"1"<=z&&"9">=z){if(c){u(1,P.bar_grace);break}If();continue}if(":"==A.buffer[A.index+2]){v=A.buffer.indexOf("]",A.index+1);if(0>v){u(1,"Lack of ']'");break}p=A.buffer.slice(A.index+3,v).trim();q.istart=
q.bol+A.index;q.iend=q.bol+ ++v;A.index=0;rd(z,p);A.index=v;continue}case "n":z=aa.new_note(c,m);if(!z)continue;z.type==k.NOTE&&n&&(z.slur_start=n,n=0);if(c){0<=t&&(z.in_tuplet=!0);continue}0<=t&&z.notes&&(z.in_tuplet=!0,0<t?(g[0].p&&(z.tp0=g[0].p,z.tq0=g[0].q,z.tf=g[0].f,g[0].p=0),g[0].r--,l.p&&(z.tp1=l.p,z.tq1=l.q,z.tf=l.f,l.p=0)):l.p&&(z.tp0=l.p,z.tq0=l.q,z.tf=l.f,l.p=0),l.r--,0==l.r&&(0==t--?(z.te0=!0,m=1,h.time=Math.round(h.time),z.dur=h.time-z.time):(z.te1=!0,l=g[0],0==l.r?(t--,z.te0=!0,m=1,
h.time=Math.round(h.time),z.dur=h.time-z.time):m=l.fact)));continue;case "<":if(!h.last_note){u(1,"No note before '<'");break}if(c){u(1,"Cannot have a broken rhythm in grace notes");break}for(z="<"==p?1:-1;"<"==p||">"==p;)z*=2,p=A.next_char();h.brk_rhythm=z;continue;case "i":break;case "{":if(c){u(1,"'{' in grace note");break}b=h.last_note;h.last_note=null;d=ea;ea=void 0;c={type:k.GRACE,fname:q.fname,istart:q.bol+A.index,dur:0,multi:0};switch(h.pos.gst){case k.SL_ABOVE:c.stem=1;break;case k.SL_BELOW:c.stem=
-1;break;case k.SL_HIDDEN:c.stem=2}ra(c);p=A.next_char();if("/"==p){c.sappo=!0;break}continue;case "|":if(c){u(1,P.bar_grace);break}p=A.buffer[A.index-1];If();"."==p&&(h.last_sym.bar_dotted=!0);continue;case "}":z=h.last_note;if(!c||!z){u(1,P.bad_char,p);break}ea&&u(1,"Decoration ignored");z.gr_end=!0;c.extra=c.next;c.extra.prev=null;c.next=null;h.last_sym=c;c=null;if(!z.prev&&!h.ckey.k_bagpipe){for(v=0;v<=z.nhd;v++)z.notes[v].dur*=2;z.dur*=2;z.dur_orig*=2;p=Ib(z,z.dur_orig);z.head=p[0];z.dots=p[1];
z.nflags=p[2]}h.last_note=b;ea=d;break;case "\\":if(p=A.buffer[A.index+1],!p){e=!0;break}default:u(1,P.bad_char,p)}A.index++}}var c,b,d,e,f,g=[],l,t=-1,m=1,n=0,A=q.line;if(3!=q.state){if(2!=q.state)return;Pa()}a();if(0<=t)for(u(1,"No end of tuplet"),f=h.last_note;f;f=f.prev)if(f.tp1&&(f.tp1=0),f.tp0){f.tp0=0;break}c&&(u(1,"No end of grace note sequence"),h.last_sym=c.prev,h.last_note=b,c.prev&&(c.prev.next=null));r.breakoneoln&&h.last_note&&(h.last_note.beam_end=!0);e||r.barsperstaff||"\n"!=Ua[10]||
0!=G.voices[h.v].range||!h.last_sym||(h.last_sym.eoln=!0)}function hc(a){a=a.charCodeAt(0);if(128<=a){if(768<=a&&880>a)return 0;a=97}return Rg[a]}function Ka(a){var c=K.curfont,b=c.swfac,d=c.size,e=0,f,g,l,k=a.length;for(f=0;f<k;f++){l=a[f];switch(l){case "$":l=a[f+1];if("0"==l)c=K.deffont;else if("1"<=l&&"9">=l)c=kc("u"+l);else{l="$";break}f++;b=c.swfac;c.size>d&&(d=c.size);continue;case "&":g=a.indexOf(";",f),0<g&&10>g-f&&(f=g,l="a")}e+=hc(l)*b}K.curfont=c;return[e,d]}function va(a){"string"==typeof a&&
(a=kc(a));K.curfont=K.deffont=a}function Lf(a){var c,b=K.curfont,d=b;y+=a.replace(/<|>|&.*?;|&|  |\$./g,function(a){switch(a[0]){case "<":return"&lt;";case ">":return"&gt;";case "&":return"&"==a?"&amp;":a;case " ":return" \u00a0";case "$":if("0"==a[1])c=K.deffont,rb(c);else if("1"<=a[1]&&"9">=a[1])c=kc("u"+a[1]);else return a;a="";if(c==d)return a;d!=b&&(a="</tspan>");d=c;return d==b?a:a+'<tspan\n\tclass="'+od(c)+'">'}});d!=b&&(y+="</tspan>",K.curfont=d)}function fa(a,c,b,d,e){var f=Ka(b)[1];c+=.2*
f;y+='<text class="'+od(K.curfont)+'" x="';gb(a,'" y="',c);switch(d){case "c":y+='" text-anchor="middle">';break;case "j":y+='" textLength="'+e.toFixed(2)+'">';break;case "r":y+='" text-anchor="end">';break;default:y+='">'}Lf(b);y+="</text>\n"}function fe(a,c,b){var d=Ka(b);y+='<rect class="stroke" x="';gb(a-2,'" y="',c+d[1]+1);y+='" width="'+(d[0]+4).toFixed(2)+'" height="'+(d[1]+3).toFixed(2)+'"/>\n';fa(a,c,b)}function nd(){return(ha.width-ha.lm-ha.rm-2)/r.scale}function ud(a,c){var b;if(a){Ta();
b=a;var d;if(r.titletrim)if(d=b.lastIndexOf(", "),0>d||"A">b[d+2]||"Z"<b[d+2])d=0;else if(1==r.titletrim){if(d<b.length-7||0<=b.indexOf(" ",d+3))d=0}else d<b.length-r.titletrim-2&&(d=0);!c&&0<=r.writefields.indexOf("X")&&(b=L.X+".  "+b);d&&(b=b.slice(d+2).trim()+" "+b.slice(0,d));a=r.titlecaps?b.toUpperCase():b;c?(va("subtitle"),b=r.subtitlespace):(va("title"),b=r.titlespace);ta(Ka(a)[1]+b);r.titleleft?fa(0,0,a):fa(nd()/2,0,a,"c")}}function Hf(a,c,b,d,e){if(!b){if(!d)return;b=d;d=null}d?fa(a,c,b+
" ("+d+")",e):fa(a,c,b,e)}function $c(a){ta(Ka(a)[1]*r.lineskipfac)}function Mb(a,c){if("s"!=c){va("text");Ta();var b=nd(),d=K.curfont.size,e=d*r.lineskipfac,d=d*r.parskipfac,f=Va.started?function(){}:Tb,g=Va.started?td:Lb,l,k,m,h,q,p;f();switch(c){default:switch(c){case "c":b/=2;break;case "r":break;default:b=0}for(k=0;;){l=a.indexOf("\n",k);if(0>l){h=a.slice(k);$c(h);fa(b,0,h,c);break}if(l==k){ta(d);g();for(rb(K.curfont);"\n"==a[l+1];)ta(e),l++;if(l==a.length)break;f()}else h=a.slice(k,l),$c(h),
fa(b,0,h,c);k=l+1}ta(d);g();break;case "f":case "j":for(k=0;;){l=a.indexOf("\n\n",k);m=0>l?a.slice(k):a.slice(k,l);m=m.split(/\s+/);for(k=h=q=0;k<m.length;k++)p=Ka(m[k]+" ")[0],h+=p,h>=b&&(h=m.slice(q,k).join(" "),$c(h),fa(0,0,h,c,b),q=k,h=p);0!=h&&(h=m.slice(q).join(" "),$c(h),fa(0,0,h));ta(d);g();if(0>l)break;for(;"\n"==a[l+2];)ta(e),l++;if(l==a.length)break;f();rb(K.curfont);k=l+2}}}}function Dg(a){function c(a,b,c){c=0;var d,e;"$"==a[c]&&"0"<=a[c+1]&&"9">=a[c+1]&&(c+=2);e=0;d=c;if("0"<=a[c]&&
"9">=a[c]||"."==a[c+1]){for(;c<a.length&&(c++," "!=a[c]&&":"!=a[c-1]&&"."!=a[c-1]););for(e=c;" "==a[c];)c++}0!=e&&fa(b,0,a.slice(d,e),"r");c<a.length&&fa(b+5,0,a.slice(c),"l");return c>=a.length&&0==e}var b,d,e,f,g,k,h;Tb();va("words");var m=nd()/2;k=(m-45)/(hc("a")*K.curfont.swfac);f=0;a=a.split("\n");g=a.length;for(d=0;d<g;d++){b=a[d];if(b.length>k){f=0;break}b?h=!0:h&&(f++,h=!1)}if(0<f){d=f=(f+1)/2|0;h=!1;for(k=0;k<g;k++){b=a[k];for(e=0;" "==b[e];)e++;if(e==b.length){if(h&&0>=--d)break;h=!1}else h=
!0}b=k+1}else b=k=g;ta(r.wordsspace);for(d=0;d<k||b<g;d++)d<k&&0==a[d].length&&(Tb(),rb(K.curfont)),ta(r.lineskipfac*K.curfont.size),d<k&&c(a[d],45,0),b<g&&(c(a[b],20+m,1)&&0==--f&&(d<k?f++:b<a.length-1&&(m*=.6)),b++)}function Mf(a){var c,b;if(!zd[a])if(zd[a]=!0,b=jc[a]){for(c=0;;){a=b.indexOf('xlink:href="#',c);if(0>a)break;a+=13;c=b.indexOf('"',a);Mf(b.slice(a,c))}Ad+="\n"+b}else N(1,null,"Unknown glyph: '$1'",a)}function Bd(){D.started&&(D.started=!1,y+="</g>\n");if(1!=D.scale||D.color)y+="<g ",
1!=D.scale&&(y=0<=D.st?y+v[D.st].scale_str:y+x[D.v].scale_str),D.color&&(1!=D.scale&&(y+=" "),y+='style="color:'+D.color+'"'),y+=">\n",D.started=!0}function tc(a){if(a!=D.color){var c=D.color;D.color=a;Bd();return c}}function db(a){var c,b;a!=D.st&&1!=D.scale&&(D.scale=0);c=0<=a?v[a].staffscale:1;b=0<=a&&1!=c?v[a].y:ma;if(c!=D.scale||b!=D.dy)D.scale=c,D.dy=b,D.st=a,Bd()}function ad(a){var c=a.p_v.scale;if(1==c)db(a.st);else if(c!=D.scale||D.dy!=ma)D.scale=c,D.dy=ma,D.st=-1,D.v=a.v,Bd()}function xc(a,
c){y&&(0>D.st?v[0].output+=y:1==D.scale?v[D.st].output+=y:v[D.st].sc_out+=y,y="");D.scale=0>a?1:c?1:v[a].staffscale;D.st=a;D.dy=0}function Nf(a,c,b){if(void 0!=a.istart){var d=a.type,e=a.ymx-a.ymn+4,f=a.wl||2,g=a.wr||2;a.grace&&(d=k.GRACE);b(c||Of[d],a.istart,a.iend,a.x-f-2,v[a.st].y+a.ymn+e-2,f+g+4,e,a)}}function Sg(a,c){Nf(a,c,w.anno_start)}function Tg(a,c){Nf(a,c,w.anno_stop)}function Pf(){}function V(a,c,b,d,e){c=ie(c);b=Pe(b);y+=a.replace(/X|Y|A|B|F|G/g,function(a){switch(a){case "X":return c.toFixed(2);
case "Y":return b.toFixed(2);case "A":return d;case "B":return e;case "F":return d.toFixed(2);default:return e.toFixed(2)}})}function de(a,c,b,d,e){V('<g transform="translate(X,Y',a,c);b&&(y+=") rotate("+b.toFixed(2));d&&(y=e?y+(") scale("+d.toFixed(2)+", "+e.toFixed(2)):y+(") scale("+d.toFixed(2)));y+=')">\n';D.g++}function ee(){D.g--;y+="</g>\n"}function ie(a){return D.g?a:(a+Jb)/D.scale}function Pe(a){return D.g?-a:1==D.scale?ma-a:0>D.st?(ma-a)/D.scale:D.dy-a}function gb(a,c,b){a=ie(a);b=Pe(b);
y+=a.toFixed(2)+c+b.toFixed(2)}function Sd(a,c,b){V('<path class="A" d="mX Y\n',a,c,b?"fill":"stroke")}function ca(a,c,b){var d=ic[b];d&&!jc[b]?(a+=d.x*D.scale,c-=d.y,d.sc?V('<text transform="translate(X,Y) scale(F)">B</text>\n',a,c,d.sc,d.c):V('<text x="X" y="Y">A</text>\n',a,c,d.c)):jc[b]?(Mf(b),V('<use x="X" y="Y" xlink:href="#A"/>\n',a,c,b)):N(1,null,"no definition of $1",b)}function jf(a,c,b){V('<text style="font:italic 12px serif"\n\tx="X" y="Y" text-anchor="middle">A</text>\n',a,c,b.toString())}
function Qf(a,c,b){var d,e=25+3*(b/20|0);d=15<b?(b-15)/e|0:0;V('<path class="stroke" stroke-width="1.2"\n\tstroke-dasharray="5,A"\n\td="mX YhB"/>\n',a+(b-e*d-5)/2,c+6,Math.round((e-5)/D.scale),e*d+5)}function Tc(a,c,b,d,e,f){var g=d?Fc:3.5,k=-b;0>b&&(g=-g);a+=g*D.scale;0>D.st&&(k/=D.scale);V('<path class="stroke" d="mX YvF"/>\n',a,c,k);if(e){y+='<path class="fill"\n\td="';c+=b;if(0<b)if(f)if(d)for(;0<=--e;)V("MX Yl3 1.5 0 2 -3 -1.5z\n",a,c),c-=3;else for(c+=1;0<=--e;)V("MX Yl7 3.2 0 3.2 -7 -3.2z\n",
a,c),c-=5.4;else if(d)if(1==e)V("MX Yc0.6 3.4 5.6 3.8 3 10\n\t1.2 -4.4 -1.4 -7 -3 -7\n",a,c);else for(;0<=--e;)V("MX Yc1 3.2 5.6 2.8 3.2 8\n\t1.4 -4.8 -2.4 -5.4 -3.2 -5.2\n",a,c),c-=3.5;else if(1==e)V("MX Yc0.6 5.6 9.6 9 5.6 18.4\n\t1.6 -6 -1.3 -11.6 -5.6 -12.8\n",a,c);else for(;0<=--e;)V("MX Yc0.9 3.7 9.1 6.4 6 12.4\n\t1 -5.4 -4.2 -8.4 -6 -8.4\n",a,c),c-=5.4;else if(!f)if(d)if(1==e)V("MX Yc0.6 -3.4 5.6 -3.8 3 -10\n\t1.2 4.4 -1.4 7 -3 7\n",a,c);else for(;0<=--e;)V("MX Yc1 -3.2 5.6 -2.8 3.2 -8\n\t1.4 4.8 -2.4 5.4 -3.2 5.2\n",
a,c),c+=3.5;else if(1==e)V("MX Yc0.6 -5.6 9.6 -9 5.6 -18.4\n\t1.6 6 -1.3 11.6 -5.6 12.8\n",a,c);else for(;0<=--e;)V("MX Yc0.9 -3.7 9.1 -6.4 6 -12.4\n\t1 5.4 -4.2 8.4 -6 8.4\n",a,c),c+=5.4;else if(!d)for(c+=1;0<=--e;)V("MX Yl7 -3.2 0 -3.2 -7 3.2z\n",a,c),c+=5.4;y+='"/>\n'}}function Qe(a,c,b){V('<path class="stroke" stroke-width="0.8" d="mX YhF"/>\n',a,c+3,b)}function Rf(a,c,b,d){var e=Ug[b];e?(a+=e.dx,c+=e.dy,e.def||(nc+="\n."+b+" {"+e.style+"}",e.def=!0),V('<text x="X" y="Y" class="A"B>',a,c,b,e.anchor||
""),va("annotation"),Lf(d),y+="</text>\n"):ca(a,c,b)}function Sf(a,c,b){de(a,c,270);a=0;for(b=Math.ceil(b/6);0<=--b;)ca(a,6,"ltr"),a+=6;ee()}function Tf(a,c,b){c+=4;for(b=Math.ceil(b/6);0<=--b;)ca(a,c,"ltr"),a+=6}function Re(a,c,b,d,e){if(Uf[b])Uf[b](a,c,d,e);else N(1,null,"No function for decoration '$1'",b)}function ta(a){ma+=a}function td(){if(!Ja&&y&&w.img_out&&0!=ma){var a='<svg xmlns="http://www.w3.org/2000/svg" version="1.1"\n\txmlns:xlink="http://www.w3.org/1999/xlink"\n\tcolor="black" class="music" stroke-width=".7"',
c="";r.bgcolor&&(a+=' style="background-color: '+r.bgcolor+'"');ma*=r.scale;a=w.imagesize?a+("\n"+w.imagesize+' viewBox="0 0 '+ha.width.toFixed(0)+" "+ma.toFixed(0)+'">\n'):a+('\n\twidth="'+ha.width.toFixed(0)+'px" height="'+ma.toFixed(0)+'px">\n');if(nc||Vc||Cb)a+='<style type="text/css">'+nc+Vc,Cb&&(a=0<Cb.indexOf("(")?a+('\n.music {font:24px music; fill:currentColor}\n@font-face {\n  font-family:"music";\n  src:'+Cb+"}"):a+("\n.music {font:24px "+Cb+"; fill:currentColor}")),a+="\n</style>\n";(Ad+=
Se)&&(a+="<defs>"+Ad+"\n</defs>\n");1!=r.scale&&(a+='<g class="g" transform="scale('+r.scale.toFixed(2)+')">\n',c="</g>\n");Vf&&Vf.ps_flush(!0);w.img_out(a+y+c+"</svg>");Vc=y="";r.fullsvg?(zd={},pd={}):Se=nc=Cb="";Ad="";ma=0}}function Tb(){!Ja&&w.img_out&&(Lb(),w.page_format&&!Va.started&&(Va.started=!0,Va.newpage?(Va.newpage=!1,w.img_out('<div class="nobrk newpage">')):w.img_out('<div class="nobrk">')))}function Lb(){td();Va.started&&(Va.started=!1,w.img_out("</div>"))}function ra(a){a.fname||Yc(a);
h.ignore||(q.last_sym=a,(a.prev=h.last_sym)?h.last_sym.next=a:h.sym=a,h.last_sym=a);a.v=h.v;a.p_v=h;a.st=h.cst;a.time=h.time;a.dur&&!a.grace&&(h.time+=a.dur);a.pos=h.pos;h.second&&(a.second=!0);h.floating&&(a.floating=!0)}function Xc(a,c){var b={type:c,dur:0},d;d=h;h=a;ra(b);h=d;d=b.prev;d||(d=b.next);d&&(b.fname=d.fname,b.istart=d.istart,b.iend=d.iend);return b}function Wf(a){var c,b,d,e=a.nmes,f=a.dur/e,g=a.a_dd;a.type=k.REST;a.dur=f;a.head=k.FULL;a.nflags=-2;d=a.next;c=a.p_v;c.last_sym=a;c.time=
a.time+f;c.cst=a.st;for(b=a;0<--e;)b=Xc(c,k.BAR),b.bar_type="|",b=Xc(c,k.REST),a.invis&&(b.invis=!0),b.dur=f,b.head=k.FULL,b.nflags=-2,c.time+=f;if(b.next=d)d.prev=b;b.a_dd=g}function Xf(){var a,c,b;(c=ya.tempo)&&0>=Qa&&(b=G.top_voice,a=x[b],a.sym&&a.sym.type!=k.TEMPO&&(c=C(c),c.v=b,c.p_v=a,c.st=a.st,c.time=0,c.next=a.sym,c.next&&(c.next.prev=c),a.sym=c));for(b=0;b<x.length;b++){a=x[b];a.ignore&&(a.ignore=!1);for(c=a.sym;c&&!(c.time>=Qa);c=c.next);for(;c;c=c.next){switch(c.type){case k.GRACE:c.next&&
c.next.type==k.BAR&&c.time--;if(!r.graceword)continue;for(a=c.next;a;a=a.next){switch(a.type){case k.SPACE:continue;case k.NOTE:a.a_ly&&(c.a_ly=a.a_ly,a.a_ly=null)}break}continue}if(c.feathered_beam){var d,e,f,g,l,h;d=c;f=d.dur;var m=1;for(h=d;h&&!h.beam_end&&h.next;h=h.next)m++;if(1>=m)delete d.feathered_beam;else{l=h;e=f/2;a=f/(m-1);g=d.time;if(0<d.feathered_beam)for(h=d,d=m-1;h!=l;h=h.next,d--)f=(a*d|0)+e,h.dur=f,h.time=g,g+=f;else for(h=d,d=0;h!=l;h=h.next,d++)f=(a*d|0)+e,h.dur=f,h.time=g,g+=
f;h.dur=h.time+h.dur-g;h.time=g}}}}}function Yf(){var a,c,b,d,e,f,g,l=x.length;for(f=0;f<l;f++)if(a=x[f],c=a.clone){a.clone=null;for(b=a.sym;b&&!(b.time>=Qa);b=b.next);c.clef=C(a.clef);for(h=c;b;b=b.next)if(b.type!=k.STAVES){a=C(b);if(b.notes)for(a.notes=[],g=0;g<=b.nhd;g++)a.notes.push(C(b.notes[g]));ra(a);c.second?a.second=!0:delete a.second;c.floating?a.floating=!0:delete a.floating;delete a.a_ly;if(d=a.extra)for(e=C(d),a=a.extra=e,a.v=c.v,a.p_v=c,a.st=c.st,d=d.next;d;d=d.next){e=C(d);if(d.notes)for(e.notes=
[],g=0;g<=d.nhd;g++)e.notes.push(C(d.notes[g]));a.next=e;e.prev=a;a=e;a.v=c.v;a.p_v=c;a.st=c.st}}}}function Zf(a){var c,b={voices:[],staves:[],top_voice:0};if(a)B=G=b;else{for(a=0;a<x.length;a++){c=G.voices[a].st;c=G.staves[c];var d=x[a];void 0!=d.staffnonote&&(c.staffnonote=d.staffnonote);d.staffscale&&(c.staffscale=d.staffscale);b.voices[a]=C(G.voices[a]);b.voices[a].range=-1;delete b.voices[a].second}for(c=0;c<G.staves.length;c++)b.staves[c]=C(G.staves[c]),b.staves[c].flags=0;G=G.next=b}}function Te(){var a;
if(!h.ckey.k_bagpipe&&!h.ckey.k_drum&&(r.transp&&h.transp&&u(0,"Mix of old and new transposition syntaxes"),a=(r.transp||0)+(h.transp||0)+(h.shift||0),a!=(h.vtransp||0)))if(h.vtransp=a,a=h.last_sym){for(;a.type!=k.KEY;){if(!a.prev){a=h.key;break}a=a.prev}Xd(a);h.ckey=C(a);h.key.k_none&&(a.k_sf=0)}else h.key=C(h.okey),Xd(h.key),h.ckey=C(h.key),h.key.k_none&&(h.key.k_sf=0)}function yd(a){if(!r.sound)switch(a){case "15ma(":h.ottava=-14;break;case "8va(":h.ottava=-7;break;case "8vb(":h.ottava=7;break;
case "15mb(":h.ottava=14;break;case "15ma)":case "8va)":case "8vb)":case "15mb)":h.ottava=0}}function nf(){var a,c;ja&&(u(1,"No end of voice overlay"),wc(ja.bar?"|":")"));if(0!=x.length){Xf();Yf();var b,d,e,f,g,l,h,m,n=x.length,r=[],p=[],q=-1;for(b=0;b<n;b++)r.push(x[b].sym);for(var v=1,y=B;;){if(y&&v)for(m=y,y=null,f=-1,p=[],b=0;b<n;b++)m.voices[b]?(e=m.voices[b].range,0>e||(p[e]=b,f++)):m.voices[b]={range:-1};d=c=1E6;for(e=0;e<n;e++){b=p[e];if(void 0==b)break;!(a=r[b])||a.time>c||(b=eb[a.type],
a.time<c?(c=a.time,d=b):b<d&&(d=b),a.type==k.MREST&&(1==a.nmes?Wf(a):0<f&&(q=c)))}if(127<d)break;if(c==q){for(e=l=0;e<n;e++){b=p[e];if(void 0==b)break;if((a=r[b])&&a.time==c&&eb[a.type]==d){if(a.type!=k.MREST){q=-1;break}if(0==l)l=a.nmes;else if(l!=a.nmes){q=-1;break}}}if(0>q)for(e=0;e<n;e++){b=p[e];if(void 0==b)break;(a=r[b])&&a.type==k.MREST&&Wf(a)}}for(e=0;e<n;e++){b=p[e];if(void 0==b)break;if((a=r[b])&&a.time==c&&eb[a.type]==d){if(a.type==k.STAVES){y=a.sy;for(l=0;l<n&&void 0!=p[l];l++);for(h=
0;h<n;h++)y.voices[h]&&(e=y.voices[h].range,0>e||0<=m.voices[h].range||(p[l++]=h))}v&&(v=0,a.seqst=!0);(a.ts_prev=g)?g.ts_next=a:S=a;g=a;r[b]=a.next}}v=d}if(S&&(aa.set_bar_num(),S)){w.get_abcmodel&&w.get_abcmodel(S,x,Of,L);w.img_out&&aa.output_music();for(a=0;a<x.length;a++)c=x[a],c.time=0,c.sym=c.last_sym=null,c.st=B.voices[a].st,c.second=B.voices[a].second,delete c.have_ly,c.hy_st=0,delete c.bar_start,delete c.slur_st,delete c.s_tie,delete c.s_rtie;Qa=0}}}function Xd(a){var c=h.vtransp/3|0,c=(c&
-2)+7*(c&1)+a.k_sf;switch((h.vtransp+210)%3){case 1:c=(c+4+48)%12-4;break;case 2:c=(c+7+48)%12-7;break;default:c=(c+5+48)%12-5}a.k_sf=c;a.k_delta=mc[(c+7)%7]}function Vg(a){var c,b,d=h.last_sym.prev;if(d)for(b=d.time;d;d=d.prev)switch(d.type){case k.BAR:if(d.time<b)return;for(;;){d=d.prev;if(!d)return;if(d.type==k.NOTE){if(d.time+d.dur==b)break;return}if(d.time<b)return}for(c=0;c<=d.nhd;c++)if(d.notes[c].pit==a&&d.notes[c].ti1)return d.notes[c].acc;return;case k.NOTE:for(c=0;c<=d.nhd;c++)if(d.notes[c].pit==
a)return d.notes[c].acc}}function wc(a){function c(a){var b,c;for(b=0;b<x.length;b++)if(c=x[b],c.id==a)return c;c=C(h);c.v=x.length;c.id=a;c.sym=c.last_sym=null;delete c.nm;delete c.snm;delete c.new_name;delete c.lyric_restart;delete c.lyric_cont;delete c.ly_a_h;delete c.sym_restart;delete c.sym_cont;delete c.have_ly;x.push(c);return c}var b,d,e;if(!h.ignore)if("|"==a||")"==a)h.last_note?(h.last_note.beam_end=!0,ja?(h.time!=ja.p_voice.time&&(u(1,"Wrong duration in voice overlay"),h.time>ja.p_voice.time&&
(ja.p_voice.time=h.time)),h=ja.p_voice,ja=null):u(1,"Erroneous end of voice overlay")):u(1,P.nonote_vo);else if("("==a)ja?u(1,"Voice overlay already started"):ja={p_voice:h,time:h.time};else if(h.last_note){h.last_note.beam_end=!0;a=h.voice_down;if(!a){a=c(h.id+"o");h.voice_down=a;a.time=0;a.second=!0;e=a.v;G.voices[e]={st:h.st,second:!0};var f=void 0!=h.clone?1:0;d=G.voices[h.v].range;for(b=0;b<G.voices.length;b++)G.voices[b].range>d&&(G.voices[b].range+=f+1);G.voices[e].range=d+1;f&&(b=c(a.id+"c"),
b.second=!0,e=b.v,G.voices[e]={second:!0,range:d+2},a.clone=b)}a.ulen=h.ulen;a.dur_fact=h.dur_fact;h.uscale&&(a.uscale=h.uscale);if(ja)h!=ja.p_voice&&h.time!=ja.p_voice.time&&(u(1,"Wrong duration in voice overlay"),h.time>ja.p_voice.time&&(ja.p_voice.time=h.time));else{ja={bar:!0,p_voice:h};b=a.time;for(d=h.last_sym;!(d.type==k.BAR||d.time<=b);d=d.prev);ja.time=d.time}a.time=ja.time;h=a}else u(1,P.nonote_vo)}function vd(){var a;if(!h.sym)return!0;if(0!=h.time)return!1;for(a=h.last_sym;a;a=a.prev)if(0!=
eb[a.type])return!1;return!0}function $f(a){var c,b;if(vd())h.clef=a;else{for(c=h.last_sym;c&&c.prev&&c.time==h.time&&0==eb[c.type];c=c.prev);if(c&&c.prev&&c.time==h.time&&(c.type==k.KEY&&!c.k_none||c.type==k.BAR)){for(b=c;b.prev;b=b.prev){switch(b.prev.type){case k.KEY:case k.BAR:continue}break}c=h.last_sym;h.last_sym=b.prev;ra(a);a.next=b;b.prev=a;h.last_sym=c}else ra(a);a.clef_small=!0}}function Mc(a){var c,b,d=x.length;if(1==d&&x[0]["default"]&&(delete x[0]["default"],0==x[0].time))return c=x[0],
c.id=a,r.transp&&2<=q.state&&(a=h,h=c,Te(),h=a),c;for(b=0;b<d;b++)if(c=x[b],c.id==a)return c;c={v:b,id:a,time:0,"new":!0,pos:{dyn:0,gch:0,gst:0,orn:0,stm:0,voc:0,vol:0},scale:1,ulen:ya.ulen,dur_fact:1,key:C(q.ckey),ckey:C(q.ckey),okey:C(q.ckey),meter:C(ya.meter),wmeasure:ya.meter.wmeasure,clef:{type:k.CLEF,clef_auto:!0,clef_type:"a",time:0},hy_st:0};x.push(c);G.voices[b]={range:-1};return c}function of(){Q=-1;x=[];h=null;Zf(!0);Qa=-1;K={};qa=[];xb={}}function Gf(a){var c;a=Wd(a,1);var b=a.shift();
if(b)if(0<b.indexOf(",")&&(c=b.split(","),b=c.shift()),2>q.state)0!=a.length&&Ff(b,a),"*"!=b&&1==q.state&&Mc(b);else if("*"==b)u(1,"Cannot have V:* in tune body");else{h=Mc(b);he(a);2==q.state&&Pa();Te();a=h.v;h["new"]&&(delete h["new"],0>Qa&&(h.st=h.cst=++Q,G.nstaff=Q,G.voices[a].st=Q,G.voices[a].range=a,G.staves[Q]={stafflines:"|||||",staffscale:1}),0>G.voices[a].range&&0<=Qa&&(h.ignore=!0));h.stafflines&&void 0!=h.st&&(G.staves[h.st].stafflines=h.stafflines,h.stafflines="");if(!h.filtered&&!h.ignore&&
q.voice_opts){h.filtered=!0;var d,e;for(d in q.voice_opts)if(q.voice_opts.hasOwnProperty(d)&&(a=new RegExp(d),a.test(h.id)||a.test(h.nm)))for(e in q.voice_opts[d])q.voice_opts[d].hasOwnProperty(e)&&aa.do_pscom(q.voice_opts[d][e])}if(c){d=q.file;for(a=e=q.eol+1;;){b=d.indexOf("\n",a);if(0>b){b=0;break}if(/%.*|\n.*|.:.|\[.:/.test(d.slice(b+1,b+4)))break;a=b+1}Kb++;Wc(q.fname,d,e,b);for(a=0;a<c.length;a++)Gf(c[a]),Wc(q.fname,d,e,b);Kb--}}}function Pa(a){var c,b={type:k.STAVES,dur:0,sy:G};q.state=3;0==
x.length?(h=Mc("1"),h.clef.istart=h.key.istart,h.clef.iend=h.key.iend,h["default"]=!0):h||(h=x[0>Qa?0:G.top_voice]);h.init||a||(he([]),Te());for(a=0;a<x.length;a++)c=x[a],c.ulen=ya.ulen,c.ckey.k_bagpipe&&!c.pos.stm&&(c.pos=C(c.pos),c.pos.stm=k.SL_BELOW);if(0>Qa){Q=x.length-1;for(a=0;a<=Q;a++)c=x[a],delete c["new"],c.st=c.cst=G.voices[a].st=G.voices[a].range=a,G.staves[a]={stafflines:"|||||",staffscale:1};G.nstaff=Q}c=h;h=x[G.top_voice];ra(b);0>Qa&&(b["default"]=!0);h=c}function Fg(a,c){var b,d,e,
f,g;if(!h.ignore){if(c){if(b=h.sym_cont,!b){u(1,"+: symbol line without music");return}}else if(h.sym_restart?(h.sym_start=b=h.sym_restart,h.sym_restart=null):b=h.sym_start,b||(b=h.sym),!b){u(1,"s: without music");return}for(e=0;;){for(;" "==a[e]||"\t"==a[e];)e++;d=a[e];if(!d)break;switch(d){case "|":for(;b&&b.type!=k.BAR;)b=b.next;if(!b){u(1,"Not enough measure bars for symbol line");return}b=b.next;e++;continue;case "!":case '"':f=++e;e=a.indexOf(d,f);if(0>e){u(1,"!"==d?"No end of decoration":"No end of guitar chord");
e=a.length;continue}g=a.slice(f-1,e+1);break;case "*":break;default:g=d.charCodeAt(0);if(128>g&&(g=Ua[g],1<g.length&&("!"==g[0]||'"'==g[0]))){d=g[0];break}u(1,P.bad_char,d)}for(;b&&(b.type!=k.NOTE||b.grace);)b=b.next;if(!b){u(1,"Too many elements in symbol line");return}switch(d){case "!":kd([g.slice(1,-1)],b,b.prev);break;case '"':ib=b.a_gch,Kf(g),ib&&aa.gch_build(b)}b=b.next;e++}h.lyric_cont=b}}function Gg(a,c){var b,d,e,f;if(!h.ignore){h.pos.voc!=k.SL_HIDDEN&&(h.have_ly=!0);if(c){if(b=h.lyric_cont,
!b){u(1,"+: lyric without music");return}}else if(va("vocal"),h.lyric_restart?(h.lyric_start=b=h.lyric_restart,h.lyric_restart=null,h.lyric_line=0):(h.lyric_line++,b=h.lyric_start),b||(b=h.sym),!b){u(1,"w: without music");return}for(e=0;;){for(;" "==a[e]||"\t"==a[e];)e++;if(!a[e])break;f=q.istart+e+2;switch(a[e]){case "|":for(;b&&b.type!=k.BAR;)b=b.next;if(!b){u(1,"Not enough measure bars for lyric line");return}b=b.next;e++;continue;case "-":d="-\n";break;case "_":d="_\n";break;case "*":d="";break;
default:if("\\"==a[e]&&e==a.length-1){h.lyric_cont=b;return}for(d="";a[e];){switch(a[e]){case "_":case "*":case "|":e--;case " ":case "\t":break;case "~":d+=" ";e++;continue;case "-":d+="\n";break;case "\\":d+=a[++e];e++;continue;default:d+=a[e++];continue}break}}for(;b&&(b.type!=k.NOTE||b.grace);)b=b.next;if(!b){u(1,"Too many words in lyric line");return}d&&b.pos.voc!=k.SL_HIDDEN&&(d.match(/^\$\d/)&&("0"==d[1]?va("vocal"):va("u"+d[1]),d=d.slice(2)),d={t:d,font:K.curfont,w:Ka(d)[0],istart:f,iend:f+
d.length},b.a_ly||(b.a_ly=[]),b.a_ly[h.lyric_line]=d);b=b.next;e++}h.lyric_cont=b}}function ag(a,c){var b,d,e,f,g,l,h,m,n=a.a_ly;for(h=f=0;h<n.length;h++)if(b=n[h])if(m=b.t,"-\n"==m||"_\n"==m)b.shift=0;else{l=b.w;e=b.font.swfac;g=l+2*hc(" ")*e;a.type==k.GRACE?l=a.wl:"0"<=m[0]&&"9">=m[0]&&2<m.length||":"==m[1]||"("==m[0]||")"==m[0]?("("==m[0]?d=hc("(")*e:(d=m.indexOf(" "),va(b.font),d=0<d?Ka(m.slice(0,d))[0]:l),l=.4*(l-d+2*hc(" ")*e),20<l&&(l=20),l+=d,"0"<=b.t[0]&&"9">=b.t[0]&&l>f&&(f=l)):(l=.4*g,
20<l&&(l=20));b.shift=l;c<l&&(c=l);g-=l;l=2*hc(" ")*e;for(b=a.next;b;b=b.next){switch(b.type){case k.NOTE:case k.REST:if(b.a_ly&&b.a_ly[h]&&0!=b.a_ly[h].w)if("-\n"==b.a_ly[h].t||"_\n"==b.a_ly[h].t)g-=l;else break;else g-=9;if(0>=g)break;continue;case k.CLEF:case k.METER:case k.KEY:g-=10;continue;default:g-=5}break}g>a.wr&&(a.wr=g)}if(0<f)for(h=0;h<n.length;h++)(b=n[h])&&"0"<=b.t[0]&&"9">=b.t[0]&&(b.shift=f);return c}function bg(a,c,b){var d,e,f,g,l,h,m,n,q,p;a.hy_st&1<<c&&(m=!0,a.hy_st&=~(1<<c));
for(g=a.sym;g.type==k.CLEF||g.type==k.KEY||g.type==k.METER;g=g.next);e=g.prev?g.prev.x:S.x;for(q=0;g;g=g.next)if(h=g.a_ly?g.a_ly[c]:null)if(h.font!=K.curfont&&(K.curfont=h.font),d=h.t,f=h.w,p=h.shift,m&&("_\n"==d?d="-\n":"-\n"!=d&&(Qf(e,b,g.x-p-e),m=!1,e=g.x+g.wr)),n&&"_\n"!=d&&(Qe(e+3,b,q-e+3),n=!1,e=g.x+g.wr),"-\n"==d||"_\n"==d)0==q&&e>g.x-18&&(e=g.x-18),"-"==d[0]?m=!0:n=!0,q=g.x-p;else{q=g.x-p;"\n"==d.slice(-1)&&(d=d.slice(0,-1),m=!0);if(w.anno_start||w.anno_stop)l={st:g.st,istart:h.istart,iend:h.iend,
x:q,y:b,ymn:b,ymx:b+K.curfont.size,wl:0,wr:f},ob(l,"lyrics");fa(q,b,d);yb(l,"lyrics");e=q+f}else switch(g.type){case k.REST:case k.MREST:n&&(Qe(e+3,b,q-e),n=!1,e=g.x+g.wr)}m&&(q=za-10,q<e+10&&(q=e+10),Qf(e,b,q-e),r.hyphencont&&(a.hy_st|=1<<c));for(a.s_next;g;g=g.next)if(g.type==k.NOTE){if(!g.a_ly)break;(h=g.a_ly[c])&&"_\n"==h.t&&(n=!0,q=za-15,q<e+12&&(q=e+12));break}n&&Qe(e+3,b,q-e+3)}function cg(a,c,b,d,e){var f=v[a.st].staffscale;va("vocal");if(0<e){d>-r.vocalspace&&(d=-r.vocalspace);d*=f;for(e=
0;e<c;e++)d-=1.1*b[e],bg(a,e,d);return(d-b[e-1]/6)/f}e=v[a.st].topbar+r.vocalspace;d<e&&(d=e);d*=f;for(e=c;0<=--e;)bg(a,e,d),d+=1.1*b[e];return d/f}function Kf(a){function c(){for(var a="";;){b=d[l++];if(0>"1234567890.-".indexOf(b))return parseFloat(a);a+=b}}var b,d,e,f,g,l,t,m,n=kc("annotation"),r=n.size;e=q.line;t=q.bol+e.index;if(1<a.length)d=a.slice(1,-1),m=t+1;else{for(d="";;){b=e.next_char();if(!b){u(1,"No end of guitar chord");return}if('"'==b)break;"\\"==b&&(d+=b,b=e.next_char());d+=b}m=q.bol+
e.index+1}if(h.pos.gch!=k.SL_HIDDEN)for(l=0,a="g";;){b=d[l];if(!b)break;e={text:"",istart:t,iend:m,font:n};switch(b){case "@":a=b;l++;f=c();","!=b?(u(1,"',' lacking in annotation '@x,y'"),g=0):(g=c()," "!=b&&l--);e.x=f;e.y=g-r/2;break;case "^":case "_":case "<":case ">":l++;a=b;break;default:switch(a){case "g":e.font=kc("gchord");break;case "@":e.x=f,g-=r,e.y=g-r/2}}for(e.type=a;;){b=d[l];if(!b)break;switch(b){case "\\":b=d[++l];if(!b||"n"==b)break;e.text+="\\";default:e.text+=b;l++;continue;case "&":for(;;){e.text+=
b;b=d[++l];switch(b){default:continue;case ";":case void 0:case "\\":}break}if(";"==b){e.text+=b;continue}case ";":}l++;break}ib||(ib=[]);ib.push(e)}}function Ue(a,c){var b,d,e,f,g;b=0;switch(a[0]){case "A":d=5;break;case "B":d=6;break;case "C":d=0;break;case "D":if("o"==a[1]){b++;d=0;break}d=1;break;case "E":d=2;break;case "F":"a"==a[1]&&b++;d=3;break;case "G":d=4;break;case "L":b++;d=5;break;case "M":b++;d=2;break;case "R":b++;d=1;break;case "S":b++;"o"==a[1]?(b++,d=4):d=6;break;case "/":b--;break;
default:return a}e=0;f=b+1;if(0<=b){for(;"#"==a[f];)e++,f++;for(;"b"==a[f];)e--,f++;d=Ve[d]+c+7*e;e=mc[(d+112)%7];b=(b?Wg[e]:"CDEFGAB"[e])+dg[(((d+22)/7|0)+159)%5]}else b="";g=a.indexOf("/",f);if(0>g)return b+a.slice(f);d="CDEFGAB".indexOf(a[++g]);if(0>d)return b+a.slice(f);b+=a.slice(f,g);e=0;"#"==a[++g]?(e++,"#"==a[++g]&&(e++,g++)):"b"==a[g]&&(e--,"b"==a[++g]&&(e--,g++));d=Ve[d]+c+7*e;e=mc[(d+112)%7];return b+"CDEFGAB"[e]+dg[(((d+22)/7|0)+159)%5]+a.slice(g)}function Xg(a){for(var c,b,d,e=0,f=h.ckey.k_sf-
h.okey.k_sf;;){c=a.a_gch[e++];if(!c)break;"g"==c.type&&(b=c.text,d=b.indexOf("\t"),0<=d&&(d++,b=b.slice(0,d)+Ue(b.slice(d),f)),c.text=Ue(b,f))}}function Eg(){function a(a){for(var b=0;b<a.length;b++)a[b](aa)}var c=abc2svg.modules.hooks,b=abc2svg.modules.g_hooks;eg?c.length&&(a(c),b.push.apply(b,c),abc2svg.modules.hooks=[]):(c.length&&(b.push.apply(b,c),abc2svg.modules.hooks=[]),a(b),eg=!0)}var k=abc2svg.C,P={bad_char:"Bad character '$1'",bad_val:"Bad value in $1",bar_grace:"Cannot have a bar in grace notes",
ignored:"$1: inside tune - ignored",misplaced:"Misplaced '$1' in %%staves",must_note:"!$1! must be on a note",must_note_rest:"!$1! must be on a note or a rest",nonote_vo:"No note in voice overlay",not_enough_n:"Not enough notes/rests for %%repeat",not_enough_m:"Not enough measures for %%repeat",not_ascii:"Not an ASCII character"},aa=this,ya={meter:{type:k.METER,wmeasure:1,a_meter:[]}},L={},lc={},qd=new Int8Array(128),q={ctx:{},prefix:"%",state:0,line:new sa},Vf,Sc={},qa,xb,jd={dot:"0 stc 5 1 1",tenuto:"0 emb 5 3 3",
slide:"1 sld 3 7 0",arpeggio:"2 arp 12 10 0",roll:"3 roll 7 6 6",fermata:"3 hld 12 7 7",emphasis:"3 accent 7 4 4",lowermordent:"3 lmrd 10 5 5",coda:"3 coda 24 10 10",uppermordent:"3 umrd 10 5 5",segno:"3 sgno 22 8 8",trill:"3 trl 14 5 5",upbow:"3 upb 10 5 5",downbow:"3 dnb 9 5 5",gmark:"3 grm 6 5 5",wedge:"3 wedge 8 3 3",turnx:"3 turnx 10 0 5",breath:"3 brth 0 1 20",longphrase:"3 lphr 0 1 1",mediumphrase:"3 mphr 0 1 1",shortphrase:"3 sphr 0 1 1",invertedfermata:"3 hld 12 7 7",invertedturn:"3 turn 10 0 5",
invertedturnx:"3 turnx 10 0 5",0:"3 fng 8 3 3 0",1:"3 fng 8 3 3 1",2:"3 fng 8 3 3 2",3:"3 fng 8 3 3 3",4:"3 fng 8 3 3 4",5:"3 fng 8 3 3 5",plus:"3 dplus 7 3 3","+":"3 dplus 7 3 3",accent:"3 accent 7 4 4",">":"3 accent 7 4 4",marcato:"3 marcato 9 3 3","^":"3 marcato 9 3 3",mordent:"3 lmrd 10 5 5",open:"3 opend 10 3 3",snap:"3 snap 14 3 3",thumb:"3 thumb 14 3 3",dacapo:"3 dacs 16 20 20 Da Capo",dacoda:"3 dacs 16 20 20 Da Coda","D.C.":"3 dcap 16 10 10","D.S.":"3 dsgn 16 10 10","D.C.alcoda":"3 dacs 16 38 38 D.C. al Coda",
"D.S.alcoda":"3 dacs 16 38 38 D.S. al Coda","D.C.alfine":"3 dacs 16 38 38 D.C. al Fine","D.S.alfine":"3 dacs 16 38 38 D.S. al Fine",fine:"3 dacs 16 10 10 Fine",turn:"3 turn 10 0 5","trill(":"3 ltr 8 0 0","trill)":"3 ltr 8 0 0",f:"6 f 18 1 7",ff:"6 ff 18 2 10",fff:"6 fff 18 4 13",ffff:"6 ffff 18 6 16",mf:"6 mf 18 6 13",mp:"6 mp 18 6 16",p:"6 p 18 2 8",pp:"6 pp 18 5 14",ppp:"6 ppp 18 8 20",pppp:"6 pppp 18 10 25",pralltriller:"3 umrd 10 5 5",sfz:"6 sfz 18 4 10",ped:"4 ped 20 0 0","ped-up":"4 pedoff 20 0 0",
"crescendo(":"7 cresc 18 0 0","crescendo)":"7 cresc 18 0 0","<(":"7 cresc 18 0 0","<)":"7 cresc 18 0 0","diminuendo(":"7 dim 18 0 0","diminuendo)":"7 dim 18 0 0",">(":"7 dim 18 0 0",">)":"7 dim 18 0 0","-(":"8 gliss 0 0 0","-)":"8 gliss 0 0 0","~(":"8 glisq 0 0 0","~)":"8 glisq 0 0 0","8va(":"3 8va 10 0 0","8va)":"3 8va 10 0 0","8vb(":"4 8vb 10 0 0","8vb)":"4 8vb 10 0 0","15ma(":"3 15ma 10 0 0","15ma)":"3 15ma 10 0 0","15mb(":"4 15mb 10 0 0","15mb)":"4 15mb 10 0 0",invisible:"32 0 0 0 0",beamon:"33 0 0 0 0",
trem1:"34 0 0 0 0",trem2:"34 0 0 0 0",trem3:"34 0 0 0 0",trem4:"34 0 0 0 0",xstem:"35 0 0 0 0",beambr1:"36 0 0 0 0",beambr2:"36 0 0 0 0",rbstop:"37 0 0 0 0","/":"38 0 0 6 6","//":"38 0 0 6 6","///":"38 0 0 6 6","beam-accel":"39 0 0 0 0","beam-rall":"39 0 0 0 0",stemless:"40 0 0 0 0",rbend:"41 0 0 0 0"},qg=[!0,!0,!0],Yg=[!1,!1,!1,!0,!0,!0,!1,!1,!0],Cd=[!1,!1,!1,!1,!1,!1,!0,!0],He=[function(a){var c,b,d=a.s,e=a.dd;e.str||(c=(b=d.multi?0<d.multi:0>d.stem)?d.ymx|0:d.ymn-e.h|0,-6<c&&24>c&&(b&&(c+=3),c=
6*((c+6)/6|0)-6),b?d.ymx=c+e.h:d.ymn=c,a.y=c,d.type==k.NOTE&&(a.x+=d.notes[0<=d.stem?0:d.nhd].shhd),"d"==e.name[0]&&-1<=d.nflags&&(b?0<d.stem&&(a.x+=3.5):0>d.stem&&(a.x-=3.5)))},function(a){var c,b,d=a.s,e=d.notes[0].pit,f=5;for(c=0;c<=d.nhd;c++){if(d.notes[c].acc)b=4+d.notes[c].shac;else switch(b=5-d.notes[c].shhd,d.head){case k.SQUARE:b+=3.5;break;case k.OVALBARS:case k.OVAL:b+=2}d.notes[c].pit<=e+3&&b>f&&(f=b)}a.x-=f;a.y=3*(e-18)},function(a){var c,b,d=a.s,e=a.dd,f=5;if(d.type==k.NOTE)for(c=0;c<=
d.nhd;c++){if(d.notes[c].acc)b=5+d.notes[c].shac;else switch(b=6-d.notes[c].shhd,d.head){case k.SQUARE:b+=3.5;break;case k.OVALBARS:case k.OVAL:b+=2}b>f&&(f=b)}b=3*(d.notes[d.nhd].pit-d.notes[0].pit)+4;c=e.h;b<c&&(b=c);a.has_val=!0;a.val=b;a.x-=f;a.y=3*(d.notes[0].pit-18)-3},nb,nb,Rd,function(a){var c,b,d,e=a.s,f=a.dd,g;a.val=f.wl+f.wr;if(d=gc(e,e.pos.vol))a.up=!0;b=e.x-f.wl;0<a.ix&&(g=qa[a.ix-1],g.s==e&&(a.up&&!g.up||!a.up&&g.up)&&(c=g.dd,Cd[c.func]&&(c=g.x+g.val+4,c>b&&(b=c))));a.x=b;a.y=T(e.st,
d,b,a.val);d||(a.y-=f.h)},function(a){if(!a.ldst){var c,b,d,e,f,g=a.s;e=a.start;c=e.s;b=c.x+3;e=e.ix;0<e&&(f=qa[e-1]);a.st=g.st;a.lden=!1;a.has_val=!0;if(e=gc(g,g.pos.dyn))a.up=!0;f&&f.s==c&&(a.up&&!f.up||!a.up&&f.up)&&(d=f.dd,Cd[d.func]&&(f=f.x+f.val+4,f>b&&(b=f)));a.defl.noen?(c=a.x-b,20>c&&(b=a.x-20-3,c=20)):(f=g.x,(g=qa[a.ix+1])&&g.s==c&&(a.up&&!g.up||!a.up&&g.up)&&(d=g.dd,Cd[d.func]&&(f-=5)),c=f-b-4,20>c&&(b-=.5*(20-c),c=20));a.val=c;a.x=b;a.y=T(a.st,e,b,c);e||(b=a.dd,a.y-=b.h)}}],Ye={"8va(":1,
"8va)":1,"15ma(":1,"15ma)":1,"8vb(":1,"8vb)":1,"15mb(":1,"15mb)":1},Fc=2.3,uc,Zg=[[16,16,14,12,10,10],[14,14,10,9,9,9]],fg=new Int8Array([24,9,15,21,6,12,18]),gg=new Int8Array([12,18,24,9,15,21,6]),hg=new Int8Array([-9,12,-9,-9,12,-9]),ig=new Int8Array([12,-9,12,-9,12,-9]),jg=new Int8Array([9,-12,9,-12,9,-12]),kg=new Int8Array([-12,9,-12,9,-12,9]),$g="r128 r64 r32 r16 r8 r4 r2 r1 r0 r00".split(" "),Cb='url("data:application/font-ttf;base64,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ARABEQESARMBFAEVARYBFwEYARkBGgEbARwBHQEeAR8BIAEhASIBIwEkASUBJgEnASgBKQEqASsBLAEtAS4BLwEwATEBMgEzATQBNQE2ATcBOAE5AToBOwE8AT0BPgE/AUABQQFCAUMBRAFFAUYBRwFIAUkBSgFLAUwBTQFOAU8BUAFRAVIBUwFUAVUBVgFXAVgBWQFaAVsBXAFdAV4BXwFgAWEBYgFjAWQBZQFmAWcBaAFpAWoBawFsAW0BbgFvAXABcQFyBi5ub2RlZgd1bmlFMDAwB3VuaUUwMjIHdW5pRTAyMwd1bmlFMDI0B3VuaUUwMzAHdW5pRTAzOAd1bmlFMDM5B3VuaUUwNDMHdW5pRTA0NQd1bmlFMDQ2B3VuaUUwNDcHdW5pRTA0OAd1bmlFMDUwB3VuaUUwNUMHdW5pRTA2Mgd1bmlFMDY5B3VuaUUwN0EHdW5pRTA3Qgd1bmlFMDdDB3VuaUUwN0QHdW5pRTA4MAd1bmlFMDgxB3VuaUUwODIHdW5pRTA4Mwd1bmlFMDg0B3VuaUUwODUHdW5pRTA4Ngd1bmlFMDg3B3VuaUUwODgHdW5pRTA4OQd1bmlFMDhBB3VuaUUwOEIHdW5pRTA4Qwd1bmlFMDk0B3VuaUUwOTUHdW5pRTBBMAd1bmlFMEExB3VuaUUwQTIHdW5pRTBBMwd1bmlFMEE0B3VuaUUwQTkHdW5pRTBCMwd1bmlFMTAxB3VuaUUxQjkHdW5pRTFCQgd1bmlFMUU3B3VuaUUyNjAHdW5pRTI2MQd1bmlFMjYyB3VuaUUyNjMHdW5pRTI2NAd1bmlFMjgwB3VuaUUyODEHdW5pRTI4Mgd1bmlFMjgzB3VuaUU0QTAHdW5pRTRBMgd1bmlFNEE0B3VuaUU0QTgHdW5pRTRBQwd1bmlFNEMwB3VuaUU0Q0UHdW5pRTRFMQd1bmlFNEUyB3VuaUU0RTMHdW5pRTRFNAd1bmlFNEU1B3VuaUU0RTYHdW5pRTRFNwd1bmlFNEU4B3VuaUU0RTkHdW5pRTRFQQd1bmlFNEVFB3VuaUU1MDAHdW5pRTUwMQd1bmlFNTIwB3VuaUU1MjEHdW5pRTUyMgd1bmlFNTI0B3VuaUU1MjUHdW5pRTUyOQd1bmlFNTJBB3VuaUU1MkIHdW5pRTUyQwd1bmlFNTJEB3VuaUU1MkYHdW5pRTUzMAd1bmlFNTMxB3VuaUU1MzkHdW5pRTU2Ngd1bmlFNTY3B3VuaUU1NjkHdW5pRTU2Qwd1bmlFNTZEB3VuaUU1ODIHdW5pRTVEMAd1bmlFNUUyB3VuaUU2MTAHdW5pRTYxMgd1bmlFNjE0B3VuaUU2MTgHdW5pRTYyNAd1bmlFNjMwB3VuaUU2NTAHdW5pRTY1NQd1bmlFOTEwB3VuaUU5MTEHdW5pRTkxNAd1bmlFOTE1B3VuaUU5NUMHdW5pRUEwMgd1bmlFQUE0AAAAAAAAAf//AAIAAAABAAAAANfn3h0AAAAA0ZciFwAAAADX78wJ")',
pd={},zb={},zg=1,kf={serif:1.05,serifBold:1.05,"sans-serif":1.1,"sans-serifBold":1.1,Palatino:1.1,Mono:1.35},lg={},r={aligncomposer:1,breaklimit:.7,breakoneoln:!0,cancelkey:!0,composerspace:6,dblrepbar:":][:",decoerr:!0,dynalign:!0,fullsvg:"",gracespace:new Float32Array([4,8,11]),graceslurs:!0,hyphencont:!0,indent:0,infoname:'R "Rhythm: "\nB "Book: "\nS "Source: "\nD "Discography: "\nN "Notes: "\nZ "Transcription: "\nH "History: "',infospace:0,keywarn:!0,leftmargin:1.4*37.8,lineskipfac:1.1,linewarn:!0,
maxshrink:.65,maxstaffsep:2E3,maxsysstaffsep:2E3,measurefirst:1,measurenb:-1,musicspace:6,parskipfac:.4,partsspace:8,pagewidth:793.8,printmargin:0,rightmargin:1.4*37.8,rbdbstop:!0,rbmax:4,rbmin:2,scale:1,slurheight:1,staffsep:46,stemheight:21,stretchlast:.25,stretchstaff:!0,subtitlespace:3,sysstaffsep:34,textspace:14,titlespace:6,titletrim:!0,topspace:22,tuplets:[0,0,0,0],vocalspace:10,writefields:"CMOPQsTWw",wordsspace:5},mg={align:"j",center:"c",fill:"f",justify:"j",ragged:"f",right:"r",skip:"s"},
We={above:k.SL_ABOVE,auto:0,below:k.SL_BELOW,down:k.SL_BELOW,hidden:k.SL_HIDDEN,opposite:k.SL_HIDDEN,under:k.SL_BELOW,up:k.SL_ABOVE};Abc.prototype.style_font=mf;var Bg={"=D":"\u0110","=H":"\u0126","=T":"\u0166","=d":"\u0111","=h":"\u0127","=t":"\u0167","/O":"\u00d8","/o":"\u00f8","/L":"\u0141","/l":"\u0142",vL:"\u013d",vl:"\u013e",vd:"\u010f",".i":"\u0131",AA:"\u00c5",aa:"\u00e5",AE:"\u00c6",ae:"\u00e6",DH:"\u00d0",dh:"\u00f0",OE:"\u0152",oe:"\u0153",ss:"\u00df",TH:"\u00de",th:"\u00fe"},Ag={1:"\u266f",
2:"\u266d",3:"\u266e",4:"&#x1d12a;",5:"&#x1d12b;"},Kb=0;Abc.prototype.tosvg=Wc;var K,v,Q,Sb,za,Vd,je,Bb=new Float32Array([7,10,14.15,20,28.3,40,56.6,80,100,120]),sd,rf=new Float32Array([10,10,11,13,13]),ah=new Float32Array([4.5,5,6,7,8]),qe=new Float32Array([3.5,3.7,5,6,7]),Xe={t:-4,c:0,b:4,p:-6},ng=[[18,18],[12,18],[12,12],[0,12],[6,8],[10,10],[6,4],[10,0],[10,4],[10,10]],re=[],ib,ea,Ja,Ub={},Qg=new Int8Array([0,1,3,2,3,0,2,0,3,0]),xd="CDEFGABcdefgab",Ng=new Int8Array([0,2,4,5,7,9,11]),wd=/(\d*)(\/*)(\d*)/g,
Ve=new Int8Array([0,2,4,-1,1,3,5]),mc=new Int8Array([0,4,1,5,2,6,3]),bh=new Int8Array([-2,-1,3,1,2]),F=["0"],Ua=[F,F,F,F,F,F,F,F,F," ","\n",F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F," ","!",'"',"i","\n",F,"&",F,"(",")","i",F,F,"-","!dot!",F,F,F,F,F,F,F,F,F,F,F,"|","i","<","n","<","i","i","n","n","n","n","n","n","n","!fermata!","d","d","d","!emphasis!","!lowermordent!","d","!coda!","!uppermordent!","d","d","!segno!","!trill!","d","d","d","n","d","n","[","\\","|","n","n","i","n","n","n","n","n","n",
"n","d","d","d","d","d","d","d","d","d","d","d","d","d","!upbow!","!downbow!","d","n","n","n","{","|","}","!gmark!",F],Rg=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.25,.333,.408,.5,.5,.833,.778,.333,.333,.333,.5,.564,.25,.564,.25,.278,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.278,.278,.564,.564,.564,.444,.921,.722,.667,.667,.722,.611,.556,.722,.722,.333,.389,.722,.611,.889,.722,.722,.556,.722,.667,.556,.611,.722,.722,.944,.722,.722,.611,.333,.278,.333,.469,.5,.333,.444,
.5,.444,.5,.444,.333,.5,.5,.278,.278,.5,.278,.778,.5,.5,.5,.5,.333,.389,.278,.5,.5,.722,.5,.5,.444,.48,.2,.48,.541,.5]),Pg={A:"info",C:"composer",O:"composer",P:"parts",Q:"tempo",R:"info",T:"title",X:"title"},y="",nc="\n.fill {fill: currentColor}\n.stroke {stroke: currentColor; fill: none}\n.music text, .music tspan {fill:currentColor}",Vc="",Jb=r.leftmargin/r.scale,ma=0,ha={width:r.pagewidth,lm:r.leftmargin,rm:r.rightmargin},zd={},Ad="",Se="",D={scale:1,dy:0,st:-1,v:0,g:0},Va={},ic={brace:{x:0,y:0,
c:"\ue000"},hl:{x:-4,y:0,c:"\ue022"},hl1:{x:-6,y:0,c:"\ue023"},hl2:{x:-6,y:0,c:"\ue023"},ghl:{x:-4,y:0,c:"\ue024"},lphr:{x:0,y:24,c:"\ue030"},mphr:{x:0,y:24,c:"\ue038"},sphr:{x:0,y:27,c:"\ue039"},rdots:{x:-1,y:0,c:"\ue043"},dsgn:{x:-4,y:-4,c:"\ue045"},dcap:{x:-4,y:-4,c:"\ue046"},sgno:{x:-6,y:0,c:"\ue047"},coda:{x:-12,y:-6,c:"\ue048"},tclef:{x:-8,y:0,c:"\ue050"},cclef:{x:-8,y:0,c:"\ue05c"},bclef:{x:-8,y:0,c:"\ue062"},pclef:{x:-6,y:0,c:"\ue069"},spclef:{x:-6,y:0,c:"\ue069"},stclef:{x:-8,y:0,c:"\ue07a"},
scclef:{x:-8,y:0,c:"\ue07b"},sbclef:{x:-7,y:0,c:"\ue07c"},oct:{x:0,y:2,c:"\ue07d"},meter0:{c:"\ue080"},meter1:{c:"\ue081"},meter2:{c:"\ue082"},meter3:{c:"\ue083"},meter4:{c:"\ue084"},meter5:{c:"\ue085"},meter6:{c:"\ue086"},meter7:{c:"\ue087"},meter8:{c:"\ue088"},meter9:{c:"\ue089"},"meter+":{c:"\ue08c"},"meter(":{c:"\ue094"},"meter)":{c:"\ue095"},csig:{x:0,y:0,c:"\ue08a"},ctsig:{x:0,y:0,c:"\ue08b"},HDD:{x:-7,y:0,c:"\ue0a0"},breve:{x:-6,y:0,c:"\ue0a1"},HD:{x:-5.2,y:0,c:"\ue0a2"},Hd:{x:-3.8,y:0,c:"\ue0a3"},
hd:{x:-3.7,y:0,c:"\ue0a4"},ghd:{x:2,y:0,c:"\ue0a4",sc:.66},pshhd:{x:-3.7,y:0,c:"\ue0a9"},pfthd:{x:-3.7,y:0,c:"\ue0b3"},x:{x:-3.7,y:0,c:"\ue0a9"},"circle-x":{x:-3.7,y:0,c:"\ue0b3"},srep:{x:-5,y:0,c:"\ue101"},diamond:{x:-4,y:0,c:"\ue1b9"},triangle:{x:-4,y:0,c:"\ue1bb"},dot:{x:-2,y:0,c:"\ue1e7"},"acc-1":{x:-3,y:0,c:"\ue260"},acc3:{x:-2,y:0,c:"\ue261"},acc1:{x:-3,y:0,c:"\ue262"},acc2:{x:-3,y:0,c:"\ue263"},"acc-2":{x:-3,y:0,c:"\ue264"},"acc-1_1_4":{x:-3,y:0,c:"\ue280"},"acc-1_3_4":{x:-4,y:0,c:"\ue281"},
acc1_1_4:{x:-2,y:0,c:"\ue282"},acc1_3_4:{x:-4,y:0,c:"\ue283"},accent:{x:-3,y:0,c:"\ue4a0"},stc:{x:-1,y:-2,c:"\ue4a2"},emb:{x:-4,y:-2,c:"\ue4a4"},wedge:{x:-1,y:0,c:"\ue4a8"},marcato:{x:-3,y:0,c:"\ue4ac"},hld:{x:-7,y:0,c:"\ue4c0"},brth:{x:0,y:0,c:"\ue4ce"},r00:{x:-1.5,y:0,c:"\ue4e1"},r0:{x:-1.5,y:0,c:"\ue4e2"},r1:{x:-3.5,y:-6,c:"\ue4e3"},r2:{x:-3.2,y:0,c:"\ue4e4"},r4:{x:-3,y:0,c:"\ue4e5"},r8:{x:-3,y:0,c:"\ue4e6"},r16:{x:-4,y:0,c:"\ue4e7"},r32:{x:-4,y:0,c:"\ue4e8"},r64:{x:-4,y:0,c:"\ue4e9"},r128:{x:-4,
y:0,c:"\ue4ea"},mrest:{x:-10,y:0,c:"\ue4ee"},mrep:{x:-6,y:0,c:"\ue500"},mrep2:{x:-9,y:0,c:"\ue501"},p:{x:-4,y:-6,c:"\ue520"},f:{x:-4,y:-6,c:"\ue522"},pppp:{x:-4,y:-6,c:"\ue529"},ppp:{x:-4,y:-6,c:"\ue52a"},pp:{x:-4,y:-6,c:"\ue52b"},mp:{x:-4,y:-6,c:"\ue52c"},mf:{x:-4,y:-6,c:"\ue52d"},ff:{x:-4,y:-6,c:"\ue52f"},fff:{x:-4,y:-6,c:"\ue530"},ffff:{x:-4,y:-6,c:"\ue531"},sfz:{x:-4,y:-6,c:"\ue539"},trl:{x:-4,y:-4,c:"\ue566"},turn:{x:-5,y:-4,c:"\ue567"},turnx:{x:-5,y:-4,c:"\ue569"},umrd:{x:-7,y:-2,c:"\ue56c"},
lmrd:{x:-7,y:-2,c:"\ue56d"},dplus:{x:-4,y:10,c:"\ue582"},sld:{x:-8,y:12,c:"\ue5d4"},grm:{x:-2,y:0,c:"\ue5e2"},dnb:{x:-4,y:0,c:"\ue610"},upb:{x:-3,y:0,c:"\ue612"},opend:{x:-2,y:0,c:"\ue614"},roll:{x:0,y:0,c:"\ue618"},thumb:{x:0,y:0,c:"\ue624"},snap:{x:-2,y:0,c:"\ue630"},ped:{x:-10,y:0,c:"\ue650"},pedoff:{x:-5,y:0,c:"\ue655"},pMsig:{x:-6,y:-12,c:"\ue910"},pmsig:{x:-6,y:-12,c:"\ue911"},iMsig:{x:-6,y:-12,c:"\ue914"},imsig:{x:-6,y:-12,c:"\ue915"},longa:{x:-6,y:0,c:"\ue95c"},custos:{x:-4,y:3,c:"\uea02"},
ltr:{x:2,y:6,c:"\ueaa4"}},jc={},Of="bar clef custos  grace key meter Zrest note part rest yspace staves Break tempo  block remark".split(" "),ob=w.anno_start?Sg:Pf,yb=w.anno_stop?Tg:Pf;Abc.prototype.out_svg=function(a){y+=a};Abc.prototype.sx=ie;Abc.prototype.sy=Pe;Abc.prototype.sh=function(a){return 0>D.st?a/D.scale:a};Abc.prototype.ax=function(a){return a+Jb};Abc.prototype.ay=function(a){return 0>D.st?ma-a:ma+(D.dy-a)*D.scale-D.dy};Abc.prototype.ah=function(a){return 0>D.st?a:a*D.scale};Abc.prototype.out_sxsy=
gb;Abc.prototype.xypath=Sd;var Ug={crdc:{dx:0,dy:5,style:"font:italic 14px serif"},dacs:{dx:0,dy:3,style:"font:16px serif",anchor:' text-anchor="middle"'},fng:{dx:0,dy:1,style:"font-family:Bookman; font-size:8px",anchor:' text-anchor="middle"'},pf:{dx:0,dy:5,style:"font:italic bold 16px serif"},"@":{dx:0,dy:5,style:"font: 12px sans-serif"}},Uf={arp:Sf,cresc:function(a,c,b,d){a+=b;b=-b;V('<path class="stroke"\n\td="mX YlA ',a,c+5,b);y=d.nost?y+("-2.2m0 -3.6l"+(-b).toFixed(2)+' -2.2"/>\n'):y+("-4l"+
(-b).toFixed(2)+' -4"/>\n')},dim:function(a,c,b,d){V('<path class="stroke"\n\td="mX YlA ',a,c+5,b);y=d.noen?y+("-2.2m0 -3.6l"+(-b).toFixed(2)+' -2.2"/>\n'):y+("-4l"+(-b).toFixed(2)+' -4"/>\n')},ltr:Tf,"8va":function(a,c,b,d){d.nost?b-=5:(V('<text x="X" y="Y" style="font:italic bold 12px serif">8<tspan dy="-4" style="font-size:10px">va</tspan></text>\n',a-8,c),a+=12,b-=12);c+=6;V('<path class="stroke" stroke-dasharray="6,6" d="mX YhA"/>\n',a,c,b);d.noen||V('<path class="stroke" d="mX Yv6"/>\n',a+b,
c)},"8vb":function(a,c,b,d){d.nost?b-=5:(V('<text x="X" y="Y" style="font:italic bold 12px serif">8<tspan dy="-4" style="font-size:10px">vb</tspan></text>\n',a-8,c),a+=4,b-=4);V('<path class="stroke" stroke-dasharray="6,6" d="mX YhA"/>\n',a,c,b);d.noen||V('<path class="stroke" d="mX Yv-6"/>\n',a+b,c)},"15ma":function(a,c,b,d){d.nost?b-=5:(V('<text x="X" y="Y" style="font:italic bold 12px serif">15<tspan dy="-4" style="font-size:10px">ma</tspan></text>\n',a-10,c),a+=20,b-=20);c+=6;V('<path class="stroke" stroke-dasharray="6,6" d="mX YhA"/>\n',
a,c,b);d.noen||V('<path class="stroke" d="mX Yv6"/>\n',a+b,c)},"15mb":function(a,c,b,d){d.nost?b-=5:(V('<text x="X" y="Y" style="font:italic bold 12px serif">15<tspan dy="-4" style="font-size:10px">mb</tspan></text>\n',a-10,c),a+=7,b-=7);V('<path class="stroke" stroke-dasharray="6,6" d="mX YhA"/>\n',a,c,b);d.noen||V('<path class="stroke" d="mX Yv-6"/>\n',a+b,c)}},og={glisq:function(a,c,b){b=b.start;var d=b.x,e=b.y+v[b.st].y;c=Math.atan2(e-c,a-d);a=(a-d)/Math.cos(c);de(d,e,c/Math.PI*180);d=b.s.dots?
13+b.s.xmx:8;a=(a-d-6)/6|0;for(1>a&&(a=1);0<=--a;)ca(d,0,"ltr"),d+=6;ee()},gliss:function(a,c,b){b=b.start;var d=b.x,e=b.y+v[b.st].y;c=-Math.atan2(c-e,a-d);a=(a-d)/Math.cos(c);de(d,e,c/Math.PI*180);d=b.s.dots?13+b.s.xmx:8;a-=d+8;Sd(d,0);y+="l"+a.toFixed(2)+' 0" stroke-width="1"/>\n';ee()}};Abc.prototype.blk_out=Tb;Abc.prototype.blk_flush=Lb;var G,B,x,h,Qa,ja,S,eb=new Uint8Array([2,1,8,0,3,5,6,9,9,0,9,3,0,7,0,0,0,0]),Wg="Do Re Mi Fa Sol La Si".split(" "),dg=["bb","b","","#","##"];La("annotationfont",
"sans-serif 12");La("composerfont","serifItalic 14");La("footerfont","serif 16");La("gchordfont","sans-serif 12");La("headerfont","serif 16");La("historyfont","serif 16");La("infofont","serifItalic 14");La("measurefont","serifItalic 14");La("partsfont","serif 15");La("repeatfont","serif 13");La("subtitlefont","serif 16");La("tempofont","serifBold 15");La("textfont","serif 16");La("titlefont","serif 20");La("vocalfont","serifBold 13");La("voicefont","serifBold 13");La("wordsfont","serif 16");of();
Abc.prototype.add_style=function(a){nc+=a};Abc.prototype.calculate_beam=function(a,c){var b,d,e,f,g,l,h,m,n,q,p,u,x,w,z;c.beam_st||(d=b=cf(c),f=c,d.next=f,d.prev=f.prev,d.prev?d.prev.next=d:d.p_v.sym=d,f.prev=d,Hc(b,c),b.x-=12,b.x>c.prev.x+12&&(b.x=c.prev.x+12),b.beam_st=!0,delete b.beam_end,b.tmp=!0,delete b.slur_start,delete b.slur_end,c=b);e=f=0;h=m=!1;g=c.st;l=c.v;u=c.grace?Fc:3.5;for(d=c;d.type!=k.NOTE||(d.nflags>f&&(f=d.nflags),e++,d.st!=g&&(h=!0),d.stem!=c.stem&&(m=!0),n||d.invis||d.stemless&&
!d.trem2||(n=!0),!d.beam_end);d=d.next)if(!d.next){for(;d.type!=k.NOTE;d=d.prev);b=cf(d);b.next=d.next;b.next&&(b.next.prev=b);d.next=b;b.prev=d;b.ts_next=d.ts_next;b.ts_next&&(b.ts_next.ts_prev=b);d.ts_next=b;b.ts_prev=d;delete b.beam_st;b.beam_end=!0;b.tmp=!0;delete b.slur_start;delete b.slur_end;b.x+=12;b.x<za-12&&(b.x=za-12);d=b;e++;break}if(!n)return!1;a.s2=d;if(0==v[g].y){if(h)return!1}else if(!h)return a.s1=c,a.a=(c.ys-d.ys)/(c.xs-d.xs),a.b=c.ys-c.xs*a.a+v[g].y,a.nflags=f,!0;w=c;x=100;p=0;
for(b=c;b.type!=k.NOTE||(1==(z=b.p_v.scale)&&(z=v[b.st].staffscale),0<=b.stem?(n=u+b.notes[0].shhd,b.notes[b.nhd].pit>p&&(p=b.notes[b.nhd].pit,w=b)):(n=-u+b.notes[b.nhd].shhd,b.notes[0].pit<x&&(x=b.notes[0].pit,w=b)),b.xs=b.x+n*z,b!=d);b=b.next);r.flatbeams?q=0:!m&&3<=e&&w!=c&&w!=d&&(q=0);n=c.ys+v[g].y;void 0==q&&(q=(d.ys+v[d.st].y-n)/(d.xs-c.xs));0!=q&&(q=0<q?.4*q/(.4+q):.4*q/(.4-q));e=n-q*c.xs;u=0;b=c;if(m)n=.5*((c.grace?3.5:5)*(f-1)+3.2),n=c.stem!=d.stem&&c.nflags<d.nflags?n*d.stem:n*c.stem,e+=
n;else if(c.grace)for(;n=q*b.xs+e-v[b.st].y,p=13,p=0<b.stem?p-(n-3*(b.notes[b.nhd].pit-18)):p+(n-3*(b.notes[0].pit-18)),p+=3*(b.nflags-1),p>u&&(u=p),b!=d;b=b.next);else{for(x=3.2+5*(f-1);b.ts_prev&&b.ts_prev.type==k.NOTE&&b.ts_prev.time==b.time&&b.ts_prev.x>c.xs;)b=b.ts_prev;for(;b&&b.time<=d.time;b=b.ts_next)if(!(b.type!=k.NOTE||b.invis||b.st!=g&&b.v!=l)){n=b.v==l?b.xs:b.x;n=q*n+e-v[b.st].y;if(b.v==l)p=Zg[0==b.nhd?0:1][b.nflags],0<b.stem?(26<b.notes[b.nhd].pit&&(p-=2,28<b.notes[b.nhd].pit&&(p-=2)),
p-=n-3*(b.notes[b.nhd].pit-18)):(18>b.notes[0].pit&&(p-=2,16>b.notes[0].pit&&(p-=2)),p-=3*(b.notes[0].pit-18)-n),p+=3.2+5*(b.nflags-1);else{if(0<c.stem)if(0<b.stem){if(b.ymn>n+4||b.ymx<n-x-2)continue;p=b.v>l?b.ymx-n:b.ymn+8-n}else p=b.ymx-n;else if(0>b.stem){if(b.ymx<n-4||b.ymn>n-x-2)continue;p=b.v<l?n-b.ymn:n-b.ymx+8}else p=n-b.ymn;p+=2+x}p>u&&(u=p)}}0<u&&(e+=c.stem*u);if(!h&&!m)for(b=c.next;;b=b.next){switch(b.type){case k.REST:if(l=b.ts_next,!l||l.st!=g||l.type!=k.NOTE&&l.type!=k.REST)break;case k.BAR:if(b.invis)break;
case k.CLEF:n=q*b.x+e;0<c.stem?(n=b.ymx-n+3.2+5*(f-1)+2,0<n&&(e+=n)):(n=b.ymn-n-3.2-5*(f-1)-2,0>n&&(e+=n));break;case k.GRACE:for(l=b.extra;l;l=l.next)n=q*l.x+e,0<c.stem?(n=l.ymx-n+3.2+5*(f-1)+2,0<n&&(e+=n)):(n=l.ymn-n-3.2-5*(f-1)-2,0>n&&(e+=n))}if(b==d)break}0==q&&(e+=rg(c.grace,c.stem,f,e-v[g].y));for(b=c;;b=b.next){switch(b.type){case k.NOTE:b.ys=q*b.xs+e-v[b.st].y;0<b.stem?(b.ymx=b.ys+2.5,b.ts_prev&&0<b.ts_prev.stem&&b.ts_prev.st==b.st&&b.ts_prev.ymn<b.ymx&&b.ts_prev.x==b.x&&0==b.notes[0].shhd&&
(b.ts_prev.x-=3,b.ts_prev.xs-=3)):b.ymn=b.ys-2.5;break;case k.REST:n=q*b.x+e-v[b.st].y;l=3.2+5*(f-1)+(b.head!=k.FULL?4:9);if(0<c.stem){if(n-=l,0==c.multi&&12<n&&(n=12),b.y<=n)break}else if(n+=l,0==c.multi&&12>n&&(n=12),b.y>=n)break;b.head!=k.FULL&&(n=6*((n+3+12)/6|0)-12);b.y=n}if(b==d)break}if(0==v[g].y)return!1;a.s1=c;a.a=q;a.b=e;a.nflags=f;return!0};Abc.prototype.cfmt=function(){return r};Abc.prototype.clone=C;Abc.prototype.deco_cnv=kd;Abc.prototype.do_pscom=function(a){var c,b,d=!1;" lock"==a.slice(-5)&&
(d=!0,a=a.slice(0,-5).trim());if(b=a.match(/(\w|-)+/)){b=b[0];a=a.replace(b,"").trim();switch(b){case "center":if(2<=q.state){b=Ab("text");b.text=hb(a);b.opt="c";return}Mb(hb(a),"c");return;case "clef":2<=q.state&&(2==q.state&&Pa(),(b=Df(a))&&$f(b));return;case "deco":b=a.match(/(\S*)\s+(.*)/);jd[b[1]]=b[2];return;case "linebreak":for(b=0;128>b;b++)"\n"==Ua[b]&&(Ua[b]=F);a=a.split(/\s+/);for(b=0;b<a.length;b++){c=a[b];switch(c){case "!":case "$":case "*":case ";":case "?":case "@":break;case "<none>":continue;
case "<EOL>":c="\n";break;default:u(1,"Bad value '$1' in %%linebreak - ignored",c);continue}Ua[c.charCodeAt(0)]="\n"}return;case "map":a:if(a)if(b=Wd(a,2),3>b.length)u(1,"Not enough parameters in %%map");else{d=b[1];if(0==d.indexOf("octave,")||0==d.indexOf("key,"))d=d.replace(/[,']+$/m,"").toLowerCase(),"k"==d[0]&&(d=d.replace(/[_=^]+/,""));else if("*"==d[0]||0==d.indexOf("all"))d="all";else{d=new sa;d.buffer=b[1];a=Nb(d);if(!a){u(1,"Bad note in %%map");break a}d=Jf(a)}(c=Ub[b[0]])||(Ub[b[0]]=c={});
(a=c[d])||(c[d]=a=[]);if(b[2]){c=2;if(0>b[2].indexOf("=")){"*"!=b[2][0]&&(d=new sa,d.buffer=b[2],a[1]=Nb(d));if(!b[3])break a;c++;0>b[3].indexOf("=")&&(a[0]=b[3].split(","),c++)}for(;c<b.length;c++)switch(b[c]){case "heads=":a[0]=b[++c].split(",");break;case "print=":if("play"==r.sound)break;d=new sa;d.buffer=b[++c];a[1]=Nb(d);break;case "color=":a[2]=b[++c]}}}return;case "maxsysstaffsep":if(3==q.state){G.voices[h.v].maxsep=qb(a);return}break;case "multicol":nf();switch(a){case "start":Tb();Ja={posy:ma,
maxy:ma,lmarg:r.leftmargin,rmarg:r.rightmargin,state:q.state};break;case "new":if(!Ja){u(1,"%%multicol new without start");break}ma>Ja.maxy&&(Ja.maxy=ma);r.leftmargin=Ja.lmarg;r.rightmargin=Ja.rmarg;ha.chg=!0;Ta();ma=Ja.posy;break;case "end":if(!Ja){u(1,"%%multicol end without start");break}ma<Ja.maxy&&(ma=Ja.maxy);r.leftmargin=Ja.lmarg;r.rightmargin=Ja.rmarg;Ja=void 0;Lb();ha.chg=!0;Ta();break;default:u(1,"Unknown keyword '$1' in %%multicol",a)}return;case "musicfont":Cb=a;return;case "ottava":if(3!=
q.state){if(2!=q.state)return;Pa()}b=parseInt(a);if(isNaN(b)||-2>b||2<b){u(1,P.bad_val,"%%ottava");return}switch(h.ottava){case 14:c="15mb)";break;case 7:c="8vb)";break;case -7:c="8va)";break;case -14:c="15ma)"}c&&(ea||(ea=[]),ea.push(c),yd(c));switch(b){case -2:c="15mb(";break;case -1:c="8vb(";break;case 0:return;case 1:c="8va(";break;case 2:c="15ma("}ea||(ea=[]);ea.push(c);yd(c);return;case "repbra":2<=q.state&&(2==q.state&&Pa(),h.norepbra=!vc(a));return;case "repeat":if(3!=q.state)return;if(!h.last_sym){u(1,
"%%repeat cannot start a tune");return}if(a.length){c=a.split(/\s+/);b=parseInt(c[0]);a=parseInt(c[1]);if(isNaN(b)||1>b||h.last_sym.type==k.BAR&&2<b){u(1,"Incorrect 1st value in %%repeat");return}if(isNaN(a))a=1;else if(1>a){u(1,"Incorrect 2nd value in %%repeat");return}}else a=b=1;q.repeat_n=h.last_sym.type==k.BAR?b:-b;q.repeat_k=a;return;case "sep":var e,f;Ta();f=ha.width-ha.lm-ha.rm;c=d=e=0;a&&(a=a.split(/\s+/),c=qb(a[0]),a[1]&&(d=qb(a[1]),a[2]&&(e=qb(a[2]))));1>c&&(c=14);1>d&&(d=c);1>e&&(e=90);
if(2<=q.state){b=Ab(b);b.x=(f-e)/2/r.scale;b.l=e/r.scale;b.sk1=c;b.sk2=d;return}Tb();ta(c);y+='<path class="stroke"\n\td="M';gb((f-e)/2/r.scale," ",0);y+="h"+(e/r.scale).toFixed(2)+'"/>\n';ta(d);Lb();return;case "setbarnb":c=parseInt(a);isNaN(c)?u(1,"Bad %%setbarnb value"):2<=q.state?ya.new_nbar=c:r.measurefirst=c;return;case "staff":if(3!=q.state){if(2!=q.state)return;Pa()}c=parseInt(a);if(isNaN(c)){u(1,"Bad %%staff value '$1'",a);return}b="+"==a[0]||"-"==a[0]?h.cst+c:c-1;if(0>b||b>Q){u(1,"Bad %%staff number $1 (cur $2, max $3)",
b,h.cst,Q);return}delete h.floating;h.cst=b;return;case "staffbreak":if(3!=q.state){if(2!=q.state)return;Pa()}b={type:k.STBRK,dur:0};"0"<=a[0]&&"9">=a[0]?(b.xmx=qb(a),"f"==a.slice(-1)&&(b.stbrk_forced=!0)):(b.xmx=14,"f"==a[0]&&(b.stbrk_forced=!0));ra(b);return;case "stafflines":case "staffscale":case "staffnonote":aa.set_v_param(b,a);return;case "staves":case "score":if(0==q.state)return;var g,l;d=[];e=!1;for(var t=l=g=f=0,m=0,n=0;n<a.length;){switch(a[n]){case " ":case "\t":break;case "[":if(t||
2<=g+l){u(1,P.misplaced,"[");e=!0;break}f|=0==g+l?4:1024;l++;m<<=8;m|=4;break;case "{":if(t||g||2<=l){u(1,P.misplaced,"{");e=!0;break}f|=l?256:1;g++;m<<=8;m|=1;break;case "(":if(t){u(1,P.misplaced,"(");e=!0;break}f|=16;t++;m<<=8;m|=16;break;case "*":!g||t||f&257||(f|=128);break;case "+":f|=4096;break;default:if(/\w/.test(a[n])){for(c="";n<a.length&&!(0<=" \t()[]{}|*".indexOf(a[n]));)c+=a[n++];for(;n<a.length;n++){switch(a[n]){case " ":case "\t":continue;case "]":if(!(m&4)){u(1,P.misplaced,"]");e=
!0;break}l--;f|=0==g+l?8:2048;m>>=8;continue;case "}":if(!(m&1)){u(1,P.misplaced,"}");e=!0;break}g--;f|=l?512:2;f&=-129;m>>=8;continue;case ")":if(!(m&16)){u(1,P.misplaced,")");e=!0;break}t--;f|=32;m>>=8;continue;case "|":f|=64;continue}break}d.push([c,f]);f=0;continue}else u(1,"Bad voice ID in %%staves"),e=!0}n++}0!=m&&(u(1,"'}', ')' or ']' missing in %%staves"),e=!0);a=e||0==d.length?void 0:d;if(a){0!=x.length&&(Xf(),Yf());f=0;d=!0;for(e=0;e<x.length;e++)c=x[e],c.time>f&&(f=c.time),c.sym&&(d=!1);
if(d||0==f&&0>Qa)for(e=0;e<G.voices.length;e++)G.voices[e].range=-1;else{for(e=0;e<G.voices.length;e++)if(0<=G.voices[e].range){h=x[e];break}h.time=f;c={type:k.STAVES,dur:0};ra(c);G.nstaff=Q;Zf();c.sy=G}Qa=f;for(e=0;e<x.length;e++)c=x[e],delete c.second,delete c.ignore,delete c.floating;for(d=l=0;d<a.length;d++){c=a[d][0];c=Mc(c);c.time=f;e=c.v;0==d&&(G.top_voice=c.v);if(0<=G.voices[e].range){g=C(c);G.voices[x.length]=C(G.voices[e]);e=x.length;g.v=e;g.sym=g.last_sym=null;g.time=f;x.push(g);for(delete g.clone;c.clone;)c=
c.clone;c=c.clone=g}a[d][0]=c;G.voices[e].range=l++}if("t"==b[1])for(d=0;d<a.length;d++)g=a[d][1],g&257&&3!=(g&3)&&768!=(g&768)&&0==a[d+1][1]&&!(g&16||a[d+2][1]&16)&&(a[d+2][1]&514?a[d+1][1]|=128:0==a[d+2][1]&&a[d+3][1]&514&&(a[d][1]|=16,a[d+1][1]|=32,a[d+2][1]|=16,a[d+3][1]|=32));f=-1;for(d=0;d<a.length;d++)if(g=a[d][1],48==(g&48)&&(g&=-49,a[d][1]=g),c=a[d][0],g&128?(c.floating=!0,c.second=!0):(f++,G.staves[f]||(G.staves[f]={stafflines:"|||||",staffscale:1}),G.staves[f].flags=0),e=c.v,c.st=c.cst=
G.voices[e].st=f,G.staves[f].flags|=g,g&16){for(g=c;d<a.length-1&&!(c=a[++d][0],e=c.v,a[d][1]&4096?(g.second=!0,g=c):c.second=!0,c.st=c.cst=G.voices[e].st=f,a[d][1]&32););G.staves[f].flags|=a[d][1]}0>f&&(f=0);G.nstaff=Q=f;if("c"==b[1])for(f=0;f<Q;f++)G.staves[f].flags^=64;for(e=0;e<x.length;e++)c=x[e],0>G.voices[e].range?c.ignore=!0:(G.voices[e].second=c.second,f=c.st,!(0<f)||c.norepbra||G.staves[f-1].flags&64||(c.norepbra=!0));h=2<=q.state?x[G.top_voice]:null}return;case "sysstaffsep":if(3==q.state){G.voices[h.v].sep=
qb(a);return}break;case "text":if(2<=q.state){b=Ab(b);b.text=hb(a);b.opt=r.textoption;return}Mb(hb(a),r.textoption);return;case "transpose":if(r.sound)return;switch(q.state){case 0:r.transp=0;case 1:case 2:r.transp=(r.transp||0)+Kc(a);return}for(b=h.last_sym;b;b=b.prev){switch(b.type){case k.NOTE:b=C(h.okey);b.k_old_sf=h.ckey.k_sf;ra(b);break;case k.KEY:break;default:continue}break}rd("V",h.id+" shift="+a);return;case "tune":return;case "user":Ef(a);return;case "voicecolor":if(3!=q.state){if(2!=q.state)return;
Pa()}h.color=a;return;case "vskip":c=qb(a);if(0>c){u(1,"%%vskip cannot be negative");return}if(2<=q.state){b=Ab(b);b.sk=c;return}ta(c);return;case "newpage":case "leftmargin":case "rightmargin":case "pagescale":case "pagewidth":case "printmargin":case "scale":case "staffwidth":if(3==q.state){b=Ab(b);b.param=a;return}if("newpage"==b){Lb();Va.newpage=!0;return}}aa.set_format(b,a,d)}};Abc.prototype.do_begin_end=function(a,c,b){switch(a){case "js":Sa(b);break;case "ml":2<=q.state?(a=Ab(a),a.text=b):(td(),
w.img_out(b));break;case "svg":for(a=0;;){c=b.indexOf('<style type="text/css">\n',a);if(0>c)break;a=b.indexOf("</style>",c);if(0>a){u(1,"No </style> in %%beginsvg sequence");break}nc+=b.slice(c+23,a).replace(/\s+$/,"")}for(a=0;;){c=b.indexOf("<defs>\n",a);if(0>c)break;a=b.indexOf("</defs>",c);if(0>a){u(1,"No </defs> in %%beginsvg sequence");break}var d,e,f,g=b.slice(c+6,a);f=0;for(g=g.replace(/\x3c!--.*?--\x3e/g,"");;){c=g.indexOf("<",f);if(0>c)break;d=g.indexOf('id="',c);if(0>d)break;d+=4;f=g.indexOf('"',
d);if(0>f)break;e=g.slice(d,f);f=g.indexOf(">",f);if(0>f)break;if("/"==g[f-1])f++;else{d=g.indexOf(" ",c);if(0>d)break;d=g.slice(c+1,d);f=g.indexOf("</"+d+">",f);if(0>f)break;f+=3+d.length}"<filter"==g.substr(c,7)?Se+="\n"+g.slice(c,f):jc[e]=g.slice(c,f)}}break;case "text":c=mg[c],c||(c=r.textoption),2<=q.state?(a=Ab(a),a.text=hb(b),a.opt=c):Mb(hb(b),c)}};Abc.prototype.draw_gchord=function(a,c,b){var d,e,f,g,l,h,m=a.a_gch[0].w,n=T(a.st,1,a.x-2,m),q=T(a.st,0,a.x-2,m),p=a.dur?3*((a.notes[a.nhd].pit+
a.notes[0].pit>>1)-18):12;for(f=0;f<a.a_gch.length&&!(d=a.a_gch[f],"g"==d.type&&(e=d,0>d.y));f++);e&&(0<=e.y?n<b&&(n=b):q>c&&(q=c));xc(a.st);for(f=0;f<a.a_gch.length;f++){d=a.a_gch[f];rb(d.font);va(d.font);h=d.font.size;m=d.w;b=a.x+d.x;c=d.text;switch(d.type){case "_":e=d.y+q;H(a.st,0,b,m,e-.2*h-2);break;case "^":e=d.y+n;H(a.st,1,b,m,e+.8*h+2);break;case "<":a.notes[0].acc&&(b-=a.notes[0].shac);e=d.y+p-h/2;break;case ">":b+=a.xmx;0<a.dots&&(b+=1.5+3.5*a.dots);e=d.y+p-h/2;break;default:g=d.box?3:2;
0<=d.y?(e=d.y+n,H(a.st,!0,b,m,e+h+g)):(e=d.y+q,H(a.st,!1,b,m,e-g));g=c.indexOf("\t");if(0<=g){b=za;for(l=a.next;l;l=l.next){switch(l.type){default:continue;case k.NOTE:case k.REST:case k.BAR:b=l.x}break}for(l=2;;){g=c.indexOf("\t",g+1);if(0>g)break;l++}var r=(b-a.x)/l;b=a.x;e*=v[a.st].staffscale;w.anno_start&&w.anno_start("gchord",d.istart,d.iend,b-2,e+h+2,m+4,h+4,a);for(l=g=0;;){g=c.indexOf("\t",l);if(0>g)break;fa(b,e,c.slice(l,g),"c");b+=r;l=g+1}fa(b,e,c.slice(l),"c");w.anno_stop&&w.anno_stop("gchord",
d.istart,d.iend,a.x-2,e+h+2,m+4,h+4,a);continue}break;case "@":e=d.y+p,0<e?(g=e+h,g>v[a.st].ann_top&&(v[a.st].ann_top=g)):e<v[a.st].ann_bot&&(v[a.st].ann_bot=e)}w.anno_start&&w.anno_start("annot",d.istart,d.iend,b-2,e+h+2,m+4,h+4,a);d.box?fe(b,e,c):fa(b,e,c);w.anno_stop&&w.anno_stop("annot",d.istart,d.iend,b-2,e+h+2,m+4,h+4,a)}};Abc.prototype.draw_note=Uc;Abc.prototype.draw_symbols=function(a){var c={},b,d,e;for(b=a.sym;b;b=b.next){if(b.invis)switch(b.type){case k.KEY:a.key=b;default:continue;case k.NOTE:}d=
b.x;tc(b.color);switch(b.type){case k.NOTE:ad(b);b.beam_st&&!b.beam_end&&aa.calculate_beam(c,b)&&df(c);b.invis||(ob(b),Uc(b,!c.s2),yb(b));b==c.s2&&(c.s2=null);break;case k.REST:var f,g,l,h;e=b;var m=v[e.st];if(m.topbar){if(e.dur==e.p_v.meter.wmeasure||e.rep_nb&&0<=e.rep_nb){for(f=e.ts_next;f&&f.time!=e.time+e.dur;)f=f.ts_next;d=f?f.x:za;for(f=e;!f.seqst;)f=f.ts_prev;f=f.ts_prev;d=(d+f.x)/2;if(e.a_dd){l=e;h=d-e.x;var n=qa.length;for(g=0;g<n;g++)f=qa[g],f.s==l&&(f.x+=h)}e.x=d}else d=e.x,e.notes[0].shhd&&
(d+=e.notes[0].shhd*D.scale);if(!e.invis){f=m.y;if(e.rep_nb)db(e.st),ob(e),f="|||||"==m.stafflines?f+12:f+(m.topbar+m.botbar)/2,0>e.rep_nb?ca(d,f,"srep"):(ca(d,f,"mrep"),2<e.rep_nb&&e.v==B.top_voice&&(va("annotation"),fa(d,f+m.topbar-9,e.rep_nb.toString(),"c")));else{ad(e);ob(e);g=e.y;h=5-e.nflags;7==h&&12==g&&2>=m.stafflines.length&&(g-=6);ca(d,g+f,e.notes[0].head?e.notes[0].head:$g[h]);if(6<=h){l=g/6;switch(h){default:switch(m.stafflines[l+1]){case "|":case "[":break;default:ca(d,g+6+f,"hl1")}9==
h&&(g-=6,l--);break;case 7:g+=6,l++;case 6:}switch(m.stafflines[l]){case "|":case "[":break;default:ca(d,g+f,"hl1")}}d+=8;g+=f+3;for(h=0;h<e.dots;h++)ca(d,g,"dot"),d+=3.5}yb(e)}}break;case k.BAR:break;case k.CLEF:e=b.st;b.time>v[e].clef.time&&(v[e].clef=b);if(b.second)break;if(!v[b.st].topbar)break;tc(void 0);db(e);ob(b);e=v[e].y;b.clef_name?ca(d,e+b.y,b.clef_name):b.clef_small?ca(d,e+b.y,"s"+b.clef_type+"clef"):ca(d,e+b.y,b.clef_type+"clef");b.clef_octave&&(0<b.clef_octave?(e+=b.ymx-10,b.clef_small&&
--e):(e+=b.ymn+6,b.clef_small&&(e+=1)),ca(d-2,e,"oct"));yb(b);break;case k.METER:a.meter=b;if(b.second||!v[b.st].topbar)break;if(r.alignbars&&0!=b.st)break;tc(void 0);db(b.st);ob(b);d=b;if(d.a_meter)for(m=v[d.st],e=m.y,"|||||"!=m.stafflines&&(e+=(m.topbar+m.botbar)/2-12),l=0;l<d.a_meter.length;l++){var q,n=d.a_meter[l];h=d.x+d.x_meter[l];if(n.bot){f=m="";for(g=0;g<n.top.length;g++)f+=ic["meter"+n.top[g]].c;for(g=0;g<n.bot.length;g++)m+=ic["meter"+n.bot[g]].c;V('<g transform="translate(X,Y)" text-anchor="middle">\n\t<text y="-12">A</text>\n\t<text>B</text>\n</g>\n',
h,e+6,f,m)}else switch(n.top[0]){case "C":q="|"!=n.top[1]?"csig":"ctsig";h-=5;e+=12;break;case "c":q="."!=n.top[1]?"imsig":"iMsig";break;case "o":q="."!=n.top[1]?"pmsig":"pMsig";break;default:f="";for(g=0;g<n.top.length;g++)f+=ic["meter"+n.top[g]].c;V('<text x="X" y="Y" text-anchor="middle">A</text>\n',h,e+12,f)}q&&ca(h,e,q)}yb(b);break;case k.KEY:a.key=b;if(b.second||!v[b.st].topbar)break;tc(void 0);db(b.st);ob(b);m=d;f=b;if(!f.k_none){h=f.k_old_sf;l=a.st;g=v[l].y;n=f.k_y_clef;n&1&&(n+=7);for(n/=
2;0>n;)n+=7;n%=7;if(!f.k_a_acc){if(r.cancelkey||0==f.k_sf)if(0==f.k_sf||0>h*f.k_sf){d=fg[n];l=9<d?hg:ig;for(e=0;e<h;e++)ca(m,g+d,"acc3"),d+=l[e],m+=5.5;d=gg[n];l=18>d?jg:kg;for(e=0;e>h;e--)ca(m,g+d,"acc3"),d+=l[-e],m+=5.5;0!=f.k_sf&&(m+=3)}if(0<f.k_sf){d=fg[n];l=9<d?hg:ig;for(e=0;e<f.k_sf;e++)ca(m,g+d,"acc1"),d+=l[e],m+=5.5;if(r.cancelkey&&e<h)for(m+=2;e<h;e++)ca(m,g+d,"acc3"),d+=l[e],m+=5.5}if(0>f.k_sf){d=gg[n];l=18>d?jg:kg;for(e=0;e>f.k_sf;e--)ca(m,g+d,"acc-1"),d+=l[-e],m+=5.5;if(r.cancelkey&&e>
h)for(m+=2;e>h;e--)ca(m,g+d,"acc3"),d+=l[-e],m+=5.5}}else if(f.k_a_acc.length){var n=f.k_a_acc[0].acc,p=100;for(e=0;e<f.k_a_acc.length;e++)h=f.k_a_acc[e],d=3*(f.k_y_clef+h.pit-18),0!=e&&(d>p+18||d<p-18)?m-=5.5:h.acc!=n&&(m+=3),n=h.acc,ff(m,d,d,l,"hl"),p=d,md(m,g+d,h.acc,h.micro_n,h.micro_d),m+=5.5}}yb(b);break;case k.MREST:ad(b);d+=32;ob(b);ca(d,v[b.st].y+12,"mrest");V('<text style="font:bold 15px serif"\n\tx ="X" y="Y" text-anchor="middle">A</text>\n',d,v[b.st].y+28,b.nmes);yb(b);break;case k.GRACE:ad(b);
var u;d=b;e={};for(f=d.extra;f&&(f.beam_st&&!f.beam_end&&aa.calculate_beam(e,f)&&df(e),ob(f),Uc(f,!e.s2),f==e.s2&&(e.s2=null),yb(f),f.next);f=f.next);d.sappo&&(f=d.extra,f.next?(e=.5*(f.next.x-f.x)+4,m=.5*(f.ys+f.next.ys)-f.y,m=0<f.stem?m-1:m+1):(e=9,m=0<f.stem?5:-5),l=f.notes[0>f.stem?0:f.nhd],g=f.x+l.shhd*D.scale,l=v[f.st].y+3*(l.pit-18),0<f.stem?(--g,l+=4):(g-=5,l-=4),V('<path class="stroke" d="mX YlF G"/>\n',g,l,e,-m));if(!d.p_v.key.k_bagpipe&&r.graceslurs&&!d.slur_start&&d.next&&d.next.type==
k.NOTE){e=f;if(0<=e.stem){m=127;for(f=d.extra;f;f=f.next)f.y<m&&(m=f.y,e=f);h=e.x;l=e.y-5;d.extra!=e&&(h-=4,l+=1);d=d.next;g=d.x-1;0>d.stem&&(g-=4);f=3*(d.notes[0].pit-18)-5;m=.4*(g-h);3<m&&(m=3);n=m;u=.2;p=.8;l>f+7?(h=e.x-1,l+=.5,f+=6.5,g=d.x-5.5,m=.8*(l-f),n=.2*(l-f),u=0):f>l+4&&(f=l+4,h=e.x+2,l=e.y-4)}else{m=-127;for(f=d.extra;f;f=f.next)f.y>m&&(m=f.y,e=f);h=e.x;l=e.y+5;d.extra!=e&&(h-=4,--l);d=d.next;g=d.x-1;0<=d.stem&&(g-=2);f=3*(d.notes[d.nhd].pit-18)+5;m=.4*(h-g);-3>m&&(m=-3);n=m;u=.2;p=.8;
l<f-7?(h=e.x-1,l-=.5,f-=6.5,g=d.x-5.5,m=.8*(l-f),n=.2*(l-f),u=0):f<l-4&&(f=l-4,h=e.x+2,l=e.y+4)}e=u*g+(1-u)*h-h;m=u*f+(1-u)*l-m-l;u=p*g+(1-p)*h-h;n=p*f+(1-p)*l-n-l;ob(d,"slur");Sd(h,l+v[d.st].y);y+="c"+e.toFixed(2)+" "+(-m).toFixed(2)+" "+u.toFixed(2)+" "+(-n).toFixed(2)+" "+(g-h).toFixed(2)+" "+(-f+l).toFixed(2)+'"/>\n';yb(d,"slur")}break;case k.SPACE:case k.STBRK:break;case k.CUSTOS:ad(b);Uc(b,0);break;case k.BLOCK:case k.PART:case k.REMARK:case k.STAVES:case k.TEMPO:break;default:N(2,b,"draw_symbols - Cannot draw symbol "+
b.type)}}ad(a.sym);vg(a);tc(void 0)};Abc.prototype.errs=P;Abc.prototype.font_class=od;Abc.prototype.gch_build=function(a){var c,b,d,e,f=h.pos.gch==k.SL_BELOW?-1:1,g=0,l=0,t=0,m=0,n=r.gchordbox;a.a_gch=ib;ib=null;h.vtransp&&Xg(a);for(e=0;e<a.a_gch.length;e++){c=a.a_gch[e];if("g"==c.type)r.chordnames&&(c.otext=c.text,c.text=c.text.replace(/A|B|C|D|E|F|G/g,function(a){return r.chordnames[a]}),"H"==r.chordnames.B&&(c.text=c.text.replace(/Hb/g,"Bb"))),c.text=c.text.replace(/##|#|=|bb|b/g,function(a){switch(a){case "##":return"&#x1d12a;";
case "#":return"\u266f";case "=":return"\u266e";case "b":return"\u266d"}return"&#x1d12b;"});else if(c.text=hb(c.text),"@"==c.type&&!w.anno_start&&!w.anno_stop)continue;K.curfont=c.font;b=Ka(c.text);c.w=b[0];switch(c.type){case "@":break;case "^":d=.4*b[0];8<d&&(d=8);c.x=-d;g-=b[1];c.y=g;break;case "_":d=.4*b[0];8<d&&(d=8);c.x=-d;l-=b[1];c.y=l;break;case "<":c.x=-(b[0]+6);t-=b[1];c.y=t+b[1]/2;break;case ">":c.x=6;m-=b[1];c.y=m+b[1]/2;break;default:c.box=n,d=.4*b[0],8<d&&(d=8),c.x=-d,0>f?(l-=b[1],c.y=
l,n&&(l-=2,--c.y)):(g-=b[1],c.y=g,n&&(g-=2,--c.y))}}t/=2;m/=2;for(e=0;e<a.a_gch.length;e++)switch(c=a.a_gch[e],c.type){case "^":c.y-=g;break;case "<":c.y-=t;break;case ">":c.y-=m;break;case "g":0<f&&(c.y-=g)}};Abc.prototype.gch_tr1=Ue;Abc.prototype.get_a_gch=function(){return ib};Abc.prototype.get_bool=vc;Abc.prototype.get_cur_sy=function(){return B};Abc.prototype.get_curvoice=function(){return h};Abc.prototype.get_delta_tb=function(){return Xe};Abc.prototype.get_decos=function(){return jd};Abc.prototype.get_fname=
function(){return q.fname};Abc.prototype.get_font=kc;Abc.prototype.get_font_style=function(){return Vc};Abc.prototype.get_glyphs=function(){return jc};Abc.prototype.get_img=function(){return ha};Abc.prototype.get_maps=function(){return Ub};Abc.prototype.get_multi=function(){return Ja};Abc.prototype.get_newpage=function(){if(Va.newpage)return Va.newpage=!1,!0};Abc.prototype.get_posy=function(){var a=ma;ma=0;return a};Abc.prototype.get_staff_tb=function(){return v};Abc.prototype.get_top_v=function(){return G.top_voice};
Abc.prototype.get_tsfirst=function(){return S};Abc.prototype.get_voice_tb=function(){return x};Abc.prototype.goto_tune=Pa;Abc.prototype.info=function(){return L};Abc.prototype.new_note=function(a,c){var b,d,e,f,g;g=0;var l=q.line,t=ea;ea=null;q.stemless=!1;d={type:k.NOTE,fname:q.fname,stem:0,multi:0,nhd:0,xmx:0};d.istart=q.bol+l.index;h.color&&(d.color=h.color);a?d.grace=!0:(ib&&aa.gch_build(d),q.repeat_n&&(d.repeat_n=q.repeat_n,d.repeat_k=q.repeat_k,q.repeat_n=0));f=l["char"]();switch(f){case "X":d.invis=
!0;case "Z":d.type=k.MREST;f=l.next_char();d.nmes="0"<f&&"9">=f?l.get_int():1;d.dur=h.wmeasure*d.nmes;if(h.second){h.time+=d.dur;return}break;case "y":d.type=k.SPACE;d.invis=!0;d.dur=0;f=l.next_char();d.width="0"<=f&&"9">=f?l.get_int():10;break;case "x":d.invis=!0;case "z":d.type=k.REST;l.index++;e=Lc(l);d.dur_orig=(0>h.ulen?15120:h.ulen)*e[0]/e[1];d.dur=d.dur_orig*h.dur_fact;d.notes=[{pit:18,dur:d.dur_orig}];break;case "[":e=!0,f=l.next_char();default:h.uscale&&(d.uscale=h.uscale);for(d.notes=[];;){if(e)for(;f;){f=
f.charCodeAt(0);if(128<=f){u(1,P.not_ascii);return}f=Ua[f];switch(f[0]){case "(":g<<=4;g+=Zc();f=l["char"]();continue;case "!":ea||(ea=[]);if(1<f.length)ea.push(f.slice(1,-1));else{for(b="";;){f=l.next_char();if(!f){u(1,"No end of decoration");return}if("!"==f)break;b+=f}ea.push(b)}f=l.next_char();continue}break}var m;m=l;f=d.grace?k.BLEN/4:0>h.ulen?15120:h.ulen;(b=Nb(m))?("0"==m["char"]()&&(q.stemless=!0,m.index++),m=Lc(m),b.dur=f*m[0]/m[1]):b=void 0;if(!b)return;h.octave&&(b.pit+=7*h.octave);h.ottava&&
(b.pit+=h.ottava);g&&(b.sl1=g,d.sl1?d.sl1++:d.sl1=1,g=0);ea&&(b.a_dcn=ea,ea=null);d.notes.push(b);if(!e)break;for(f=l["char"]();;){switch(f){case ")":b.sl2?b.sl2++:b.sl2=1;d.sl2?d.sl2++:d.sl2=1;f=l.next_char();continue;case "-":b.ti1=Zc();d.ti1=!0;f=l["char"]();continue;case ".":if(f=l.next_char(),"-"!=f)u(1,"Misplaced dot");else continue}break}if("]"==f){l.index++;e=Lc(l);d.nhd=d.notes.length-1;for(f=0;f<=d.nhd;f++)b=d.notes[f],b.dur=b.dur*e[0]/e[1];break}}d.dur_orig=d.notes[0].dur;d.dur=d.notes[0].dur*
h.dur_fact}if(d.grace&&d.type!=k.NOTE)u(1,"Not a note in grace note sequence");else{if(d.notes){if(d.grace){e=h.ckey.k_bagpipe?8:4;for(f=0;f<=d.nhd;f++)d.notes[f].dur/=e;d.dur/=e;d.dur_orig/=e;a.stem&&(d.stem=a.stem)}else{switch(h.pos.stm){case k.SL_ABOVE:d.stem=1;break;case k.SL_BELOW:d.stem=-1;break;case k.SL_HIDDEN:d.stemless=!0}d.dur*=c;if(b=h.brk_rhythm){h.brk_rhythm=0;e=h.last_note;if(0<b){g=2*b-1;d.dur=d.dur*g/b;d.dur_orig=d.dur_orig*g/b;for(f=0;f<=d.nhd;f++)d.notes[f].dur=d.notes[f].dur*g/
b;e.dur/=b;e.dur_orig/=b;for(f=0;f<=e.nhd;f++)e.notes[f].dur/=b}else{b=-b;g=2*b-1;d.dur/=b;d.dur_orig/=b;for(f=0;f<=d.nhd;f++)d.notes[f].dur/=b;e.dur=e.dur*g/b;e.dur_orig=e.dur_orig*g/b;for(f=0;f<=e.nhd;f++)e.notes[f].dur=e.notes[f].dur*g/b}h.time=e.time+e.dur;f=Ib(e,e.dur_orig);e.head=f[0];e.dots=f[1];e.nflags=f[2];-2>=e.nflags?e.stemless=!0:delete e.stemless;for(e=e.next;e;e=e.next)e.time=h.time}}d.type==k.NOTE?(f=Ib(d,d.dur_orig),d.head=f[0],d.dots=f[1],d.nflags=f[2],-2>=d.nflags&&(d.stemless=
!0)):(f=d.dur_orig,f==h.wmeasure&&(f=f<2*k.BLEN?k.BLEN:f<4*k.BLEN?2*k.BLEN:4*k.BLEN),f=Ib(d,f),d.head=f[0],d.dots=f[1],d.nflags=f[2]);h.last_note=d}ra(d);if(d.type==k.NOTE){if(h.vtransp){var n,v,p,x,w,y;f=d.nhd;e=h.okey.k_sf;g=h.ckey.k_sf-e;b=mc[(g+28)%7];m=h.vtransp;0>m&&0!=b&&(b-=7);b+=7*(m/3/12|0);for(m=0;m<=f;m++){y=d.notes[m];v=y.pit;y.pit+=b;w=Ve[(v+5+112)%7];p=y.acc;if(!p)if(h.okey.a_acc)for(n=0;n<h.okey.a_acc.length;n++){if(x=h.okey.a_acc[n],0==(v+112-x.pit)%7){p=x.acc;break}}else 0<e?w<e-
1&&(p=1):0>e&&w>=e+6&&(p=-1);n=w+g;p&&3!=p&&(n+=7*p);w=(((n+1+21)/7|0)+2-3+160)%5;p=bh[w];if(!y.acc)if(h.ckey.k_none){if(3==p||Vg(y.pit))continue}else if(h.ckey.a_acc){w=mc[(n+112)%7];for(n=0;n<h.ckey.a_acc.length&&0!=(w+112-h.ckey.a_acc[n].pits)%7;n++);if(n<h.ckey.a_acc.length)continue}else continue;w=y.acc;if((n=y.micro_d)&&w!=p)switch(v=y.micro_n,p){case 3:v>n/2?(v-=n/2,y.micro_n=v,p=w):p=-w;break;case 2:v>n/2?(y.pit+=1,v-=n/2):v+=n/2;p=w;y.micro_n=v;break;case -2:v>=n/2?(--y.pit,v-=n/2):v+=n/
2,p=w,y.micro_n=v}y.acc=p}}if(h.map&&Ub[h.map])for(f=0;f<=d.nhd;f++)a:{e=d.notes[f];g=Ub[h.map];b=Jf(e);if(!(g[b]||(b="octave,"+b.replace(/[',]/g,""),g[b]||(b="key,"+"abcdefg"[(e.pit+77-h.ckey.k_delta)%7],g[b]||(b="all",g[b])))))break a;e.map=g[b];e.map[1]&&(e.pit=e.map[1].pit,e.acc=e.map[1].acc)}}r.shiftunison&&(d.shiftunison=r.shiftunison);a||(h.lyric_restart||(h.lyric_restart=d),h.sym_restart||(h.sym_restart=d));t&&kd(t,d,d.prev);q.stemless&&(d.stemless=!0);d.iend=q.bol+l.index;return d}};Abc.prototype.out_arp=
Sf;Abc.prototype.out_deco_str=Rf;Abc.prototype.out_deco_val=Re;Abc.prototype.out_ltr=Tf;Abc.prototype.output_music=function(){var a,c,b,d;Cf();if(S){var e,f,g,l,h;h=B;for(f=h.nstaff;;){h=h.next;if(!h)break;h.nstaff>f&&(f=h.nstaff)}Q=f;l=x.length;for(g=0;g<l;g++){e=x[g];for(var m=void 0,n=void 0,q=void 0,p=void 0,u=!0,G=127,p=e.sym;p;p=p.next)if(p.type==k.NOTE){G=p.notes[0].pit;break}for(p=e.sym;p;p=p.next){switch(p.type){case k.MREST:u=!0;break;case k.BAR:p.bar_type=sg(p.bar_type);p.beam_on||(u=!0);
!p.next&&p.prev&&p.prev.head==k.OVALBARS&&(p.prev.head=k.SQUARE);break;case k.NOTE:case k.REST:if(!p.trem2){n=p.nflags;p.ntrem&&(n+=p.ntrem);p.type==k.REST&&p.beam_end&&(p.beam_end=!1,u=!0);if(u||0>=n)m&&(m.beam_end=!0,m=null),0>=n?(p.beam_st=!0,p.beam_end=!0):p.type==k.NOTE&&(p.beam_st=!0,u=!1);p.beam_end&&(u=!0);p.type==k.NOTE&&(m=p)}}if(p.type==k.NOTE)for(0!=p.nhd&&Oe(p),G=p.notes[0].pit,q=p.prev;q&&q.type==k.REST;q=q.prev)q.notes[0].pit=G;else p.notes||(p.notes=[],p.notes[0]={},p.nhd=0),p.notes[0].pit=
G}m&&(m.beam_end=!0);for(var L=void 0,z=void 0,P=void 0,F=e.sym;F;)if(F.type!=k.BAR||!F.rbstart||F.norepbra)F=F.next;else{z=r.rbmax;if(F.text&&"1"==F.text[0]){L=0;P=null;for(F=F.next;F;F=F.next)if(F.type==k.BAR){L++;if(F.rbstop){L<=r.rbmax&&(z=L,P=null);break}L==r.rbmin&&(P=F)}P&&(P.rbstop=1,z=r.rbmin)}for(;F;){if(2!=F.rbstart){F=F.next;if(!F)break;if(2!=F.rbstart){F=F.next;if(!F)break;if(2!=F.rbstart)break}}L=0;for(F=F.next;F;F=F.next)if(F.type==k.BAR){L++;if(F.rbstop)break;F.next?L==z&&(F.rbstop=
1):F.rbstop=2}}}}var V,sa,ea,ya,wa,Y,gc,ra;for(ya=0;ya<x.length;ya++)for(V=x[ya],ea=!1,sa=V.st,wa=V.sym;wa;wa=wa.next){if(!wa.floating){for(;wa&&!wa.floating;)wa=wa.next;if(!wa)break;ea=!1}if(wa.dur)if(19<=wa.notes[0].pit)ea=!1;else if(12>=wa.notes[wa.nhd].pit)ea=!0,wa.st++;else{gc=127;for(Y=wa.ts_prev;Y&&Y.st==sa&&Y.v!=wa.v;Y=Y.ts_prev)Y.type==k.NOTE&&Y.notes[0].pit<gc&&(gc=Y.notes[0].pit);if(127==gc)ea&&wa.st++;else if(wa.notes[wa.nhd].pit>gc-3)ea=!1;else{ra=-127;for(Y=wa.ts_next;Y&&Y.st==sa+1&&
Y.v!=wa.v;Y=Y.ts_next)Y.type==k.NOTE&&Y.notes[Y.nhd].pit>ra&&(ra=Y.notes[Y.nhd].pit);if(-127==ra)ea&&wa.st++;else{if(wa.notes[0].pit<ra+3)ea=!0;else if(gc-=wa.notes[wa.nhd].pit,ra=wa.notes[0].pit-ra,!ea){if(gc<ra+3)continue;ea=!0}else if(gc<ra-3){ea=!1;continue}wa.st++}}}else ea&&wa.st++}var da,ja,O,W,Ga,nb,Ja,Sa,Pa,Wa=Array(Q),ga=B,Rd=[];v=Array(Q);for(O=0;O<=Q;O++)Wa[O]={autoclef:!0},v[O]={output:"",sc_out:""};for(W=0;W<x.length;W++)Ga=x[W],0>ga.voices[W].range||(O=ga.voices[W].st,ga.voices[W].second||
(void 0!=Ga.staffnonote&&(ga.staves[O].staffnonote=Ga.staffnonote),Ga.staffscale&&(ga.staves[O].staffscale=Ga.staffscale),ga.voices[W].sep&&(ga.staves[O].sep=ga.voices[W].sep),ga.voices[W].maxsep&&(ga.staves[O].maxsep=ga.voices[W].maxsep)),ga.voices[W].second||Ga.clef.clef_auto||(Wa[O].autoclef=!1));for(W=0;W<x.length;W++)Ga=x[W],0>ga.voices[W].range||ga.voices[W].second||(O=ga.voices[W].st,da=Ga.clef,Wa[O].autoclef&&(da.clef_type=Ke(O,S,da.clef_type),da.clef_line="t"==da.clef_type?2:4),Wa[O].clef=
v[O].clef=da);for(O=0;O<=ga.nstaff;O++)Rd[O]=3*(ga.staves[O].stafflines.length-1);for(da=S;da;da=da.ts_next){da.repeat_n&&Hg(da);switch(da.type){case k.STAVES:ga=da.sy;for(O=0;O<=Q;O++)Wa[O].autoclef=!0;for(W=0;W<x.length;W++)0>ga.voices[W].range||(Ga=x[W],O=ga.voices[W].st,ga.voices[W].second||(void 0!=Ga.staffnonote&&(ga.staves[O].staffnonote=Ga.staffnonote),Ga.staffscale&&(ga.staves[O].staffscale=Ga.staffscale),ga.voices[W].sep&&(ga.staves[O].sep=ga.voices[W].sep),ga.voices[W].maxsep&&(ga.staves[O].maxsep=
ga.voices[W].maxsep)),ja=Ga.clef,ja.clef_auto||(Wa[O].autoclef=!1));for(O=0;O<=ga.nstaff;O++)Rd[O]=3*(ga.staves[O].stafflines.length-1);for(W=0;W<x.length;W++)if(!(0>ga.voices[W].range||ga.voices[W].second))if(Ga=x[W],O=ga.voices[W].st,ja=Ga.clef,ja.clef_auto?(Ja=Ke(O,da,Wa[O].clef?Wa[O].clef.clef_type:"a"),Sa="t"==Ja?2:4):(Ja=ja.clef_type,Sa=ja.clef_line),!Wa[O].clef)ja.clef_auto&&("a"!=ja.type&&(Ga.clef=C(Ga.clef)),Ga.clef.clef_type=Ja,Ga.clef.clef_line=Sa),v[O].clef=Wa[O].clef=Ga.clef;else if(Ja!=
Wa[O].clef.clef_type||Sa!=Wa[O].clef.clef_line){for(nb=da.ts_next;nb&&(nb.v!=W||nb.st!=O);)nb=nb.ts_next;nb&&(nb.type!=k.CLEF&&(nb=tf(nb,Ja,Sa),ja.clef_auto&&(nb.clef_auto=!0)),Wa[O].clef=Ga.clef=nb)}continue;default:da.mid=Rd[da.st];continue;case k.CLEF:}"a"==da.clef_type&&(da.clef_type=Ke(da.st,da.ts_next,Wa[da.st].clef.clef_type),da.clef_line="t"==da.clef_type?2:4);Ga=da.p_v;Ga.clef=da;if(da.second)pb(da);else{O=da.st;if(Wa[O].clef){if(da.clef_type==Wa[O].clef.clef_type&&da.clef_line==Wa[O].clef.clef_line)continue}else v[O].clef=
da;Wa[O].clef=da}}ga=B;for(W=0;W<x.length;W++)if(!(0>ga.voices[W].range)&&(ja=x[W].sym)&&127==ja.notes[0].pit){O=ga.voices[W].st;switch(v[O].clef.clef_type){default:Pa=22;break;case "c":Pa=16;break;case "b":Pa=10}for(da=ja;da;da=da.next)da.notes[0].pit=Pa}aa.set_pitch(null);1<x.length&&aa.set_stem_dir();for(a=0;a<x.length;a++){var Ua,Va,Qa,qb,Ta,ib=void 0,xb=void 0,xa,Z,gb=-1;for(Z=x[a].sym;Z;Z=Z.next)if(Z.type!=k.NOTE){if(Z.type==k.GRACE)if(xa=Z.extra,2==xa.stem)ib=Z;else for(Z.stem||0!=(Z.stem=
Z.multi)||(Z.stem=1);xa;xa=xa.next)xa.stem=Z.stem,xa.multi=Z.multi}else{if(Z.stem||0!=(Z.stem=Z.multi))Z.beam_st&&!Z.beam_end&&(xb=!0);else if(Qa=Z.mid/3+18,xb)Z.stem=gb;else if(Z.beam_st&&!Z.beam_end){xb=!0;Va=Z.notes[Z.nhd].pit;Ua=Z.notes[0].pit;for(xa=Z.next;xa;xa=xa.next)if(xa.type==k.NOTE){if(xa.stem||xa.multi){Z.stem=xa.stem||xa.multi;break}xa.notes[xa.nhd].pit>Va&&(Va=xa.notes[xa.nhd].pit);xa.notes[0].pit<Ua&&(Ua=xa.notes[0].pit);if(xa.beam_end)break}xa.beam_end&&((Va+Ua)/2<Qa?Z.stem=1:(Va+
Ua)/2>Qa?Z.stem=-1:r.bstemdown&&(Z.stem=-1));Z.stem||(Z.stem=gb)}else{Ta=(Z.notes[Z.nhd].pit+Z.notes[0].pit)/2;if(Ta==Qa){for(qb=Ta=0;qb<=Z.nhd;qb++)Ta+=Z.notes[qb].pit;Ta/=Z.nhd+1}Z.stem=Ta<Qa?1:Ta>Qa?-1:r.bstemdown?-1:gb}Z.beam_end&&(xb=!1);gb=Z.stem;if(ib){for(xa=ib.extra;xa;xa=xa.next)xa.stem=-gb;ib.stem=-gb;ib=null}}}aa.set_stems();if(1<x.length){var J,ia,hb,Tb,Bb,Vb,Wb,Xb,Ha,eb,rb,Lb=[],Ab=B;for(J=S;J;J=J.ts_next)if(!J.invis&&(J.type==k.STAVES&&(Ab=J.sy),J.dur&&(Vb=Lb[J.v],Vb||(Vb={},Lb[J.v]=
Vb),Vb.s=J,Vb.st=J.st,Vb.end_time=J.time+J.dur,J.type==k.REST))){Xb=-127;Wb=127;Bb=eb=!1;for(hb=0;hb<=Lb.length;hb++)!(Vb=Lb[hb])||!Vb.s||Vb.st!=J.st||hb==J.v||Vb.end_time<=J.time||(Bb=!0,ia=Vb.s,Ab.voices[hb].range<Ab.voices[J.v].range?ia.time==J.time?ia.ymn<Wb&&(Wb=ia.ymn,ia.dots&&(eb=!0)):ia.y<Wb&&(Wb=ia.y):ia.time==J.time?ia.ymx>Xb&&(Xb=ia.ymx,ia.dots&&(eb=!0)):ia.y>Xb&&(Xb=ia.y));Tb=J.time+J.dur;for(ia=J.ts_next;ia&&!(ia.time>=Tb);ia=ia.ts_next)ia.st==J.st&&ia.dur&&!ia.invis&&(Bb=!0,Ab.voices[ia.v].range<
Ab.voices[J.v].range?ia.time==J.time?ia.ymn<Wb&&(Wb=ia.ymn,ia.dots&&(eb=!0)):ia.y<Wb&&(Wb=ia.y):ia.time==J.time?ia.ymx>Xb&&(Xb=ia.ymx,ia.dots&&(eb=!0)):ia.y>Xb&&(Xb=ia.y));Bb?(127==Wb&&12>J.y&&(Ha=12-J.y,J.y+=Ha,J.ymx+=Ha,J.ymn+=Ha),-127==Xb&&12<J.y&&(Ha=J.y-12,J.y-=Ha,J.ymx-=Ha,J.ymn-=Ha),Ha=Wb-J.ymx,0>Ha?(Ha=6*Math.ceil(-Ha/6),J.ymn-Ha>=Xb?(J.y-=Ha,J.ymx-=Ha,J.ymn-=Ha):(rb=eb?15:10,J.notes[0].shhd=rb,J.xmx=rb)):(Ha=Xb-J.ymn,0<Ha&&(Ha=6*Math.ceil(Ha/6),J.ymx+Ha<=Wb?(J.y+=Ha,J.ymx+=Ha,J.ymn+=Ha):
(rb=eb?15:10,J.notes[0].shhd=rb,J.xmx=rb)))):(J.y=12,J.ymx=24,J.ymn=0)}var Xa,X,R,yc,M,jb,Nc,kb,Ib,zb,Ub,Ya,Ca,Cb,Dd,jc,Kb,bd,lc,Mb,Nb,cd,dd;for(Xa=S;Xa;Xa=Xa.ts_next)if(Xa.type==k.NOTE&&!Xa.invis){if(Xa.xstem&&0>Xa.ts_prev.stem)for(kb=0;kb<=Xa.nhd;kb++)Xa.notes[kb].shhd-=7,Xa.notes[kb].shac+=16;for(R=Xa;;){R=R.ts_next;if(!R)break;if(R.time!=Xa.time){R=null;break}if(R.type==k.NOTE&&!R.invis&&R.st==Xa.st)break}if(R&&(X=Xa,B.voices[X.v].range<B.voices[R.v].range?R.dot_low=!0:X.dot_low=!0,!(X.ymn>R.ymx||
X.ymx<R.ymn||Jg(X,R)))){bd=Ne(X);lc=Me(R);if((yc=X.ts_prev)&&yc.time==X.time&&yc.st==X.st&&yc.type==k.NOTE&&!yc.invis)for(Nb=Ne(yc),M=0;96>M;M++)Nb[M]>bd[M]&&(bd[M]=Nb[M]);else yc=null;Ya=-10;for(M=0;96>M;M++)lc[M]+bd[M]>Ya&&(Ya=lc[M]+bd[M]);if(!(-3>Ya&&(!X.dots||!R.dots||!R.dot_low||0<X.stem||0>R.stem||X.notes[X.nhd].pit+2!=R.notes[0].pit||R.notes[0].pit&1))){Mb=Ne(R);Kb=Me(X);if(yc)for(Nb=Me(yc),M=0;96>M;M++)Nb[M]>Kb[M]&&(Kb[M]=Nb[M]);Ca=Cb=Dd=-100;for(M=0;96>M;M++)Kb[M]+Mb[M]>Ca&&(Ca=Kb[M]+Mb[M]),
Mb[M]>Dd&&(Dd=Mb[M]),bd[M]>Cb&&(Cb=bd[M]);zb=0;jb=X.nhd;for(Nc=R.nhd;;){Ub=X.notes[jb].pit-R.notes[Nc].pit;switch(Ub){case 0:if(X.notes[jb].acc!=R.notes[Nc].acc){zb=-1;break}R.notes[Nc].acc&&(R.notes[Nc].acc=0);X.dots&&R.dots&&X.notes[jb].pit&1&&(zb=1);break;case -1:X.dots&&R.dots&&(X.notes[jb].pit&1?(X.dot_low=!1,R.dot_low=!1):(X.dot_low=!0,R.dot_low=!0));break;case -2:!X.dots||!R.dots||X.notes[jb].pit&1||(X.dot_low=!1,R.dot_low=!1)}if(0>zb)break;if(0<=Ub&&0>--jb)break;if(0>=Ub&&0>--Nc)break}if(0>
zb){var Yb=void 0,Db=void 0,Zb=X,Ob=R,Lc=jb;if(Ob.notes[Nc].acc){Yb=2*qe[Zb.head]+Zb.xmx+Ob.notes[Nc].shac+2;Ob.notes[Nc].micro&&(Yb+=2);Zb.dots&&(Yb+=6);for(Db=0;Db<=Ob.nhd;Db++)Ob.notes[Db].shhd+=Yb,Ob.notes[Db].shac-=Yb;Ob.xmx+=Yb}else{Yb=2*qe[Ob.head]+Ob.xmx+Zb.notes[Lc].shac+2;Zb.notes[Lc].micro&&(Yb+=2);Ob.dots&&(Yb+=6);for(Db=0;Db<=Zb.nhd;Db++)Zb.notes[Db].shhd+=Yb,Zb.notes[Db].shac-=Yb;Zb.xmx+=Yb}}else{Ib=0;X.dots?R.dots&&(zb||(Ib=1)):R.dots&&Ca+Cb<Ya+Dd&&(Ib=1);cd=lc;dd=Mb;!yc&&Ca+Cb<Ya+
Dd&&(X=R,R=Xa,Ya=Ca,cd=Kb,dd=bd,Dd=Cb);Ya+=3;0>Ya&&(Ya=0);kb=0<=X.stem?0:X.nhd;Ya+=X.notes[kb].shhd;kb=0<=R.stem?0:R.nhd;Ya-=R.notes[kb].shhd;if(X.dots)if(jc=7.7+X.xmx+3.5*X.dots-3.5+3,!Ib){Ca=-100;for(jb=0;jb<=X.nhd;jb++)M=X.notes[jb].pit,M&1||(X.dot_low?M--:M++),M*=2,1>M?M=1:95<=M&&(M=94),cd[M]>Ca&&(Ca=cd[M]),cd[M-1]+1>Ca&&(Ca=cd[M-1]+1),cd[M+1]+1>Ca&&(Ca=cd[M+1]+1);jc+Ca+2>Ya&&(Ya=jc+Ca+2)}else if(jc<Ya+Dd+R.xmx){for(jb=Ca=0;jb<=X.nhd;jb++)M=X.notes[jb].pit,M&1||(X.dot_low?M--:M++),M*=2,1>M?M=
1:95<=M&&(M=94),dd[M]>Ca&&(Ca=dd[M]),dd[M-1]+1>Ca&&(Ca=dd[M-1]=1),dd[M+1]+1>Ca&&(Ca=dd[M+1]+1);4.5<Ca&&7.7+X.xmx+2<Ya+Ca+R.xmx&&(R.xmx=Ca+3-7.7)}for(kb=R.nhd;0<=kb;kb--)R.notes[kb].shhd+=Ya;R.xmx+=Ya;Ib&&(X.xmx=R.xmx)}}}}}var sb,oc,Ed,mc,nc,Sc,Tc;for(sb=S;sb;)if(sb.type!=k.NOTE||sb.invis)sb=sb.ts_next;else{Ed=sb.st;Sc=sb.time;nc=!1;for(oc=sb;oc&&oc.time==Sc&&oc.type==k.NOTE&&oc.st==Ed;oc=oc.ts_next)if(!nc)for(mc=0;mc<=oc.nhd;mc++)if(oc.notes[mc].acc){nc=!0;break}if(nc){Tc=rf[sb.head];for(Ed={notes:[]};sb!=
oc;sb=sb.ts_next)Ed.notes=Ed.notes.concat(sb.notes);Oe(Ed);sf(Ed.notes,Tc)}else sb=oc}for(var ic,Fc,Gc,tb,Ma=S,Na=Ma,uc=0,vc=[],Fd=[],Gd=0;;){ic=uc;do aa.set_width(Ma),tb=Ma.st,void 0==vc[tb]&&(vc[tb]=0),void 0==Fd[tb]&&(Fd[tb]=0),Fc=vc[tb]+Fd[tb]+Ma.wl,Fc>ic&&(ic=Fc),Ma=Ma.ts_next;while(Ma&&!Ma.seqst);Na.shrink=ic-uc;Gd||(Na.space=Na.ts_prev?Ic(Na):0);0==Na.shrink&&0==Na.space&&Na.type==k.CLEF&&(delete Na.seqst,Na.time=Na.ts_prev.time);if(!Ma)break;for(tb=0;tb<Fd.length;tb++)Fd[tb]=0;uc=ic;do tb=
Na.st,vc[tb]=uc,Na.wr>Fd[tb]&&(Fd[tb]=Na.wr),Na.tp0&&1==++Gd&&!Gc&&(Gc=Na),Na.te0&&Gd--,Na=Na.ts_next;while(!Na.seqst)}if(Ma=Gc){do{Na=Ma;Gd=1;do Ma=Ma.ts_next,Ma.tp0&&Gd++,Ma.te0&&Gd--;while(0!=Gd);var zc=void 0,Vc=void 0,Oa=Na,Ac=Ma,Hc=Oa.time,Yc=Ac.time+Ac.dur-Hc,Kc=vf(Oa,Yc/Oa.tq0)*Oa.tq0/Yc;do Oa=Oa.ts_next;while(!Oa.seqst);for(;!Oa.dur;)Oa=Oa.ts_next;for(;!Oa.seqst;)Oa=Oa.ts_prev;do Ac=Ac.ts_next?Ac.ts_next:zc=wf(Ac);while(!Ac.seqst);for(zc=Oa;;){zc.dur&&zc.dur*Kc<zc.shrink&&(Kc=zc.shrink/zc.dur);
if(zc==Ac)break;zc=zc.ts_next}for(;;){Oa.seqst&&(Vc=(Oa.time-Hc)*Kc,Hc=Oa.time);Oa.space=Vc;if(Oa==Ac)break;Oa=Oa.ts_next}for(;Ma&&!Ma.tp0;)Ma=Ma.ts_next}while(Ma)}b=Le(!0);if(r.singleline)a=xf(),c=b+a[0]+a[1]+yf(S,null),ha.width=c*r.scale+ha.lm+ha.rm+2;else{var Yd=c=nd(),Hd=b,Ra,Za,ed,Oc,wc;Ra=S;0!=Hd&&(Oc=Le(),Yd-=Oc,Hd-=Oc);Oc=xf();Yd-=Oc[0];Hd+=Oc[1];r.custos&&1==x.length&&(Yd-=12);if(r.barsperstaff)for(Oc=r.barsperstaff,Za=Ra;Za;Za=Za.ts_next)Za.type!=k.BAR||!Za.bar_num||0<--Oc||(Za.eoln=!0,
Oc=r.barsperstaff);wc=Hd;for(Za=Ra;Ra;Ra=Ra.ts_next)if(Ra.seqst||Ra.eoln){wc+=Ra.shrink;if(wc>Yd)Za=zf(Za,Ra,Yd,Hd);else{if(!Ra.eoln)continue;delete Ra.eoln;if(Ra.dur){for(ed=Ra.ts_next;ed&&!(ed.seqst||ed.dur<Ra.dur);ed=ed.ts_next);Za=ed&&!ed.seqst?zf(Za,Ra,Yd,Hd):ge(Ra)}else Za=ge(Ra)}if(!Za)break;Za.ts_prev?(wc=Za.shrink,Ra=Za.ts_prev,Hd=0):delete Za.nl}}for(je=1.2;;){Mg();aa.set_sym_glue(c-b);if(0!=za){0!=b&&(Jb+=b);var kd,Uc,Wc,Id,$b,Zd,ub,pc,Bc,ac,E,Pb,Pc;kd=y;y="";for(ac=0;ac<x.length;ac++){var qd=
{},rd=!0;Pc=x[ac];for(E=Pc.sym;E;E=E.next)switch(E.type){case k.GRACE:for(ub=E.extra;ub;ub=ub.next)ub.beam_st&&!ub.beam_end&&aa.calculate_beam(qd,ub);break;case k.NOTE:if(E.beam_st&&!E.beam_end||rd&&!E.beam_st)rd=!1,aa.calculate_beam(qd,E)}}for(Bc=0;Bc<=Q;Bc++)for(Pb=v[Bc],Pb.top||(Pb.top=new Float32Array(256),Pb.bot=new Float32Array(256)),$b=0;256>$b;$b++)Pb.top[$b]=0,Pb.bot[$b]=24;for(var Xc=void 0,bc=void 0,$d=void 0,Jc=void 0,Eb=void 0,na=void 0,xd=void 0,Jc=0;Jc<x.length;Jc++)if(xd=x[Jc],na=
xd.sym)if(na=na.next){var $a,fd,Zc,Fb,cc,ba,oa;for(oa=na;oa;oa=oa.next)if(oa.ti1)if(0!=oa.multi)for(Fb=0<oa.multi?k.SL_ABOVE:k.SL_BELOW,ba=0;ba<=oa.nhd;ba++)$a=oa.notes[ba].ti1,($a&7)==k.SL_AUTO&&(oa.notes[ba].ti1=$a&k.SL_DOTTED|Fb);else{Zc=cc=0;fd=128;for(ba=0;ba<=oa.nhd;ba++)oa.notes[ba].ti1&&(cc++,128>fd&&oa.notes[ba].pit<=fd+1&&Zc++,fd=oa.notes[ba].pit);if(1>=cc)for(Fb=0>oa.stem?k.SL_ABOVE:k.SL_BELOW,ba=0;ba<=oa.nhd;ba++){if($a=oa.notes[ba].ti1){($a&7)==k.SL_AUTO&&(oa.notes[ba].ti1=$a&k.SL_DOTTED|
Fb);break}}else if(0==Zc)if(cc&1)for(cc=(cc-1)/2,Fb=k.SL_BELOW,ba=0;ba<=oa.nhd;ba++)$a=oa.notes[ba].ti1,0!=$a&&(0==cc&&22<=oa.notes[ba].pit&&(Fb=k.SL_ABOVE),($a&7)==k.SL_AUTO&&(oa.notes[ba].ti1=$a&k.SL_DOTTED|Fb),0==cc--&&(Fb=k.SL_ABOVE));else for(cc/=2,Fb=k.SL_BELOW,ba=0;ba<=oa.nhd;ba++)$a=oa.notes[ba].ti1,0!=$a&&(($a&7)==k.SL_AUTO&&(oa.notes[ba].ti1=$a&k.SL_DOTTED|Fb),0==--cc&&(Fb=k.SL_ABOVE));else{fd=128;for(ba=0;ba<=oa.nhd;ba++)if(oa.notes[ba].ti1){if(128>fd&&oa.notes[ba].pit<=fd+1){cc=ba;break}fd=
oa.notes[ba].pit}Fb=k.SL_BELOW;for(ba=0;ba<=oa.nhd;ba++)$a=oa.notes[ba].ti1,0!=$a&&(cc==ba&&(Fb=k.SL_ABOVE),($a&7)==k.SL_AUTO&&(oa.notes[ba].ti1=$a&k.SL_DOTTED|Fb))}}for(;na;na=na.next)if(na.ti1&&(20>na.notes[0].pit&&(na.notes[0].ti1&7)==k.SL_BELOW||24<na.notes[na.nhd].pit&&(na.notes[na.nhd].ti1&7)==k.SL_ABOVE)){for(Eb=na.next;Eb&&Eb.type!=k.NOTE;)Eb=Eb.next;if(Eb){if(Eb.st!=na.st)continue;$d=Eb.x-na.x-10}else $d=za-na.x-10;Xc=100>$d?9:300>$d?12:16;24<na.notes[na.nhd].pit&&(bc=3*(na.notes[na.nhd].pit-
18)+Xc,na.ymx<bc&&(na.ymx=bc),Eb&&Eb.ymx<bc&&(Eb.ymx=bc),H(na.st,!0,na.x+5,$d,bc));20>na.notes[0].pit&&(bc=3*(na.notes[0].pit-18)-Xc,na.ymn>bc&&(na.ymn=bc),Eb&&Eb.ymn>bc&&(Eb.ymn=bc),H(na.st,!1,na.x+5,$d,bc))}}pg();for(E=S;E;E=E.ts_next)if(!E.invis){switch(E.type){case k.GRACE:for(ub=E.extra;ub;ub=ub.next)H(E.st,!0,ub.x-2,4,ub.ymx+1),H(E.st,!1,ub.x-2,4,ub.ymn-1);continue;case k.MREST:H(E.st,!0,E.x+16,32,E.ymx+2);continue;default:H(E.st,!0,E.x-E.wl,E.wl+E.wr,E.ymx+2);H(E.st,!1,E.x-E.wl,E.wl+E.wr,E.ymn-
2);continue;case k.NOTE:}0<E.stem?(E.beam_st?(Id=3,Zd=E.beam_end?4:10):(Id=-8,Zd=E.beam_end?11:16),H(E.st,!0,E.x+Id,Zd,E.ymx),H(E.st,!1,E.x-E.wl,E.wl+E.wr,E.ymn)):(H(E.st,!0,E.x-E.wl,E.wl+E.wr,E.ymx),E.beam_st?(Id=-6,Zd=E.beam_end?4:10):(Id=-8,Zd=E.beam_end?5:16),Id+=E.notes[0].shhd,H(E.st,!1,E.x+Id,Zd,E.ymn));E.notes[E.nhd].acc&&(pc=E.y+8,E.ymx<pc&&(E.ymx=pc),H(E.st,!0,E.x,0,pc));E.notes[0].acc&&(pc=E.y,pc=1==E.notes[0].acc||3==E.notes[0].acc?pc-7:pc-5,E.ymn>pc&&(E.ymn=pc),H(E.st,!1,E.x,0,pc))}for(ac=
0;ac<x.length;ac++)if(Pc=x[ac],E=Pc.sym){tc(E.color);Bc=Pc.st;for(xc(Bc);E;E=E.next)E.tp0&&Je(E,0);var Jd=void 0,lb=void 0,Cc=Pc,ab=Cc.sym,Qc=Cc.slur_start,Kd=0;if(ab){if(Qc)for(Cc.slur_start=0;0!=Qc;)Kd<<=4,Kd|=Qc&15,Qc>>=4;for(Ie(ab,void 0);ab;ab=ab.next)for(;ab.slur_end||ab.sl2;){if(ab.slur_end)ab.slur_end--,Jd=-1;else{for(Jd=0;Jd<=ab.nhd&&!ab.notes[Jd].sl2;Jd++);ab.notes[Jd].sl2--;ab.sl2--}Qc=Kd&15;lb=Ze(ab);pe(lb,ab,-1,Jd,Qc);lb.type==k.BAR&&(":"==lb.bar_type[0]||"|]"==lb.bar_type||"[|"==lb.bar_type||
lb.text&&"1"!=lb.text[0])||(Kd>>=4)}for(ab=Cc.sym;0!=Kd;)Qc=Kd&15,Kd>>=4,lb=gf(ab),pe(ab,lb,-1,-1,Qc),lb.type==k.BAR&&(":"==lb.bar_type[0]||"|]"==lb.bar_type||"[|"==lb.bar_type||lb.text&&"1"!=lb.text[0])||(Cc.slur_start||(Cc.slur_start=0),Cc.slur_start<<=4,Cc.slur_start+=Qc)}for(E=Pc.sym;E;E=E.next)E.tp0&&Je(E,0)}for(Bc=0;Bc<=Q;Bc++)for(Pb=v[Bc],Wc=Pb.topbar+2,Uc=Pb.botbar-2,$b=0;256>$b;$b++)Wc>Pb.top[$b]&&(Pb.top[$b]=Wc),Uc<Pb.bot[$b]&&(Pb.bot[$b]=Uc);tc(void 0);for(var $c=void 0,Ad=void 0,Mc=void 0,
se=void 0,ce=qa.length,se=0;se<ce;se++)if(Mc=qa[se],Ad=Mc.dd,$c=Ad.func,Yg[$c]&&void 0==Mc.m)He[$c](Mc);for(var jd=void 0,ld=void 0,te=void 0,ke=void 0,ue=void 0,gd=void 0,Da=void 0,ve=void 0,Ea=void 0,md=void 0,qc=void 0,le=void 0,we=void 0,xe=void 0,Ia=void 0,bb=Array(Q),Td=qa.length,Ea=0;Ea<=Q;Ea++)bb[Ea]={ymin:0,ymax:0};for(Ea=0;Ea<Td;Ea++)Da=qa[Ea],(gd=Da.dd)&&Cd[gd.func]&&void 0==Da.m&&(He[gd.func](Da),!gd.dd_en&&r.dynalign&&(Da.up?Da.y>bb[Da.st].ymax&&(bb[Da.st].ymax=Da.y):Da.y<bb[Da.st].ymin&&
(bb[Da.st].ymin=Da.y)));for(Ea=0;Ea<Td;Ea++)Da=qa[Ea],(gd=Da.dd)&&!gd.dd_en&&Cd[gd.func]&&(r.dynalign?(qc=Da.up?bb[Da.st].ymax:bb[Da.st].ymin,Da.y=qc):qc=Da.y,Da.up&&(qc+=gd.h),H(Da.st,Da.up,Da.x,Da.val,qc));for(Ea=0;Ea<=Q;Ea++)bb[Ea]={ymin:0,ymax:24};for(Ia=S;Ia;Ia=Ia.ts_next)if(Ia.a_gch){xe||(xe=Ia);ke=null;for(te=0;te<Ia.a_gch.length&&!(ue=Ia.a_gch[te],"g"==ue.type&&(ke=ue,0>ue.y));te++);ke&&(md=ke.w,0<=ke.y?(qc=T(Ia.st,!0,Ia.x,md),qc>bb[Ia.st].ymax&&(bb[Ia.st].ymax=qc)):(qc=T(Ia.st,!1,Ia.x,md),
qc<bb[Ia.st].ymin&&(bb[Ia.st].ymin=qc)))}if(xe){for(Ea=0;Ea<=Q;Ea++)jd=v[Ea].botbar,bb[Ea].ymin>jd-4&&(bb[Ea].ymin=jd-4),ld=v[Ea].topbar,bb[Ea].ymax<ld+4&&(bb[Ea].ymax=ld+4);xc(-1);for(Ia=xe;Ia;Ia=Ia.ts_next)Ia.a_gch&&aa.draw_gchord(Ia,bb[Ia.st].ymin,bb[Ia.st].ymax)}for(ve=0;ve<x.length;ve++)if(we=x[ve],!we.second&&we.sym){var od=void 0,pd,me,Dc,Ld,vb,U,Qb=we;Ld=v[Qb.st].topbar+25;for(U=Qb.sym;U;U=U.next)if(U.type==k.BAR&&U.rbstart&&!U.norepbra){if(!U.next)break;od||(od=U,va("repeat"));for(vb=U;U.next&&
(U=U.next,!U.rbstop););Dc=T(Qb.st,!0,vb.x,U.x-vb.x);Ld<Dc&&(Ld=Dc);vb.text&&(pd=Ka(vb.text),Dc=T(Qb.st,!0,vb.x+4,pd[0]),Dc+=pd[1],Ld<Dc&&(Ld=Dc));U.rbstart&&(U=U.prev)}if(U=od)for(xc(Qb.st,!0),Dc=Ld*v[Qb.st].staffscale;U;U=U.next)if(U.rbstart&&!U.norepbra){for(vb=U;U.next&&(U=U.next,!U.rbstop););if(vb==U)break;le=vb.x;me=U.type!=k.BAR?U.rbstop?0:U.x-za+4:1<U.bar_type.length&&"[]"!=U.bar_type||"]"==U.bar_type?0<vb.st&&!(B.staves[vb.st-1].flags&64)?U.wl:":"==U.bar_type.slice(-1)?12:":"!=U.bar_type[0]?
0:8:U.rbstop?0:8;me=U.x-le-me;U.next||U.rbstop||Qb.bar_start||(Qb.bar_start=C(U),Qb.bar_start.type=k.BAR,Qb.bar_start.bar_type="[",delete Qb.bar_start.text,Qb.bar_start.rbstart=1,delete Qb.bar_start.a_gch);vb.text&&fa(le+4,Dc-K.curfont.size-3,vb.text);Sd(le,Dc);2==vb.rbstart&&(y+="m0 20v-20");y+="h"+me.toFixed(2);2==U.rbstop&&(y+="v20");y+='"/>\n';H(vb.st,!0,le,me,Ld+2);U.rbstart&&(U=U.prev)}}xc(-1);for(ac=0;ac<x.length;ac++)if(Pc=x[ac],Pc.have_ly){for(var Md=void 0,ae=void 0,ye=void 0,dc=void 0,
ze=void 0,wb=void 0,ne=void 0,ka=void 0,cb=void 0,Aa=void 0,Gb=Array(Q),Nd=x.length,hd=Array(Nd),oe=Array(Nd),sd=Array(Nd),Ud=Array(Nd),id=0,Rc=0,Fa=-1,ka=0;ka<Nd;ka++)if(Aa=x[ka],Aa.sym){Aa.st!=Fa&&(Rc=id=0,Fa=Aa.st);ne=0;if(Aa.have_ly)for(hd[ka]||(hd[ka]=[]),cb=Aa.sym;cb;cb=cb.next){if(ae=cb.a_ly){ze=cb.x;ye=10;for(wb=0;wb<ae.length;wb++)if((Md=ae[wb])&&0!=Md.w){ze-=Md.shift;ye=Md.w;break}dc=T(Aa.st,1,ze,ye);id<dc&&(id=dc);dc=T(Aa.st,0,ze,ye);for(Rc>dc&&(Rc=dc);ne<ae.length;)hd[ka][ne++]=0;for(wb=
0;wb<ae.length;wb++)(Md=ae[wb])&&(!hd[ka][wb]||Md.font.size>hd[ka][wb])&&(hd[ka][wb]=Md.font.size)}}else dc=T(Aa.st,1,0,za),id<dc&&(id=dc),dc=T(Aa.st,0,0,za),Rc>dc&&(Rc=dc);Gb[Fa]||(Gb[Fa]={});Gb[Fa].top=id;Gb[Fa].bot=Rc;oe[ka]=ne;0!=ne&&(sd[ka]=Aa.pos.voc?Aa.pos.voc==k.SL_ABOVE:x[ka+1]&&x[ka+1].st==Fa&&x[ka+1].have_ly?!0:!1,sd[ka]?Gb[Fa].a=!0:Gb[Fa].b=!0)}for(ka=wb=0;ka<Nd;ka++)Aa=x[ka],Aa.sym&&Aa.have_ly&&(sd[ka]?Ud[wb++]=ka:(Fa=Aa.st,xc(Fa,!0),0<oe[ka]&&(Gb[Fa].bot=cg(Aa,oe[ka],hd[ka],Gb[Fa].bot,
1))));for(;0<=--wb;)ka=Ud[wb],Aa=x[ka],Fa=Aa.st,xc(Fa,!0),Gb[Fa].top=cg(Aa,oe[ka],hd[ka],Gb[Fa].top,-1);for(ka=0;ka<Nd;ka++)if(Aa=x[ka],Aa.sym){Fa=Aa.st;if(Gb[Fa].a)for(id=Gb[Fa].top+2,cb=Aa.sym.next;cb;cb=cb.next)cb.a_ly&&H(Fa,1,cb.x-2,10,id);if(Gb[Fa].b)if(Rc=Gb[Fa].bot-2,0<oe[Aa.v])for(cb=Aa.sym.next;cb;cb=cb.next)cb.a_ly&&H(Fa,0,cb.x-2,10,Rc);else H(Fa,0,0,za,Rc)}break}if(0<=r.measurenb){for(var Ae=void 0,Be=void 0,Rb=void 0,ua=void 0,Ec=void 0,mb=void 0,Ba=void 0,pa=void 0,ud=B,Ba=0;Ba<=Q&&!ud.st_print[Ba];Ba++);
if(!(Ba>Q)){xc(Ba);1!=v[Ba].staffscale&&(Ae=kc("measure").size,La("measurefont","* "+(Ae/v[Ba].staffscale).toString()));va("measure");pa=S;mb=K.nbar;if(1<mb)if(0==r.measurenb)Be=!0,ua=T(Ba,!0,0,20),ua<v[Ba].topbar+14&&(ua=v[Ba].topbar+14),r.measurebox?fe(0,ua,mb.toString()):fa(0,ua,mb.toString()),H(Ba,!0,0,20,ua+K.curfont.size+2);else if(0==mb%r.measurenb){for(;;pa=pa.ts_next){switch(pa.type){case k.METER:case k.CLEF:case k.KEY:case k.STBRK:continue}break}for(;pa.st!=Ba;)pa=pa.ts_next;pa.type==k.BAR&&
pa.bar_num||(pa.prev&&pa.prev.type!=k.CLEF&&(pa=pa.prev),Ec=pa.x-pa.wl,Be=!0,Rb=hc("0")*K.curfont.swfac,10<=mb&&(Rb*=100<=mb?3:2),r.measurebox&&(Rb+=4),ua=T(Ba,!0,Ec,Rb),ua<v[Ba].topbar+6&&(ua=v[Ba].topbar+6),ua+=2,r.measurebox?(fe(Ec,ua,mb.toString()),ua+=2,Rb+=3):fa(Ec,ua,mb.toString()),ua+=K.curfont.size,H(Ba,!0,Ec,Rb,ua),pa.ymx=ua)}for(;pa;pa=pa.ts_next){switch(pa.type){case k.STAVES:ud=pa.sy;for(Ba=0;Ba<Q&&!ud.st_print[Ba];Ba++);db(Ba);continue;default:continue;case k.BAR:if(!pa.bar_num)continue}mb=
pa.bar_num;0!=r.measurenb&&0==mb%r.measurenb&&pa.next&&(Be||(Be=!0),Rb=hc("0")*K.curfont.swfac,10<=mb&&(Rb*=100<=mb?3:2),r.measurebox&&(Rb+=4),Ec=pa.x-.4*Rb,ua=T(Ba,!0,Ec,Rb),ua<v[Ba].topbar+6&&(ua=v[Ba].topbar+6),pa.next.type==k.NOTE&&(0<pa.next.stem?ua<pa.next.ys-K.curfont.size&&(ua=pa.next.ys-K.curfont.size):ua<pa.next.y&&(ua=pa.next.y)),ua+=2,r.measurebox?(fe(Ec,ua,mb.toString()),ua+=2,Rb+=3):fa(Ec,ua,mb.toString()),ua+=K.curfont.size,H(Ba,!0,Ec,Rb,ua),pa.ymx=ua)}K.nbar=mb;Ae&&La("measurefont",
"* "+Ae.toString())}}xc(-1);y=kd;d=xg();var ec;for(ec=0;ec<=Q;ec++)v[ec].sc_out&&(y+='<g transform="translate(0,'+(ma-v[ec].y).toFixed(2)+") scale("+v[ec].staffscale.toFixed(2)+')">\n'+v[ec].sc_out+"</g>\n",v[ec].sc_out=""),v[ec].output&&(y+='<g transform="translate(0,'+(-v[ec].y).toFixed(2)+')">\n'+v[ec].output+"</g>\n",v[ec].output="");yg(b);var Ce,De,he=x.length;for(Ce=0;Ce<he;Ce++)De=x[Ce],De.sym&&void 0!=De.sym.x&&aa.draw_symbols(De);var Ee=void 0,be=void 0,Fe=void 0,vd=void 0,Od=void 0,Pd=void 0,
fb=void 0,fc=void 0,Hb=void 0,rc=void 0,Wd=void 0,Qd=void 0,sc=void 0,la=void 0;if(0!=qa.length){var Xd=[],wd=[];if(!r.dynalign)for(Hb=Q,fb=v[Hb].y;0<=--Hb;)Pd=v[Hb].y,wd[Hb]=.5*(fb+24+Pd),fb=Pd;for(;;){la=qa.shift();if(!la)break;if((sc=la.dd)&&!sc.dd_en&&(Qd=la.s,rc=sc.glyph,Fe=rc.indexOf("/"),0<Fe&&(rc=0<=Qd.stem?rc.slice(0,Fe):rc.slice(Fe+1)),Cd[sc.func]?db(Qd.st):ad(Qd),Hb=la.st,v[Hb].topbar))if(fc=la.x,fb=la.y+v[Hb].y,void 0!=la.m?(Wd=Qd.notes[la.m],fc+=Wd.shhd*D.scale):Cd[sc.func]&&!r.dynalign&&
(la.up&&0<Hb||!la.up&&Hb<Q)&&(Od=la.up?wd[--Hb]:wd[Hb++],Od-=.5*sc.h,la.up&&fb<Od||!la.up&&fb>Od)&&(Pd=T(Hb,!la.up,la.x,la.val)+v[Hb].y,la.up&&(Pd-=sc.h),la.up&&Pd>Od||!la.up&&Pd<Od)&&(fb=Od),(vd=w[rc])&&"function"==typeof vd)vd(fc,fb,la);else if(!aa.psdeco(rc,fc,fb,la)){ob(Qd,"deco");la.inv&&(de(fc,fb,0,1,-1),fc=fb=0);if(la.has_val)2!=sc.func||0>D.st?Re(fc,fb,rc,la.val/D.scale,la.defl):Re(fc,fb,rc,la.val,la.defl),la.defl.noen&&Xd.push(la.start);else if(void 0!=sc.str&&"sfz"!=sc.str)be=sc.str,"@"==
be[0]&&(Ee=be.match(/^@([0-9.-]+),([0-9.-]+);?/),fc+=Number(Ee[1]),fb+=Number(Ee[2]),be=be.replace(Ee[0],"")),Rf(fc,fb,rc,be);else if(la.lden){var yd=la.dd.glyph;if(og[yd])og[yd](fc,fb,la);else N(1,null,"No function for decoration '$1'",yd)}else ca(fc,fb,rc);D.g&&ee();yb(Qd,"deco")}}qa=Xd}db(-1);ta(d);0!=b&&(Jb-=b,Vd&=-3);for(;0!=re.length;)Bf(re.shift())}S=Sb;td();if(!Sb)break;Cf();if(!S)break;S.ts_prev=null;var Ge,zd,Bd,ie=x.length;for(Ge=0;Ge<ie;Ge++)if(Bd=x[Ge],zd=Bd.s_next,Bd.sym=zd)zd.prev=
null;c=nd();b=Le()}}};Abc.prototype.param_set_font=La;Abc.prototype.parse=q;Abc.prototype.psdeco=function(){return!1};Abc.prototype.psxygl=function(){return!1};Abc.prototype.set_bar_num=function(){var a,c,b,d,e,f=x[B.top_voice].meter.wmeasure,g=K.nbar;for(a=S;;a=a.ts_next){if(!a)return;switch(a.type){case k.METER:f=a.wmeasure;case k.CLEF:case k.KEY:case k.STBRK:continue;case k.BAR:a.bar_num?K.nbar=a.bar_num:a.text&&!r.contbarnb&&("1"==a.text[0]?g=K.nbar:(K.nbar=g,a.bar_num=K.nbar))}break}b=a.time+
f;if(0==a.time)for(c=a.ts_next;c;c=c.ts_next)if(c.type==k.BAR&&c.time){c.time<b&&(a=c,b=a.time+f);break}for(d=K.nbar;a;a=a.ts_next)switch(a.type){case k.METER:f=a.wmeasure;a.time<b&&(b=a.time+f);break;case k.MREST:for(d+=a.nmes-1;a.ts_next&&a.ts_next.type!=k.BAR;)a=a.ts_next;break;case k.BAR:if(a.bar_num&&(d=a.bar_num),a.time<b)a.text&&"1"==a.text[0]&&(g=d,e=b-a.time);else{b=a.time;c=a;do{if(c.dur)break;if(c.type==k.BAR&&c.text)break;c=c.next}while(c&&c.time==b);d++;if(c&&c.type==k.BAR&&c.text)if("1"==
c.text[0])e=0,g=d;else if(r.contbarnb||(d=g),e){r.contbarnb&&d--;b+=e;break}a.bar_num=d;for(b+=f;a.ts_next&&!a.ts_next.seqst;)a=a.ts_next}}0>r.measurenb&&(K.nbar=d)};Abc.prototype.set_cur_sy=function(a){B=a};Abc.prototype.set_dscale=xc;Abc.prototype.set_font=va;Abc.prototype.set_format=function(a,c,b){var d,e;if(b)lg[a]=!0;else if(lg[a])return;if(/.+font(-[\d])?$/.test(a))switch(" box"==c.slice(-4)&&(d=!0,c=c.slice(0,-4)),La(a,c),a){case "gchordfont":r.gchordbox=d;break;case "measurefont":r.measurebox=
d;break;case "partsfont":r.partsbox=d}else switch(a){case "aligncomposer":case "barsperstaff":case "infoline":case "measurefirst":case "measurenb":case "rbmax":case "rbmin":case "shiftunison":b=parseInt(c);if(isNaN(b)){u(1,"Bad integer value");break}r[a]=b;break;case "microscale":c=parseInt(c);if(isNaN(c)||4>c||256<c||c%1){u(1,P.bad_val,"%%"+a);break}aa.set_v_param("uscale",c);break;case "bgcolor":case "dblrepbar":case "titleformat":r[a]=c;break;case "breaklimit":case "lineskipfac":case "maxshrink":case "pagescale":case "parskipfac":case "scale":case "slurheight":case "stemheight":case "stretchlast":c=
parseFloat(c);if(isNaN(c)){u(1,P.bad_val,"%%"+a);break}switch(a){case "scale":c/=.75;case "pagescale":a="scale",ha.chg=!0}r[a]=c;break;case "bstemdown":case "breakoneoln":case "cancelkey":case "contbarnb":case "custos":case "decoerr":case "dynalign":case "flatbeams":case "gchordbox":case "graceslurs":case "graceword":case "hyphencont":case "keywarn":case "linewarn":case "measurebox":case "partsbox":case "rbdbstop":case "singleline":case "squarebreve":case "straightflags":case "stretchstaff":case "timewarn":case "titlecaps":case "titleleft":r[a]=
vc(c);break;case "chordnames":b=c.split(",");r.chordnames={};for(e=0;e<b.length;e++)r.chordnames["CDEFGAB"[e]]=b[e];break;case "composerspace":case "indent":case "infospace":case "maxstaffsep":case "maxsysstaffsep":case "musicspace":case "partsspace":case "staffsep":case "subtitlespace":case "sysstaffsep":case "textspace":case "titlespace":case "topspace":case "vocalspace":case "wordsspace":c=qb(c);isNaN(c)?u(1,P.bad_val,"%%"+a):r[a]=c;break;case "print-leftmargin":u(0,"$1 is deprecated - use %%printmargin instead",
"%%"+a),a="printmargin";case "printmargin":case "leftmargin":case "pagewidth":case "rightmargin":c=qb(c);if(isNaN(c)){u(1,P.bad_val,"%%"+a);break}r[a]=c;ha.chg=!0;break;case "concert-score":"play"!=r.sound&&(r.sound="concert");break;case "writefields":c=c.split(/\s+/);if(vc(c[1]))for(e=0;e<c[0].length;e++)a=c[0][e],0>r.writefields.indexOf(a)&&(r.writefields+=a);else for(e=0;e<c[0].length;e++)a=c[0][e],0<=r.writefields.indexOf(a)&&(r.writefields=r.writefields.replace(a,""));break;case "dynamic":case "gchord":case "gstemdir":case "ornament":case "stemdir":case "vocal":case "volume":lf(a,
c);break;case "font":a=c.split(/\s+/);if(!(1>=a.length))if(c=parseFloat(a[a.length-1]),isNaN(c)||0>=a)u(1,"Bad scale value in %%font");else for(e in kf[a[0]]=c,zb)zb.hasOwnProperty(e)&&(b=zb[e],b.name==a[0]&&(b.swfac=b.size*c));break;case "fullsvg":if(0!=q.state){u(1,"Cannot have %%fullsvg inside a tune");break}r[a]=c;break;case "gracespace":b=c.split(/\s+/);for(e=0;3>e;e++)if(isNaN(Number(b[e]))){u(1,P.bad_val,"%%gracespace");break}for(e=0;3>e;e++)r[a]=Number(b[e]);break;case "tuplets":r[a]=c.split(/\s+/);
(b=r[a][3])&&We[b]&&(r[a][3]=We[b]);break;case "infoname":a:{a=c;e=r.infoname.split("\n");c=a[0];for(b=0;b<e.length;b++)if(e[b][0]==c){1==a.length?e.splice(b,1):e[b]=a;r.infoname=e.join("\n");break a}r.infoname+="\n"+a}break;case "notespacingfactor":c=parseFloat(c);if(isNaN(c)||1>c||2<c){u(1,P.bad_val,"%%"+a);break}e=5;for(a=Bb[e];0<=--e;)a/=c,Bb[e]=a;e=5;for(a=Bb[e];++e<Bb.length;)a*=c,Bb[e]=a;break;case "play":r.sound="play";break;case "pos":a=c.split(/\s+/);lf(a[0],a[1]);break;case "sounding-score":"play"!=
r.sound&&(r.sound="sounding");break;case "staffwidth":b=qb(c);if(isNaN(b)){u(1,P.bad_val,"%%"+a);break}if(100>b){u(1,"%%staffwidth too small");break}b=r.pagewidth-b-r.leftmargin;if(2>b){u(1,"%%staffwidth too big");break}r.rightmargin=b;ha.chg=!0;break;case "textoption":r[a]=mg[c];break;case "titletrim":b=Number(c);isNaN(b)?r[a]=vc(c):r[a]=b;break;case "combinevoices":u(1,"%%combinevoices is deprecated - use %%voicecombine instead");break;case "voicemap":aa.set_v_param("map",c);break;case "voicescale":aa.set_v_param("scale",
c);break;default:0==q.state&&(r[a]=c)}};Abc.prototype.set_pitch=function(a){var c,b,d,e,f,g=k.BLEN,l=Array(Q);for(b=0;b<=Q;b++)c=v[b].clef,l[b]=Xe[c.clef_type]+2*c.clef_line,c.clefpit&&(l[b]+=c.clefpit),r.sound?c.clef_octave&&!c.clef_oct_transp&&(l[b]+=c.clef_octave):c.clef_oct_transp&&(l[b]-=c.clef_octave);for(c=S;c!=a;c=c.ts_next)switch(b=c.st,c.type){case k.CLEF:l[b]=Xe[c.clef_type]+2*c.clef_line;c.clefpit&&(l[b]+=c.clefpit);r.sound?c.clef_octave&&!c.clef_oct_transp&&(l[b]+=c.clef_octave):c.clef_oct_transp&&
(l[b]-=c.clef_octave);Ud(c);break;case k.GRACE:for(b=c.extra;b;b=b.next){d=l[b.st];if(0!=d&&!c.p_v.key.k_drum)for(e=0;e<=b.nhd;e++)f=b.notes[e],f.pit+=d;b.ymn=3*(b.notes[0].pit-18)-2;b.ymx=3*(b.notes[b.nhd].pit-18)+2}Ud(c);break;case k.KEY:c.k_y_clef=l[b];default:Ud(c);break;case k.MREST:if(c.invis)break;c.y=12;c.ymx=39;c.ymn=-2;break;case k.REST:if(1==x.length){c.y=12;c.ymx=24;c.ymn=0;break}case k.NOTE:d=l[b];if(0!=d&&!c.p_v.key.k_drum)for(e=c.nhd;0<=e;e--)c.notes[e].opit=c.notes[e].pit,c.notes[e].pit+=
d;c.type==k.NOTE?(c.ymx=3*(c.notes[c.nhd].pit-18)+4,c.ymn=3*(c.notes[0].pit-18)-4):(c.y=6*((c.notes[0].pit-18)/2|0),c.ymx=c.y+ng[5-c.nflags][0],c.ymn=c.y-ng[5-c.nflags][1]);c.dur<g&&(g=c.dur)}a||(sd=g)};Abc.prototype.set_scale=ad;Abc.prototype.set_stem_dir=function(){for(var a,c,b,d,e,f,g,l=[],h=S,m=B,n=m.nstaff;h;){for(a=0;a<=n;a++)l[a]=[];g=[];for(c=h;c&&c.type!=k.BAR;c=c.ts_next)if(c.type==k.STAVES){if(c!=h)break;m=h.sy;for(a=n;a<=m.nstaff;a++)l[a]=[];n=m.nstaff}else if(!(c.type!=k.NOTE&&c.type!=
k.REST||c.invis)){a=c.st;if(a>n)throw c="*** fatal set_stem_dir(): bad staff number "+a+" max "+n,N(2,null,c),Error(c);b=c.v;d=g[b];d||(d={st1:-1,st2:-1},g[b]=d);0>d.st1?d.st1=a:d.st1!=a&&(a>d.st1?a>d.st2&&(d.st2=a):(d.st1>d.st2&&(d.st2=d.st1),d.st1=a));e=l[a];d=m.voices[b].range;for(b=e.length;0<=--b&&(f=e[b],f.v!=d););if(0>b){f={v:d,ymx:0,ymn:24};for(b=0;b<e.length;b++)if(d<e[b].v){e.splice(b,0,f);break}b==e.length&&e.push(f)}c.type==k.NOTE&&(c.ymx>f.ymx&&(f.ymx=c.ymx),c.ymn<f.ymn&&(f.ymn=c.ymn),
c.xstem&&(c.ts_prev.st!=a-1||c.ts_prev.type!=k.NOTE?(N(1,h,"Bad !xstem!"),c.xstem=!1):(c.ts_prev.multi=1,c.multi=1,c.stemless=!0)))}for(;h!=c;h=h.ts_next)if(!h.multi){switch(h.type){default:continue;case k.REST:if(void 0!=h.combine&&0>h.combine||!h.ts_next||h.ts_next.type!=k.REST||h.ts_next.st!=h.st||h.time!=h.ts_next.time||h.dur!=h.ts_next.dur||h.invis)break;pb(h.ts_next);case k.NOTE:case k.GRACE:}a=h.st;b=h.v;d=g[b];e=l[a];if(d&&0<=d.st2)a==d.st1?h.multi=-1:a==d.st2&&(h.multi=1);else if(1>=e.length)h.floating&&
(h.multi=a==x[b].st?-1:1);else{d=m.voices[b].range;for(b=e.length;0<=--b&&e[b].v!=d;);0>b||(b==e.length-1?h.multi=-1:(h.multi=1,0!=b&&b+2==e.length&&(e[b].ymn-r.stemheight>e[b+1].ymx&&(h.multi=-1),a=h.ts_next,h.ts_prev&&h.ts_prev.time==h.time&&h.ts_prev.st==h.st&&h.notes[h.nhd].pit==h.ts_prev.notes[0].pit&&h.beam_st&&h.beam_end&&(!a||a.st!=h.st||a.time!=h.time)&&(h.multi=-1))))}}for(;h&&h.type==k.BAR;)h=h.ts_next}};Abc.prototype.set_stems=function(){var a,c,b,d,e,f,g,h;for(a=S;a;a=a.ts_next)if(a.type!=
k.NOTE){if(a.type==k.GRACE){g=h=a.mid;for(b=a.extra;b;b=b.next)c=15,1<b.nflags&&(c+=1.2*(b.nflags-1)),e=3*(b.notes[0].pit-18),f=3*(b.notes[b.nhd].pit-18),0<=a.stem?(b.y=e,b.ys=f+c,f=Math.round(b.ys)):(b.y=f,b.ys=e-c,e=Math.round(b.ys)),f+=2,e-=2,e<g?g=e:f>h&&(h=f),b.ymx=f,b.ymn=e;a.ymx=h;a.ymn=g}}else{qf(a);b=a.nflags;if(a.beam_st&&!a.beam_end){a.feathered_beam&&(b=++a.nflags);for(c=a.next;c.type!=k.NOTE||(a.feathered_beam&&c.nflags++,!c.beam_end);c=c.next);c.nflags>b&&(b=c.nflags)}else if(!a.beam_st&&
a.beam_end){for(c=a.prev;!c.beam_st;c=c.prev);c.nflags>b&&(b=c.nflags)}c=r.stemheight;switch(b){case 2:c+=2;break;case 3:c+=5;break;case 4:c+=10;break;case 5:c+=16}1!=(d=a.p_v.scale)&&(c*=.5*(d+1));e=3*(a.notes[0].pit-18);0<a.nhd?(c-=2,f=3*(a.notes[a.nhd].pit-18)):f=e;a.ntrem&&(c+=2*a.ntrem);a.stemless?(0<=a.stem?(a.y=e,a.ys=f):(a.ys=e,a.y=f),-4==b&&(e-=6),a.ymx=f+4,a.ymn=e-4):0<=a.stem?(2<=b&&--c,26<a.notes[a.nhd].pit&&(0>=b||!a.beam_st||!a.beam_end)&&(c-=2,28<a.notes[a.nhd].pit&&(c-=2)),a.y=e,a.notes[0].ti1&&
(e-=3),a.ymn=e-4,a.ys=f+c,a.ys<a.mid&&(a.ys=a.mid),a.ymx=a.ys+2.5|0):(18>a.notes[0].pit&&(0>=b||!a.beam_st||!a.beam_end)&&(c-=2,16>a.notes[0].pit&&(c-=2)),a.ys=e-c,a.ys>a.mid&&(a.ys=a.mid),a.ymn=a.ys-2.5|0,a.y=f,a.notes[a.nhd].ti1&&(f+=3),a.ymx=f+4)}};Abc.prototype.set_sym_glue=function(a){var c,b,d,e,f=0,g=0,h=0,q=0,m=0;for(c=S;c;c=c.ts_next)c.type!=k.GRACE||d||(d=c),c.seqst&&(f+=c.shrink,c.space?c.space<c.shrink?(m+=c.shrink,g+=c.shrink):g+=c.space:q+=c.shrink);if(0==g)za=0;else{b=!Sb||Sb.type==
k.BLOCK||re.length;if(f>=a||g==m){f>a&&N(1,c,"Line too much shrunk $1 $2 $3",f.toFixed(2),g.toFixed(2),a.toFixed(2));h=0;for(c=S;c;c=c.ts_next)c.seqst&&(h+=c.shrink),c.x=h;je=0}else if(b&&g+q>a*(1-r.stretchlast)||!b&&(g+q>a||r.stretchstaff)){for(b=4;0<=--b;){e=(a-q-m)/(g-m);h=m=g=0;for(c=S;c;c=c.ts_next)c.seqst&&(c.space?c.space*e<=c.shrink?(m+=c.shrink,g+=c.shrink,h+=c.shrink):(g+=c.space,h+=c.space*e):h+=c.shrink),c.x=h;if(.1>Math.abs(h-a))break}je=e}else for(e=(a-q-m)/g,je<e&&(e=je),c=S;c;c=c.ts_next)c.seqst&&
(h+=c.space*e<=c.shrink?c.shrink:c.space*e),c.x=h;za=h;for(c=d;c;c=c.ts_next)if(c.type==k.GRACE)for(h=c.gr_shift?c.prev.x+c.prev.wr:c.x-c.wl,a=c.extra;a;a=a.next)a.x+=h;for(c=S;c;c=c.ts_next){switch(c.type){case k.CLEF:case k.KEY:case k.METER:case k.PART:continue;case k.BAR:c.bar_type||c.text||(c.x=S.x-S.wl,c.prev&&c.prev.type==k.PART&&(c.prev.x=c.x+10));continue}break}}};Abc.prototype.set_tsfirst=function(a){S=a};Abc.prototype.set_vp=function(a){for(var c,b,d,e,f;;){b=a.shift();if(!b)break;if("="==
b[b.length-1]&&0==a.length){u(1,P.bad_val,b);break}switch(b){case "clef=":c=a.shift();break;case "clefpitch=":if(b=a.shift())if(e=xd.indexOf(b[0]),0<=e){switch(b[1]){case "'":e+=7;break;case ",":e-=7,","==b[2]&&(e-=7)}f=4-e;break}u(1,P.bad_val,b);break;case "octave=":case "uscale=":e=parseInt(a.shift());isNaN(e)?u(1,P.bad_val,b):h[b.slice(0,-1)]=e;break;case "cue=":h.scale="on"==a.shift()?.7:1;break;case "instrument=":h.transp=Kc(a.shift(),"instr");break;case "map=":h.map=a.shift();break;case "name=":case "nm=":h.nm=
a.shift();'"'==h.nm[0]&&(h.nm=h.nm.slice(1,-1));h.new_name=!0;break;case "stem=":case "pos=":b="pos="==b?a.shift().split(" "):["stm",a.shift()];e=We[b[1]];if(void 0==e){u(1,P.bad_val,b[0]);break}d||(d={});d[b[0]]=e;break;case "scale=":e=parseFloat(a.shift());isNaN(e)||.6>e||1.5<e?u(1,P.bad_val,"%%voicescale"):h.scale=e;break;case "score=":if(r.sound)break;b=a.shift();0>b.indexOf("/")&&(b+="/c");h.transp=Kc(b);break;case "shift=":h.shift=Kc(a.shift());break;case "sound=":case "transpose=":if(!r.sound)break;
h.transp=Kc(a.shift());break;case "subname=":case "sname=":case "snm=":h.snm=a.shift();'"'==h.snm[0]&&(h.snm=h.snm.slice(1,-1));break;case "stafflines=":e=Og(a.shift());void 0==e?u(1,"Bad %%stafflines value"):void 0!=h.st?G.staves[h.st].stafflines=e:h.stafflines=e;break;case "staffnonote=":e=parseInt(a.shift());isNaN(e)?u(1,"Bad %%staffnonote value"):h.staffnonote=e;break;case "staffscale=":e=parseFloat(a.shift());isNaN(e)||.3>e||2<e?u(1,"Bad %%staffscale value"):h.staffscale=e;break;default:switch(b.slice(0,
4)){case "treb":case "bass":case "alto":case "teno":case "perc":c=b;break;default:0<="GFC".indexOf(b[0])?c=b:"="==b.slice(-1)&&a.shift()}}}if(d)for(b in h.pos=C(h.pos),d)d.hasOwnProperty(b)&&(h.pos[b]=d[b]);c&&(c=Df(c))&&(f&&(c.clefpit=f),$f(c))};Abc.prototype.set_v_param=function(a,c){h?aa.set_vp([a+"=",c]):(a=[a+"=",c],L.V||(L.V={}),L.V["*"]?Array.prototype.push.apply(L.V["*"],a):L.V["*"]=a)};Abc.prototype.set_width=function(a){var c,b,d,e,f,g;switch(a.type){case k.NOTE:case k.REST:a.wr=e=ah[a.head];
0<a.xmx&&(a.wr+=a.xmx+4);for(c=a.prev;c&&0==eb[c.type];c=c.prev);if(c)switch(c.type){case k.BAR:case k.CLEF:case k.KEY:case k.METER:e+=3}for(b=0;b<=a.nhd;b++)d=a.notes[b].shhd,0>d&&e<-d+5&&(e=-d+5),a.notes[b].acc&&(d=a.notes[b].shac+(a.notes[b].micro?5.5:3.5),e<d&&(e=d));if(c)switch(c.type){case k.BAR:case k.CLEF:case k.KEY:case k.METER:e-=3}a.a_dd&&(e+=ld(a));a.beam_st&&a.beam_end&&0<a.stem&&0<a.nflags&&a.wr<a.xmx+9&&(a.wr=a.xmx+9);if(0<a.dots){if(void 0==a.wl)switch(a.head){case k.SQUARE:a.xmx+=
4;break;case k.OVALBARS:case k.OVAL:a.xmx+=2;break;case k.EMPTY:a.xmx+=1}a.wr<a.xmx+8&&(a.wr=a.xmx+8);2<=a.dots&&(a.wr+=3.5*(a.dots-1))}a.trem2&&a.beam_end&&20>e&&(e=20);d=e;if(c)switch(c.type){case k.NOTE:0<c.stem&&0>a.stem&&7>d&&(d=7);(27<a.y&&27<c.y||-3>a.y&&-3>c.y)&&6>d&&(d=6);c.ti1&&14>d&&(d=14);break;case k.CLEF:if(c.second||c.clef_small)break;d+=8;break;case k.KEY:d+=4}a.a_gch&&(d=uf(a,e,d));a.a_ly&&(d=ag(a,d));a.wl=c&&c.type==k.GRACE?e-4.5:d;return;case k.SPACE:d=a.width/2;a.wr=d;a.a_gch&&
(d=uf(a,d,d));a.a_dd&&(d+=ld(a));a.wl=d;return;case k.BAR:if(a.norepbra)break;d=a.bar_type;switch(d){case "|":e=7;break;default:for(e=4+3*d.length,c=0;c<d.length;c++)switch(d[c]){case "[":case "]":e+=3;break;case ":":e+=2}}a.wl=e;a.wr=a.next&&a.next.type!=k.METER?7:5;for(c=a.prev;c;c=c.prev)if(0!=eb[c.type]){c.type==k.GRACE&&(a.wl-=8);break}a.a_dd&&(a.wl+=ld(a));a.text&&4>a.text.length&&a.next&&a.next.a_gch&&(va("repeat"),a.wr+=Ka(a.text)[0]+2);return;case k.CLEF:if(a.invis){a.wl=a.wr=1;return}a.wl=
a.wr=a.clef_small?8:12;return;case k.KEY:a.wl=3;g=4;if(a.k_a_acc){if(e=f=a.k_a_acc.length)b=a.k_a_acc[0].acc;for(c=1;c<f;c++)d=a.k_a_acc[c],d.pit>a.k_a_acc[c-1].pit+6||d.pit<a.k_a_acc[c-1].pit-6?e--:d.acc!=b&&(g+=3),b=d.acc}else e=a.k_sf,f=a.k_old_sf&&(r.cancelkey||0==e)?a.k_old_sf:0,0<=e*f?(0>e&&(e=-e),0>f&&(f=-f),f>e&&(e=f)):(e-=f,0>e&&(e=-e),g+=3);a.wr=5.5*e+g;return;case k.METER:d=0;a.x_meter=[];for(c=0;c<a.a_meter.length;c++)if(f=a.a_meter[c],"C"==f.top[0])a.x_meter[c]=d+6,d+=12;else{e=0;f=!f.bot||
f.top.length>f.bot.length?f.top:f.bot;for(b=0;b<f.length;b++)switch(f[b]){case "(":d+=4;case ")":case "1":e+=4;break;default:e+=12}a.x_meter[c]=d+e/2;d+=e}a.wl=0;a.wr=d+6;return;case k.MREST:a.wl=6;a.wr=66;return;case k.GRACE:var h;f=r.gracespace[0];c=r.gracespace[1];b=r.gracespace[2];e=a.extra;a.prev&&a.prev.type==k.BAR&&(f-=3);for(e.beam_st=!0;;e=e.next){qf(e);sf(e.notes,7);h=0;for(g=e.nhd;0<=g;g--)e.notes[g].shac>h&&(h=e.notes[g].shac);f+=h;e.x=f;0>=e.nflags&&(e.beam_st=!0,e.beam_end=!0);g=e.next;
if(!g){e.beam_end=!0;break}0>=g.nflags&&(e.beam_end=!0);e.beam_end&&(g.beam_st=!0,f+=c/4);0>=e.nflags&&(f+=c/4);e.y>g.y+8&&(f-=1.5);f+=c}(g=a.next)&&g.type==k.NOTE&&(e.y>=3*(g.notes[g.nhd].pit-18)?--b:e.beam_st&&e.y<3*(g.notes[g.nhd].pit-18)-4&&(b+=2));a.wl=f+b;a.wr=0;a.a_ly&&ag(a,d);return;case k.STBRK:a.wl=a.xmx;a.next&&a.next.type==k.CLEF?(a.wr=2,delete a.next.clef_small):a.wr=8;return;case k.CUSTOS:a.wl=a.wr=4;return;case k.BLOCK:case k.PART:case k.REMARK:case k.STAVES:case k.TEMPO:break;default:N(2,
a,"set_width - Cannot set width for symbol $1",a.type)}a.wl=a.wr=0};Abc.prototype.set_xhtml=function(a){var c=Mb;Mb=a;return c};Abc.prototype.sort_pitch=Oe;Abc.prototype.strwh=Ka;Abc.prototype.stv_g=function(){return D};Abc.prototype.svg_flush=td;Abc.prototype.syntax=u;Abc.prototype.unlksym=pb;Abc.prototype.use_font=rb;Abc.prototype.xy_str=fa;Abc.prototype.xygl=ca;var eg}};var Abc=abc2svg.Abc;"object"==typeof module&&"object"==typeof exports&&(exports.abc2svg=abc2svg,exports.Abc=Abc);
abc2svg.loadjs=function(w,C,Y){Y&&Y()};
abc2svg.modules={ambitus:{fn:"ambitus-1.js"},beginps:{fn:"psvg-1.js"},"break":{fn:"break-1.js"},capo:{fn:"capo-1.js"},clip:{fn:"clip-1.js"},voicecombine:{fn:"combine-1.js"},diagram:{fn:"diag-1.js"},equalbars:{fn:"equalbars-1.js"},grid:{fn:"grid-1.js"},grid2:{fn:"grid2-1.js"},MIDI:{fn:"MIDI-1.js"},percmap:{fn:"perc-1.js"},sth:{fn:"sth-1.js"},temperament:{fn:"temper-1.js"},nreq:0,hooks:[],g_hooks:[],load:function(w,C,Y){function N(){return"object"==typeof user&&user.errmsg?user.errmsg:"function"==typeof printErr?
printErr:"function"==typeof alert?function(u){alert(u)}:"object"==typeof console?console.log:function(){}}var sa,u=this.nreq;w=w.match(/(^|\n)(%%|I:).+?\b/g);if(!w)return!0;this.cbf=C||function(){};this.errmsg=Y||N();for(C=0;C<w.length;C++)(sa=abc2svg.modules[w[C].replace(/\n?(%%|I:)/,"")])&&!sa.loaded&&(sa.loaded=!0,this.nreq++,abc2svg.loadjs(sa.fn,function(){0==--abc2svg.modules.nreq&&abc2svg.modules.cbf()},function(){abc2svg.modules.errmsg("error loading "+sa.fn);0==--abc2svg.modules.nreq&&abc2svg.modules.cbf()}));
return this.nreq==u}};abc2svg.version="1.18.1";abc2svg.vdate="2018-11-02";
abc2svg.MIDI={do_midi:function(w){function C(u){var w=Number(u);if(!isNaN(w))return u=7*(w/12|0)-19,w%=12,u+=N[w],note={pit:u},sa[w]&&(note.acc=sa[w]),note}function Y(u){if(u.match(/^([_^=]*)([A-Ga-g])([,']*)$/))return u.match(/[A-Z]/)&&(u=u.toLowerCase(),u=0<u.indexOf("'")?u.replace("'",""):u+","),u}var N=new Int8Array([0,0,1,2,2,3,3,4,5,5,6,6]),sa=new Int8Array([0,1,0,-1,0,0,1,0,-1,0,-1,0]),u,Sa=this.get_maps(),T=w.split(/\s+/);switch(T[1]){case "channel":if("10"!=T[2])break;this.set_v_param("midictl",
"0 1");break;case "drummap":if("play"!=this.cfmt().sound)break;w=Y(T[2]);u=C(T[3]);if(!w||!u){this.syntax(1,this.errs.bad_val,"%%MIDI drummap");break}Sa.MIDIdrum||(Sa.MIDIdrum={});Sa.MIDIdrum[w]=[null,u];this.set_v_param("mididrum","MIDIdrum");break;case "program":u=void 0!=T[3]?T[3]:T[2];u=parseInt(u);if(isNaN(u)||0>u||127<u){this.syntax(1,"Bad program in %%MIDI");break}this.set_v_param("instr",u);break;case "control":w=parseInt(T[2]),isNaN(w)||0>w||127<w?this.syntax(1,"Bad controller number in %%MIDI"):
(u=parseInt(T[3]),isNaN(u)||0>u||127<u?this.syntax(1,"Bad controller value in %%MIDI"):this.set_v_param("midictl",T[2]+" "+T[3]))}},set_midi:function(w){var C,Y,N=this.get_curvoice();for(C=0;C<w.length;C++)switch(w[C]){case "instr=":N.instr=w[C+1];break;case "midictl=":N.midictl||(N.midictl={});Y=w[C+1].split(" ");N.midictl[Y[0]]=Number(Y[1]);break;case "mididrum=":N.map||(N.map={}),N.map=w[C+1]}},do_pscom:function(w,C){"MIDI "==C.slice(0,5)?abc2svg.MIDI.do_midi.call(this,C):w(C)},set_vp:function(w,
C){abc2svg.MIDI.set_midi.call(this,C);w(C)},set_hooks:function(w){w.do_pscom=abc2svg.MIDI.do_pscom.bind(w,w.do_pscom);w.set_vp=abc2svg.MIDI.set_vp.bind(w,w.set_vp)}};abc2svg.modules.hooks.push(abc2svg.MIDI.set_hooks);abc2svg.modules.MIDI.loaded=!0;
abc2svg.perc={do_perc:function(w){function C(u){var w,C,H=Number(u);if(isNaN(H)){if(C=u.match(/^([_^=]*)([A-Ga-g])([,']*)$/)){w="CDEFGABcdefgab".indexOf(C[2])+16;switch(C[3]){case "'":w+=7*C[3].length;break;case ",":w-=7*C[3].length}note={pit:w};switch(C[1]){case "^":note.acc=1;break;case "_":note.acc=-1}return note}u=u.toLowerCase(u);C=u[0];for(w=0;;){w=u.indexOf("-",w);if(0>w)break;w+=1;C+="-"+u[w]}H=sa[C];if(!H)switch(u[0]){case "c":switch(u[1]){case "a":H=sa.ca;break;case "l":H=sa.cl;break;case "o":H=
sa.co}break;case "h":case "l":if(w=u.indexOf("-"),"t"==u[w+1])switch(u[1]){case "i":case "o":H=sa[C+u[1]]}}}if(H)return u=7*(H/12|0)-19,H%=12,u+=Y[H],note={pit:u},N[H]&&(note.acc=N[H]),note}var Y=new Int8Array([0,0,1,2,2,3,3,4,5,5,6,6]),N=new Int8Array([0,1,0,-1,0,0,1,0,-1,0,-1,0]),sa={"a-b-d":35,"a-s":38,"b-d-1":36,ca:69,cl:75,co:56,"c-c":52,"c-c-1":49,"c-c-2":57,"c-h-h":42,"e-s":40,"h-a":67,"h-b":60,"h-c":39,"h-f-t":43,"h-m-t":48,"h-ti":65,"h-to":50,"h-w-b":76,"l-a":68,"l-b":61,"l-c":64,"l-f-t":41,
"l-g":74,"l-m-t":47,"l-ti":66,"l-to":45,"l-w":72,"l-w-b":77,m:70,"m-c":78,"m-h-c":62,"m-t":80,"o-c":79,"o-h-c":63,"o-h-h":46,"o-t":81,"p-h-h":44,"r-b":53,"r-c-1":51,"r-c-2":59,"s-c":55,"s-g":73,"s-s":37,"s-w":71,t:54,v:58},u,Sa=this.get_maps(),T=w.split(/\s+/);if(w=function(u){if(u.match(/^([_^]*)([A-Ga-g])([,']*)$/))return u.match(/[A-Z]/)&&(u=u.toLowerCase(),u=0<u.indexOf("'")?u.replace("'",""):u+","),u}(T[1])){if("play"!=this.cfmt().sound){if(!T[3])return;Sa.MIDIdrum||(Sa.MIDIdrum={});u=C(w);if(!u){this.syntax(1,
this.errs.bad_val,"%%percmap");return}delete u.acc;Sa.MIDIdrum[w]=[[T[3]],u]}else{u=C(T[2]);if(!u){this.syntax(1,this.errs.bad_val,"%%percmap");return}Sa.MIDIdrum||(Sa.MIDIdrum={});Sa.MIDIdrum[w]=[null,u]}this.set_v_param("perc","MIDIdrum")}else this.syntax(1,this.errs.bad_val,"%%percmap")},set_perc:function(w){var C,Y=this.get_curvoice();for(C=0;C<w.length;C++)switch(w[C]){case "perc=":Y.map||(Y.map={}),Y.map=w[C+1],Y.midictl||(Y.midictl={}),Y.midictl[0]=1}},do_pscom:function(w,C){"percmap "==C.slice(0,
8)?abc2svg.perc.do_perc.call(this,C):w(C)},set_vp:function(w,C){abc2svg.perc.set_perc.call(this,C);w(C)},set_hooks:function(w){w.do_pscom=abc2svg.perc.do_pscom.bind(w,w.do_pscom);w.set_vp=abc2svg.perc.set_vp.bind(w,w.set_vp)}};abc2svg.modules.hooks.push(abc2svg.perc.set_hooks);abc2svg.modules.percmap.loaded=!0;
